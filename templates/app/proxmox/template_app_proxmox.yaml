zabbix_export:
  version: '8.0'
  template_groups:
    - uuid: a571c0d144b14fd4a87a9d9b2aa9fcd6
      name: Templates/Applications
  templates:
    - uuid: 4958b76448d74ff1b6d7d6280449beee
      template: 'Proxmox VE by HTTP'
      name: 'Proxmox VE by HTTP'
      description: |
        Proxmox VE is a complete open-source platform for enterprise virtualization.
        It tightly integrates two virtualization technologies: KVM for virtual machines
        and LXC for containers, on a single platform.
        This template is designed for the effortless deployment of Proxmox VE monitoring by Zabbix via HTTP and doesn't require any external scripts.
        
        Proxmox VE uses a REST like API. The concept is described in Resource Oriented Architecture (ROA).
        
        Check the API documentation for details:
        https://pve.proxmox.com/pve-docs/api-viewer/index.html
        
        Setup:
        
        1. Create an API token for the monitoring user. Important note: for security reasons, it is recommended to create a separate user (Datacenter - Permissions).
        
        Please provide the necessary access levels for both the User and the Token:
        
        * /cluster/resources
        * /cluster/status
        * /access/users
        * /nodes
        * /nodes/{#NODE.NAME}/apt/update
        * /nodes/{#NODE.NAME}/certificates/info
        * /nodes/{#NODE.NAME}/disks/list
        * /nodes/{#NODE.NAME}/disks/smart?disk={#DISK.NAME}
        * /nodes/{#NODE.NAME}/hardware/pci
        * /nodes/{#NODE.NAME}/hardware/usb
        * /nodes/{#NODE.NAME}/lxc
        * /nodes/{#NODE.NAME}/lxc/{#LXC.VMID}/status/current
        * /nodes/{#NODE.NAME}/qemu
        * /nodes/{#NODE.NAME}/qemu/{#QEMU.VMID}/agent/get-fsinfo
        * /nodes/{#NODE.NAME}/qemu/{#QEMU.VMID}/agent/get-osinfo
        * /nodes/{#NODE.NAME}/qemu/{#QEMU.VMID}/agent/get-time
        * /nodes/{#NODE.NAME}/qemu/{#QEMU.VMID}/agent/get-timezone
        * /nodes/{#NODE.NAME}/qemu/{#QEMU.VMID}/agent/info
        * /nodes/{#NODE.NAME}/qemu/{#QEMU.VMID}/agent/network-get-interfaces
        * /nodes/{#NODE.NAME}/qemu/{#QEMU.VMID}/status/current
        * /nodes/{#NODE.NAME}/storage
        * /nodes/{#NODE.NAME}/time
        * /nodes/{#NODE.NAME}/version
        
        2. Copy the resulting Token ID and Secret into the host macros '{$PVE.TOKEN.ID}' and '{$PVE.TOKEN.SECRET}'.
        
        3. Set the hostname or IP address of the Proxmox VE API host in the '{$PVE.URL.HOST}' macro. You can also change the API port in the '{$PVE.URL.PORT}' macro if necessary.
        
        Generated by official Zabbix template tool "Templator"
      wizard_ready: 'YES'
      readme: |
        ## Overview
        
        Proxmox VE is a complete open-source platform for enterprise virtualization.
        It tightly integrates two virtualization technologies: KVM for virtual machines
        and LXC for containers, on a single platform.
        
        ## Setup
        
        To use this template, you need to have a Proxmox VE server set up and accessible via HTTP.
        Ensure that you have the necessary API access configured on your Proxmox VE server.
        Check the [`API documentation`](https://pve.proxmox.com/pve-docs/api-viewer/index.html) for details.
        
        1. Create an API token for the monitoring user. Important note: for security reasons, it is recommended to create a separate user (Datacenter - Permissions).
        
        Please provide the necessary access levels for both the User and the Token:
        
            * /cluster/resources
            * /cluster/status
            * /access/users
            * /nodes
            * /nodes/{#NODE.NAME}/apt/update
            * /nodes/{#NODE.NAME}/certificates/info
            * /nodes/{#NODE.NAME}/disks/list
            * /nodes/{#NODE.NAME}/disks/smart?disk={#DISK.NAME}
            * /nodes/{#NODE.NAME}/hardware/pci
            * /nodes/{#NODE.NAME}/hardware/usb
            * /nodes/{#NODE.NAME}/lxc
            * /nodes/{#NODE.NAME}/lxc/{#LXC.VMID}/status/current
            * /nodes/{#NODE.NAME}/qemu
            * /nodes/{#NODE.NAME}/qemu/{#QEMU.VMID}/agent/get-fsinfo
            * /nodes/{#NODE.NAME}/qemu/{#QEMU.VMID}/agent/get-osinfo
            * /nodes/{#NODE.NAME}/qemu/{#QEMU.VMID}/agent/get-time
            * /nodes/{#NODE.NAME}/qemu/{#QEMU.VMID}/agent/get-timezone
            * /nodes/{#NODE.NAME}/qemu/{#QEMU.VMID}/agent/info
            * /nodes/{#NODE.NAME}/qemu/{#QEMU.VMID}/agent/network-get-interfaces
            * /nodes/{#NODE.NAME}/qemu/{#QEMU.VMID}/status/current
            * /nodes/{#NODE.NAME}/storage
            * /nodes/{#NODE.NAME}/time
            * /nodes/{#NODE.NAME}/version
        
        2. Copy the resulting Token ID and Secret into `Proxmox VE API Token ID` and `Proxmox VE API Token Secret`.
        
        3. Set the hostname or IP address of the Proxmox API VE host in the `Proxmox VE Host`. You can also change the API port in the `Proxmox VE Port` if necessary.
      vendor:
        name: Zabbix
        version: 8.0-2
      groups:
        - name: Templates/Applications
      items:
        - uuid: 09dbc145122f45afa2b20cfba08899b8
          name: 'Cluster: Number of CPUs'
          type: DEPENDENT
          key: proxmox_ve.cluster.cpu.count
          description: 'Retrieves the total number of CPUs in the Proxmox VE cluster.'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.data.cluster.cpu_count
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1h
          master_item:
            key: proxmox_ve.cluster.resources.get
          tags:
            - tag: component
              value: cluster
            - tag: component
              value: cpu
        - uuid: 5fe36fb1f830484db35311a10b4a258f
          name: 'Cluster: CPU utilization'
          type: DEPENDENT
          key: proxmox_ve.cluster.cpu.utilization
          value_type: FLOAT
          units: '%'
          description: 'Retrieves the CPU utilization percentage for the Proxmox VE cluster.'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.data.cluster.cpu_average
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1h
          master_item:
            key: proxmox_ve.cluster.resources.get
          tags:
            - tag: component
              value: cluster
            - tag: component
              value: cpu
        - uuid: 7edd8666cbca4ea1a8508bf17ca4f245
          name: 'Cluster: Number of running LXC containers'
          type: DEPENDENT
          key: proxmox_ve.cluster.lxc.running
          description: 'Retrieves the number of running LXC containers in the Proxmox VE cluster.'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.data.cluster.lxc_running
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1h
          master_item:
            key: proxmox_ve.cluster.resources.get
          tags:
            - tag: component
              value: cluster
        - uuid: c7a1dc8391374ddfb8bee19ab3bdb676
          name: 'Cluster: Number of stopped LXC containers'
          type: DEPENDENT
          key: proxmox_ve.cluster.lxc.stopped
          description: 'Retrieves the number of stopped LXC containers in the Proxmox VE cluster.'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.data.cluster.lxc_stopped
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1h
          master_item:
            key: proxmox_ve.cluster.resources.get
          tags:
            - tag: component
              value: cluster
        - uuid: 5aa2f7c8e1bc40e3bc045bcc056cb6bc
          name: 'Cluster: Memory total'
          type: DEPENDENT
          key: proxmox_ve.cluster.memory.total
          units: B
          description: 'Retrieves the total memory available in the Proxmox VE cluster.'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.data.cluster.memory_total
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1h
          master_item:
            key: proxmox_ve.cluster.resources.get
          tags:
            - tag: component
              value: cluster
            - tag: component
              value: memory
        - uuid: 5c39086a40e5400cafe58d8be7961bd8
          name: 'Cluster: Memory used'
          type: DEPENDENT
          key: proxmox_ve.cluster.memory.used
          units: B
          description: 'Retrieves the total memory used in the Proxmox VE cluster.'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.data.cluster.memory_used
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1h
          master_item:
            key: proxmox_ve.cluster.resources.get
          tags:
            - tag: component
              value: cluster
            - tag: component
              value: memory
        - uuid: f22284321a154ed89ea1a0afc3f8aea1
          name: 'Cluster: Memory utilization'
          type: DEPENDENT
          key: proxmox_ve.cluster.memory.utilization
          value_type: FLOAT
          units: '%'
          description: 'Retrieves the memory utilization percentage for the Proxmox VE cluster.'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.data.cluster.memory_utilization
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1h
          master_item:
            key: proxmox_ve.cluster.resources.get
          tags:
            - tag: component
              value: cluster
            - tag: component
              value: memory
        - uuid: 3ba7a55cfe3847d7b1d3de50e8f5b4ca
          name: 'Cluster: Number of cluster nodes'
          type: DEPENDENT
          key: proxmox_ve.cluster.nodes
          description: 'Retrieves the number of nodes in the Proxmox VE cluster.'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.data.cluster.nodes
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1h
          master_item:
            key: proxmox_ve.cluster.resources.get
          tags:
            - tag: component
              value: cluster
        - uuid: 47516178b1174f11ad5ad6ca2aed037f
          name: 'Cluster: Number of cluster nodes offline'
          type: DEPENDENT
          key: proxmox_ve.cluster.nodes.offline
          description: 'Retrieves the number of offline nodes in the Proxmox VE cluster.'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.data.cluster.node_offline
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1h
          master_item:
            key: proxmox_ve.cluster.resources.get
          tags:
            - tag: component
              value: cluster
        - uuid: 7980048fe7f843de9c31a5f479096dd0
          name: 'Cluster: Number of cluster nodes online'
          type: DEPENDENT
          key: proxmox_ve.cluster.nodes.online
          description: 'Retrieves the number of online nodes in the Proxmox VE cluster.'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.data.cluster.node_online
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1h
          master_item:
            key: proxmox_ve.cluster.resources.get
          tags:
            - tag: component
              value: cluster
        - uuid: 7ec9cf0b3308474ab7fde901762eccd9
          name: 'Cluster: Quorum status'
          type: DEPENDENT
          key: proxmox_ve.cluster.quorum.status
          description: 'Retrieves the cluster quorum status from the Proxmox VE API.'
          valuemap:
            name: 'Proxmox cluster quorum status'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.data.cluster.quorate
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1h
          master_item:
            key: proxmox_ve.cluster.resources.get
          tags:
            - tag: component
              value: cluster
          triggers:
            - uuid: 76cc334b9e3c4f909131a4f60dc089b2
              expression: 'last(/Proxmox VE by HTTP/proxmox_ve.cluster.quorum.status) = 0'
              name: 'Proxmox VE: Cluster quorum status changed'
              priority: WARNING
              description: 'No majority of nodes for decision making.'
              manual_close: 'YES'
        - uuid: 2f0b1c8d3a5e4b9c8f6d7e8f9a0b1c2d
          name: 'Cluster: Get resources'
          type: SCRIPT
          key: proxmox_ve.cluster.resources.get
          delay: '{$PVE.PARAMS.INTERVAL.CLUSTER}'
          history: '0'
          value_type: TEXT
          params: |
            var Proxmox = {
            	params: {},
            
            	output: {
            		'status': 0,
            		'data': {
            			'cluster': {
            				'lxc_running': 0,
            				'qemu_running': 0,
            				'lxc_stopped': 0,
            				'qemu_stopped': 0,
            				'cpu_count': 0,
            				'cpu_usage_summary': 0,
            				'cpu_average': 0,
            				'nodes': 1,
            				'node_online': 0,
            				'node_offline': 0,
            				'memory_used': 0,
            				'memory_total': 0,
            				'memory_utilization': 0,
            				'quorate': 2,
            			},
            			'nodes': {},
            			'qemu': [],
            			'lxc': [],
            			'storage': {
            				'count': 0,
            				'used': 0,
            				'total': 0,
            				'utilization': 0,
            				'list': []
            			}
            		},
            		'message': ''
            	},
            
            	getField: function (data, path, val, valAsKey) {
            		var steps = path.split('.');
            
            		for (var i = 0; i < steps.length; i++) {
            
            			var step = steps[i];
            			if (typeof data !== 'object' || data === null || typeof data[step] === 'undefined') {
            				if (typeof val === 'undefined') {
            					throw 'Required field was not found: "' + path + '". Input data: ' + JSON.stringify(data);
            				}
            				return typeof valAsKey !== 'undefined' ? Proxmox.getField(data, val, 'undefined') : val;
            			}
            
            			data = data[step];
            		}
            
            		return data;
            	},
            
            	setParams: function (params) {
            		Proxmox.params['proxy'] = params.proxy;
            
            		['url', 'token', 'token_id'].forEach(function (field) {
            			if (typeof params !== 'object' || typeof params[field] === 'undefined' || params[field] === '') {
            				throw 'Required param is not set: "' + field + '".';
            			}
            			Proxmox.params[field] = params[field];
            		});
            	},
            
            	getData: function () {
            		var request = new HttpRequest();
            
            		if (typeof Proxmox.params.proxy !== 'undefined' && Proxmox.params.proxy !== '') {
            			request.setProxy(Proxmox.params.proxy);
            		}
            
            		request.addHeader('Authorization: PVEAPIToken=' + Proxmox.params.token_id + '=' + Proxmox.params.token);
            
            		var clusterStatus = request.get(Proxmox.params.url + '/cluster/status');
            		if (request.getStatus() !== 200) {
            			throw 'Request failed with status code ' + request.getStatus() + ' Response: ' + clusterStatus + '.';
            		}
            
            		var clusterResources = request.get(Proxmox.params.url + '/cluster/resources');
            		if (request.getStatus() !== 200) {
            			throw 'Request failed with status code ' + request.getStatus() + ' Response: ' + clusterResources + '.';
            		}
            
            		try {
            			clusterStatus = JSON.parse(clusterStatus);
            		} catch (e) {
            			throw 'Failed to parse cluster status response: ' + e.message;
            		}
            
            		try {
            			clusterResources = JSON.parse(clusterResources);
            		} catch (e) {
            			throw 'Failed to parse cluster resources response: ' + e.message;
            		}
            
            		Proxmox.getField(clusterStatus, 'data', []).forEach(function (node) {
            
            			if (node.type === 'cluster') {
            				Proxmox.output['data']['cluster']['name'] = Proxmox.getField(node, 'name', '');
            				Proxmox.output['data']['cluster']['nodes'] = Proxmox.getField(node, 'nodes', 1);
            				Proxmox.output['data']['cluster']['version'] = Proxmox.getField(node, 'version', 0);
            				Proxmox.output['data']['cluster']['quorate'] = Proxmox.getField(node, 'quorate', 0);
            
            			} else if (node.type === 'node') {
            				var nodeName = Proxmox.getField(node, 'name');
            
            				Proxmox.output['data']['nodes'][nodeName] = {
            					'name': nodeName,
            					'id': Proxmox.getField(node, 'id', ''),
            					'ip': Proxmox.getField(node, 'ip', ''),
            					'level': Proxmox.getField(node, 'level', ''),
            					'local': Proxmox.getField(node, 'local', 0),
            					'online': Proxmox.getField(node, 'online', 0)
            				};
            			}
            		});
            
            		var storageList = [],
            			resourceList = Proxmox.getField(clusterResources, 'data', []);
            
            		for (var i = 0; i < resourceList.length; i++) {
            			var resource = resourceList[i];
            
            			if (resource.type === 'storage') {
            				var storageName = Proxmox.getField(resource, 'storage');
            
            				if (Proxmox.getField(resource, 'shared', 0) === 1) {
            					if (storageList.indexOf(storageName) !== -1) {
            						continue;
            					}
            					storageList.push(storageName);
            					Proxmox.output['data']['storage']['list'].push(resource);
            				}
            
            				Proxmox.output['data']['storage']['count']++;
            				Proxmox.output['data']['storage']['used'] += Proxmox.getField(resource, 'disk', 0);
            				Proxmox.output['data']['storage']['total'] += Proxmox.getField(resource, 'maxdisk', 0);
            				Proxmox.output['data']['storage']['utilization'] = Math.round((Proxmox.output['data']['storage']['used'] / Proxmox.output['data']['storage']['total']) * 100);
            
            			} else if (resource.type === 'lxc') {
            
            				Proxmox.output['data']['lxc'].push({
            					'vmid': Proxmox.getField(resource, 'vmid'),
            					'name': Proxmox.getField(resource, 'name', 'vmid', true),
            					'status': Proxmox.getField(resource, 'status', 'unknown'),
            					'node': Proxmox.getField(resource, 'node')
            				});
            
            				if (Proxmox.getField(resource, 'status') === 'running') {
            					Proxmox.output['data']['cluster']['lxc_running']++;
            				} else {
            					Proxmox.output['data']['cluster']['lxc_stopped']++;
            				}
            
            			} else if (resource.type === 'qemu') {
            
            				Proxmox.output['data']['qemu'].push({
            					'vmid': Proxmox.getField(resource, 'vmid'),
            					'name': Proxmox.getField(resource, 'name', 'vmid', true),
            					'status': Proxmox.getField(resource, 'status', 'unknown'),
            					'node': Proxmox.getField(resource, 'node')
            				});
            
            				if (Proxmox.getField(resource, 'status') === 'running') {
            					Proxmox.output['data']['cluster']['qemu_running']++;
            				} else {
            					Proxmox.output['data']['cluster']['qemu_stopped']++;
            				}
            
            			} else if (resource.type === 'node') {
            
            				if (Proxmox.getField(resource, 'status', 'offline') === 'online') {
            					Proxmox.output['data']['cluster']['node_online']++;
            				} else {
            					Proxmox.output['data']['cluster']['node_offline']++;
            				}
            
            				Proxmox.output['data']['cluster']['cpu_count'] += Proxmox.getField(resource, 'maxcpu', 0);
            				Proxmox.output['data']['cluster']['memory_used'] += Proxmox.getField(resource, 'mem', 0);
            				Proxmox.output['data']['cluster']['memory_total'] += Proxmox.getField(resource, 'maxmem', 0);
            				Proxmox.output['data']['cluster']['memory_utilization'] = Math.round((Proxmox.output['data']['cluster']['memory_used'] / Proxmox.output['data']['cluster']['memory_total']) * 100);
            				Proxmox.output['data']['cluster']['cpu_usage_summary'] += Proxmox.getField(resource, 'cpu', 0) * 100;
            				Proxmox.output['data']['cluster']['cpu_average'] = Math.round(Proxmox.output['data']['cluster']['cpu_usage_summary'] / Proxmox.output['data']['cluster']['node_online']);
            			}
            		}
            	}
            }
            
            try {
            	Proxmox.setParams(JSON.parse(value));
            	Proxmox.getData();
            }
            catch (error) {
            	error += (String(error).endsWith('.')) ? '' : '.';
            
            	Zabbix.log(3, '[ Proxmox ] ERROR: ' + error);
            
            	Proxmox.output['status'] = 1;
            	Proxmox.output['message'] = error;
            }
            
            return JSON.stringify(Proxmox.output);
          description: 'Retrieves the list of cluster resources from the Proxmox VE API.'
          parameters:
            - name: proxy
              value: '{$PVE.PROXY}'
            - name: token
              value: '{$PVE.TOKEN.SECRET}'
            - name: token_id
              value: '{$PVE.TOKEN.ID}'
            - name: url
              value: 'https://{$PVE.URL.HOST}:{$PVE.URL.PORT}/api2/json/'
          tags:
            - tag: component
              value: raw
          triggers:
            - uuid: 3f95331b7f6445f7b1a3d9b4b27d8159
              expression: 'jsonpath(last(/Proxmox VE by HTTP/proxmox_ve.cluster.resources.get), "$.status") <> 0 or jsonpath(last(/Proxmox VE by HTTP/proxmox_ve.cluster.resources.get), "$.message") <> ""'
              name: 'Proxmox VE: Cluster resources update error'
              event_name: 'Proxmox VE: Cluster resources update error ($2)'
              opdata: 'Error code: $1, Message: $2'
              priority: HIGH
              description: 'An error occurred while retrieving cluster resources from the Proxmox VE API.'
        - uuid: 0ffefc2cfacd4607aac7987c5b3d3d1e
          name: 'Cluster: Storage total'
          type: DEPENDENT
          key: proxmox_ve.cluster.storage.total
          units: B
          description: 'Retrieves the total storage available in the Proxmox VE cluster.'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.data.storage.total
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1h
          master_item:
            key: proxmox_ve.cluster.resources.get
          tags:
            - tag: component
              value: cluster
            - tag: component
              value: storage
        - uuid: 595f3b541ae74b04a91454ea7b9c09d6
          name: 'Cluster: Storage used'
          type: DEPENDENT
          key: proxmox_ve.cluster.storage.used
          units: B
          description: 'Retrieves the total storage used in the Proxmox VE cluster.'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.data.storage.used
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1h
          master_item:
            key: proxmox_ve.cluster.resources.get
          tags:
            - tag: component
              value: cluster
            - tag: component
              value: storage
        - uuid: 442fa25a1740472c8bcd0dc55377bf81
          name: 'Cluster: Storage utilization'
          type: DEPENDENT
          key: proxmox_ve.cluster.storage.utilization
          value_type: FLOAT
          units: '%'
          description: 'Retrieves the storage utilization percentage for the Proxmox VE cluster.'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.data.storage.utilization
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1h
          master_item:
            key: proxmox_ve.cluster.resources.get
          tags:
            - tag: component
              value: cluster
            - tag: component
              value: storage
        - uuid: 4ce0c2c7899f4f97bbf2e87006fd717f
          name: 'Cluster: Number of running virtual machines'
          type: DEPENDENT
          key: proxmox_ve.cluster.vms.running
          description: 'Retrieves the number of running virtual machines in the Proxmox VE cluster.'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.data.cluster.qemu_running
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1h
          master_item:
            key: proxmox_ve.cluster.resources.get
          tags:
            - tag: component
              value: cluster
        - uuid: 0d8d98002ea948fab249d9273a03f6fa
          name: 'Cluster: Number of stopped virtual machines'
          type: DEPENDENT
          key: proxmox_ve.cluster.vms.stopped
          description: 'Retrieves the number of stopped virtual machines in the Proxmox VE cluster.'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.data.cluster.qemu_stopped
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1h
          master_item:
            key: proxmox_ve.cluster.resources.get
          tags:
            - tag: component
              value: cluster
        - uuid: 22ca0c07d8824fa2aae0b7763049c9ec
          name: 'Cluster: Get node data'
          type: HTTP_AGENT
          key: proxmox_ve.get_node_data
          delay: '{$PVE.PARAMS.INTERVAL.NODE}'
          history: '0'
          value_type: TEXT
          description: 'Retrieves the list of nodes from the Proxmox VE API.'
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.data
              error_handler: CUSTOM_ERROR
              error_handler_params: 'Error retrieving node data'
          timeout: '10'
          url: 'https://{$PVE.URL.HOST}:{$PVE.URL.PORT}/api2/json//nodes'
          status_codes: '200,500,595'
          http_proxy: '{$PVE.PROXY}'
          headers:
            - name: Authorization
              value: 'PVEAPIToken={$PVE.TOKEN.ID}={$PVE.TOKEN.SECRET}'
          tags:
            - tag: component
              value: raw
        - uuid: 20ba86cfa8a34c6a852599c6d07c2be9
          name: 'Cluster: Get user data'
          type: HTTP_AGENT
          key: proxmox_ve.get_user_data
          delay: '{$PVE.PARAMS.INTERVAL.USER}'
          history: '0'
          value_type: TEXT
          description: 'Retrieves the list of users from the Proxmox VE API.'
          preprocessing:
            - type: JAVASCRIPT
              parameters:
                - |
                  try {
                  	var data = JSON.parse(value);
                  
                  	data['data'].forEach(function (user) {
                  
                  		if (typeof user['firstname'] === 'undefined') {
                  			user['firstname'] = '';
                  		}
                  		if (typeof user['lastname'] === 'undefined') {
                  			user['lastname'] = '';
                  		}
                  		user['fullname'] = user['firstname'] + ' ' + user['lastname'] + ' (' + user['userid'] + ')';
                  
                  	});
                  
                  	return JSON.stringify(data);
                  
                  } catch (e) {
                  
                  	Zabbix.log(3, "[ERROR] Proxmox user discovery error: " + e + " for value: " + value);
                  
                  	return JSON.stringify([]);
                  }
          timeout: '10'
          url: 'https://{$PVE.URL.HOST}:{$PVE.URL.PORT}/api2/json//access/users'
          status_codes: '200,500,595'
          http_proxy: '{$PVE.PROXY}'
          headers:
            - name: Authorization
              value: 'PVEAPIToken={$PVE.TOKEN.ID}={$PVE.TOKEN.SECRET}'
          tags:
            - tag: component
              value: raw
      discovery_rules:
        - uuid: 1c548e56f62840c1a3a96f121f74d59e
          name: 'Node [{#NODE.NAME}]: Certificate discovery'
          type: HTTP_AGENT
          key: 'proxmox_ve.node.certificates.discovery[{#NODE.ID}]'
          delay: '{$PVE.PARAMS.INTERVAL.CERT}'
          filter:
            evaltype: AND
            conditions:
              - macro: '{#CERT.FILENAME}'
                value: '{$PVE.FILTER.CERT.FILE.MATCH}'
              - macro: '{#CERT.FILENAME}'
                value: '{$PVE.FILTER.CERT.FILE.NOTMATCH}'
                operator: NOT_MATCHES_REGEX
          description: 'Discovers certificates on the node {#NODE.NAME}.'
          item_prototypes:
            - uuid: fdb6fa2733a6431ba1ff3c5e0e5789b5
              name: 'Node [{#NODE.NAME}]: Certificate [{#CERT.FILENAME}]: Get info'
              type: HTTP_AGENT
              key: 'proxmox_ve.node.certificates.expire[{#NODE.ID},{#CERT.FILENAME}]'
              delay: 12h
              history: '0'
              value_type: TEXT
              description: 'Retrieves info for the certificate {#CERT.FILENAME} on the node {#NODE.NAME}.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$.data.[?(@.filename == "{#CERT.FILENAME}")].first()'
                  error_handler: DISCARD_VALUE
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 12h
              timeout: '10'
              url: 'https://{$PVE.URL.HOST}:{$PVE.URL.PORT}/api2/json//nodes/{#NODE.NAME}/certificates/info'
              status_codes: '200,500,595'
              http_proxy: '{$PVE.PROXY}'
              headers:
                - name: Authorization
                  value: 'PVEAPIToken={$PVE.TOKEN.ID}={$PVE.TOKEN.SECRET}'
              tags:
                - tag: component
                  value: raw
            - uuid: 6bb5c7740b66469989c6c01a21fe07e4
              name: 'Node [{#NODE.NAME}]: Certificate [{#CERT.FILENAME}]: Fingerprint'
              type: DEPENDENT
              key: 'proxmox_ve.node.certificates.fingerprint[{#NODE.ID},{#CERT.FILENAME}]'
              value_type: CHAR
              description: 'Retrieves the fingerprint for the certificate {#CERT.FILENAME} on the node {#NODE.NAME}.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.fingerprint
                  error_handler: DISCARD_VALUE
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 12h
              master_item:
                key: 'proxmox_ve.node.certificates.expire[{#NODE.ID},{#CERT.FILENAME}]'
              tags:
                - tag: certificate
                  value: '{#CERT.FILENAME}'
                - tag: component
                  value: certificates
                - tag: component
                  value: node
                - tag: node
                  value: '{#NODE.NAME}'
            - uuid: 54631bc104224928b2bda16b37528bd5
              name: 'Node [{#NODE.NAME}]: Certificate [{#CERT.FILENAME}]: Issuer'
              type: DEPENDENT
              key: 'proxmox_ve.node.certificates.issuer[{#NODE.ID},{#CERT.FILENAME}]'
              value_type: CHAR
              description: 'Retrieves the issuer for the certificate {#CERT.FILENAME} on the node {#NODE.NAME}.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.issuer
                  error_handler: DISCARD_VALUE
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 12h
              master_item:
                key: 'proxmox_ve.node.certificates.expire[{#NODE.ID},{#CERT.FILENAME}]'
              tags:
                - tag: certificate
                  value: '{#CERT.FILENAME}'
                - tag: component
                  value: certificates
                - tag: component
                  value: node
                - tag: node
                  value: '{#NODE.NAME}'
            - uuid: 4c158652201148a7a2825b70e542c34b
              name: 'Node [{#NODE.NAME}]: Certificate [{#CERT.FILENAME}]: Valid not after'
              type: DEPENDENT
              key: 'proxmox_ve.node.certificates.notafter[{#NODE.ID},{#CERT.FILENAME}]'
              units: unixtime
              description: 'Retrieves the not after date for the certificate {#CERT.FILENAME} on the node {#NODE.NAME}.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.notafter
                  error_handler: DISCARD_VALUE
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 12h
              master_item:
                key: 'proxmox_ve.node.certificates.expire[{#NODE.ID},{#CERT.FILENAME}]'
              tags:
                - tag: certificate
                  value: '{#CERT.FILENAME}'
                - tag: component
                  value: certificates
                - tag: component
                  value: node
                - tag: node
                  value: '{#NODE.NAME}'
            - uuid: 7510aad13f8146168bca6440f610a891
              name: 'Node [{#NODE.NAME}]: Certificate [{#CERT.FILENAME}]: Valid not before'
              type: DEPENDENT
              key: 'proxmox_ve.node.certificates.notbefore[{#NODE.ID},{#CERT.FILENAME}]'
              units: unixtime
              description: 'Retrieves the not before date for the certificate {#CERT.FILENAME} on the node {#NODE.NAME}.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.notbefore
                  error_handler: DISCARD_VALUE
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 12h
              master_item:
                key: 'proxmox_ve.node.certificates.expire[{#NODE.ID},{#CERT.FILENAME}]'
              tags:
                - tag: certificate
                  value: '{#CERT.FILENAME}'
                - tag: component
                  value: certificates
                - tag: component
                  value: node
                - tag: node
                  value: '{#NODE.NAME}'
            - uuid: f239f2f0da1249b7a5d1943ab8a0ab4b
              name: 'Node [{#NODE.NAME}]: Certificate [{#CERT.FILENAME}]: Subject'
              type: DEPENDENT
              key: 'proxmox_ve.node.certificates.subject[{#NODE.ID},{#CERT.FILENAME}]'
              value_type: CHAR
              description: 'Retrieves the subject for the certificate {#CERT.FILENAME} on the node {#NODE.NAME}.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.subject
                  error_handler: DISCARD_VALUE
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 12h
              master_item:
                key: 'proxmox_ve.node.certificates.expire[{#NODE.ID},{#CERT.FILENAME}]'
              tags:
                - tag: certificate
                  value: '{#CERT.FILENAME}'
                - tag: component
                  value: certificates
                - tag: component
                  value: node
                - tag: node
                  value: '{#NODE.NAME}'
          trigger_prototypes:
            - uuid: 43465550101a4f959cdf649bd9113e6a
              expression: 'last(/Proxmox VE by HTTP/proxmox_ve.node.certificates.notafter[{#NODE.ID},{#CERT.FILENAME}]) < now() or last(/Proxmox VE by HTTP/proxmox_ve.node.certificates.notbefore[{#NODE.ID},{#CERT.FILENAME}]) > now()'
              name: 'Proxmox VE: Node [{#NODE.NAME}]: Certificate [{#CERT.FILENAME}]: Not valid'
              priority: AVERAGE
              description: 'The certificate {#CERT.FILENAME} on the node {#NODE.NAME} expires in less than 7 days.'
              tags:
                - tag: scope
                  value: certificates
                - tag: scope
                  value: node
          parent_discovery_rule:
            key: proxmox_ve.nodes.discovery
          timeout: '10'
          url: 'https://{$PVE.URL.HOST}:{$PVE.URL.PORT}/api2/json/nodes/{#NODE.NAME}/certificates/info'
          status_codes: '200,500,595'
          http_proxy: '{$PVE.PROXY}'
          headers:
            - name: Authorization
              value: 'PVEAPIToken={$PVE.TOKEN.ID}={$PVE.TOKEN.SECRET}'
          lld_macro_paths:
            - lld_macro: '{#CERT.FILENAME}'
              path: $.filename
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.data
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 12h
        - uuid: 3dc3d1bdc2d4484a9f3375c5a16534b5
          name: 'Node [{#NODE.NAME}]: Disks discovery'
          type: HTTP_AGENT
          key: 'proxmox_ve.node.disks.discovery[{#NODE.ID}]'
          delay: '{$PVE.PARAMS.INTERVAL.DISK}'
          filter:
            evaltype: AND
            conditions:
              - macro: '{#DISK.NAME}'
                value: '{$PVE.FILTER.DISK.MATCH}'
              - macro: '{#DISK.NAME}'
                value: '{$PVE.FILTER.DISK.NOTMATCH}'
                operator: NOT_MATCHES_REGEX
          description: 'Discovers disks on the node {#NODE.NAME}.'
          item_prototypes:
            - uuid: 444fd91bf4124ce391d54fb521a22228
              name: 'Node [{#NODE.NAME}]: Disk [{#DISK.NAME}]: Get info'
              type: HTTP_AGENT
              key: 'proxmox_ve.node.disk.info[{#NODE.ID},{#DISK.NAME}]'
              delay: 10m
              history: '0'
              value_type: TEXT
              description: 'Retrieves info for the disk {#DISK.NAME} on the node {#NODE.NAME}.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$.data.[?(@.devpath == "{#DISK.NAME}")].first()'
                  error_handler: DISCARD_VALUE
              timeout: '10'
              url: 'https://{$PVE.URL.HOST}:{$PVE.URL.PORT}/api2/json//nodes/{#NODE.NAME}/disks/list'
              status_codes: '200,500,595'
              http_proxy: '{$PVE.PROXY}'
              headers:
                - name: Authorization
                  value: 'PVEAPIToken={$PVE.TOKEN.ID}={$PVE.TOKEN.SECRET}'
              tags:
                - tag: component
                  value: raw
            - uuid: 7be3405f61bb44f0b9e0b2ff6e77db52
              name: 'Node [{#NODE.NAME}]: Disk [{#DISK.NAME}]: Model'
              type: DEPENDENT
              key: 'proxmox_ve.node.disk.model[{#NODE.ID},{#DISK.NAME}]'
              value_type: CHAR
              description: 'Retrieves the model for the disk {#DISK.NAME} on the node {#NODE.NAME}.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.model
                  error_handler: DISCARD_VALUE
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 12h
              master_item:
                key: 'proxmox_ve.node.disk.info[{#NODE.ID},{#DISK.NAME}]'
              tags:
                - tag: component
                  value: disk
                - tag: component
                  value: node
                - tag: disk
                  value: '{#DISK.NAME}'
                - tag: node
                  value: '{#NODE.NAME}'
            - uuid: 274a373d073c40588cecf3a27e643aa4
              name: 'Node [{#NODE.NAME}]: Disk [{#DISK.NAME}]: Serial'
              type: DEPENDENT
              key: 'proxmox_ve.node.disk.serial[{#NODE.ID},{#DISK.NAME}]'
              value_type: CHAR
              description: 'Retrieves the serial number for the disk {#DISK.NAME} on the node {#NODE.NAME}.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.serial
                  error_handler: DISCARD_VALUE
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 12h
              master_item:
                key: 'proxmox_ve.node.disk.info[{#NODE.ID},{#DISK.NAME}]'
              tags:
                - tag: component
                  value: disk
                - tag: component
                  value: node
                - tag: disk
                  value: '{#DISK.NAME}'
                - tag: node
                  value: '{#NODE.NAME}'
            - uuid: e79e995ce469400aba19e265e0f9d1b4
              name: 'Node [{#NODE.NAME}]: Disk [{#DISK.NAME}]: SMART status'
              type: HTTP_AGENT
              key: 'proxmox_ve.node.disk.smart[{#NODE.ID},{#DISK.NAME}]'
              delay: 1h
              description: 'Retrieves the SMART status for the disk {#DISK.NAME} on the node {#NODE.NAME}.'
              valuemap:
                name: 'Proxmox node disk SMART status'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.data.health
                  error_handler: DISCARD_VALUE
                - type: JAVASCRIPT
                  parameters:
                    - |
                      const idx = {
                        'OK': 1
                      };
                      
                      return typeof idx[value] === 'undefined' ? 0 : idx[value];
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 12h
              timeout: '10'
              url: 'https://{$PVE.URL.HOST}:{$PVE.URL.PORT}/api2/json//nodes/{#NODE.NAME}/disks/smart?disk={#DISK.NAME}'
              status_codes: '200,500,595'
              http_proxy: '{$PVE.PROXY}'
              headers:
                - name: Authorization
                  value: 'PVEAPIToken={$PVE.TOKEN.ID}={$PVE.TOKEN.SECRET}'
              tags:
                - tag: component
                  value: disk
                - tag: component
                  value: node
                - tag: disk
                  value: '{#DISK.NAME}'
                - tag: node
                  value: '{#NODE.NAME}'
              trigger_prototypes:
                - uuid: 1af8da3c43ed45cc8b240c31647990b5
                  expression: 'last(/Proxmox VE by HTTP/proxmox_ve.node.disk.smart[{#NODE.ID},{#DISK.NAME}]) <> 1'
                  name: 'Proxmox VE: Node [{#NODE.NAME}]: Disk [{#DISK.NAME}]: SMART status fail'
                  priority: HIGH
                  description: 'The SMART status for the disk {#DISK.NAME} on the node {#NODE.NAME} is not healthy.'
                  tags:
                    - tag: scope
                      value: notice
            - uuid: 185aa9f874214369acb68d2acefddbe7
              name: 'Node [{#NODE.NAME}]: Disk [{#DISK.NAME}]: Type'
              type: DEPENDENT
              key: 'proxmox_ve.node.disk.type[{#NODE.ID},{#DISK.NAME}]'
              value_type: CHAR
              description: 'Retrieves the type for the disk {#DISK.NAME} on the node {#NODE.NAME}.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.type
                  error_handler: DISCARD_VALUE
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 12h
              master_item:
                key: 'proxmox_ve.node.disk.info[{#NODE.ID},{#DISK.NAME}]'
              tags:
                - tag: component
                  value: disk
                - tag: component
                  value: node
                - tag: disk
                  value: '{#DISK.NAME}'
                - tag: node
                  value: '{#NODE.NAME}'
            - uuid: 1577fa7ce7ce49e6b4e174517dc784d3
              name: 'Node [{#NODE.NAME}]: Disk [{#DISK.NAME}]: Vendor'
              type: DEPENDENT
              key: 'proxmox_ve.node.disk.vendor[{#NODE.ID},{#DISK.NAME}]'
              value_type: CHAR
              description: 'Retrieves the vendor for the disk {#DISK.NAME} on the node {#NODE.NAME}.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.vendor
                  error_handler: DISCARD_VALUE
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 12h
              master_item:
                key: 'proxmox_ve.node.disk.info[{#NODE.ID},{#DISK.NAME}]'
              tags:
                - tag: component
                  value: disk
                - tag: component
                  value: node
                - tag: disk
                  value: '{#DISK.NAME}'
                - tag: node
                  value: '{#NODE.NAME}'
          parent_discovery_rule:
            key: proxmox_ve.nodes.discovery
          timeout: '10'
          url: 'https://{$PVE.URL.HOST}:{$PVE.URL.PORT}/api2/json/nodes/{#NODE.NAME}/disks/list'
          status_codes: '200,500,595'
          http_proxy: '{$PVE.PROXY}'
          headers:
            - name: Authorization
              value: 'PVEAPIToken={$PVE.TOKEN.ID}={$PVE.TOKEN.SECRET}'
          lld_macro_paths:
            - lld_macro: '{#DISK.NAME}'
              path: $.devpath
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.data
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 12h
        - uuid: 7b5f003da43e465eab8bc2bda35a9132
          name: 'Proxmox LXC discovery'
          type: DEPENDENT
          key: 'proxmox_ve.node.lxc.discovery[{#NODE.ID}]'
          filter:
            evaltype: AND
            conditions:
              - macro: '{#LXC.NAME}'
                value: '{$PVE.FILTER.LXC.MATCH}'
              - macro: '{#LXC.NAME}'
                value: '{$PVE.FILTER.LXC.NOTMATCH}'
                operator: NOT_MATCHES_REGEX
              - macro: '{#LXC.STATUS}'
                value: '{$PVE.FILTER.QEMULXC.STATUS.MATCH}'
          description: 'Discovers LXC containers on the node {#NODE.NAME}.'
          item_prototypes:
            - uuid: 2ab60ef05b5a4372aca2dc195afbd6de
              name: 'Node [{#NODE.NAME}]: LXC [{#LXC.NAME}]: CPU count'
              type: DEPENDENT
              key: 'proxmox_ve.node.lxc.cpu.count[{#NODE.ID},{#LXC.VMID}]'
              description: 'Retrieves CPU count of the LXC container {#LXC.NAME} on the node {#NODE.NAME}.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.cpus
                  error_handler: DISCARD_VALUE
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 12h
              master_item:
                key: 'proxmox_ve.node.lxc[{#NODE.ID},{#LXC.VMID}]'
              tags:
                - tag: component
                  value: cpu
                - tag: component
                  value: lxc
                - tag: component
                  value: node
                - tag: lxc
                  value: '{#LXC.NAME}'
                - tag: node
                  value: '{#NODE.NAME}'
            - uuid: 92edd367b7b44060a5ac443d7ae0a851
              name: 'Node [{#NODE.NAME}]: LXC [{#LXC.NAME}]: CPU utilization'
              type: DEPENDENT
              key: 'proxmox_ve.node.lxc.cpu[{#NODE.ID},{#LXC.VMID}]'
              value_type: FLOAT
              units: '%'
              description: 'Retrieves the CPU utilization of the LXC container {#LXC.NAME} on the node {#NODE.NAME}.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.cpu
                  error_handler: DISCARD_VALUE
                - type: MULTIPLIER
                  parameters:
                    - '100'
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 1h
              master_item:
                key: 'proxmox_ve.node.lxc[{#NODE.ID},{#LXC.VMID}]'
              tags:
                - tag: component
                  value: cpu
                - tag: component
                  value: lxc
                - tag: component
                  value: node
                - tag: lxc
                  value: '{#LXC.NAME}'
                - tag: node
                  value: '{#NODE.NAME}'
              trigger_prototypes:
                - uuid: 453c86d586b64671a9a8e41edfd45999
                  expression: 'avg(/Proxmox VE by HTTP/proxmox_ve.node.lxc.cpu[{#NODE.ID},{#LXC.VMID}], 5m) > {$PVE.TRIGGER.CPU.WARNING:"{#LXC.NAME}"}'
                  name: 'Proxmox VE: Node [{#NODE.NAME}]: LXC [{#LXC.NAME}]: CPU utilization high'
                  priority: WARNING
                  description: 'The CPU utilization of the LXC container {#LXC.NAME} on the node {#NODE.NAME} is high.'
                  tags:
                    - tag: scope
                      value: notice
            - uuid: 1650b41fed4a437d9908bd8dc65ff0ce
              name: 'Node [{#NODE.NAME}]: LXC [{#LXC.NAME}]: Disk total'
              type: DEPENDENT
              key: 'proxmox_ve.node.lxc.disk.maxdisk[{#NODE.ID},{#LXC.VMID}]'
              units: B
              description: 'Retrieves the Root disk total of the LXC container {#LXC.NAME} on the node {#NODE.NAME}.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.maxdisk
                  error_handler: DISCARD_VALUE
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 12h
              master_item:
                key: 'proxmox_ve.node.lxc[{#NODE.ID},{#LXC.VMID}]'
              tags:
                - tag: component
                  value: disk
                - tag: component
                  value: lxc
                - tag: component
                  value: node
                - tag: lxc
                  value: '{#LXC.NAME}'
                - tag: node
                  value: '{#NODE.NAME}'
            - uuid: 0f8d1c5b2a3e4b6c9f7d8e9a0b1c2d3e
              name: 'Node [{#NODE.NAME}]: LXC [{#LXC.NAME}]: Disk read speed'
              type: DEPENDENT
              key: 'proxmox_ve.node.lxc.disk.read[{#NODE.ID},{#LXC.VMID}]'
              units: Bps
              description: 'Retrieves disk read speed of the LXC container {#LXC.NAME} on the node {#NODE.NAME}.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.diskread
                  error_handler: DISCARD_VALUE
                - type: CHANGE_PER_SECOND
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 1h
              master_item:
                key: 'proxmox_ve.node.lxc[{#NODE.ID},{#LXC.VMID}]'
              tags:
                - tag: component
                  value: disk
                - tag: component
                  value: lxc
                - tag: component
                  value: node
                - tag: lxc
                  value: '{#LXC.NAME}'
                - tag: node
                  value: '{#NODE.NAME}'
            - uuid: 76b338628ded4225aca30a50b68bb196
              name: 'Node [{#NODE.NAME}]: LXC [{#LXC.NAME}]: Disk used'
              type: DEPENDENT
              key: 'proxmox_ve.node.lxc.disk.usage[{#NODE.ID},{#LXC.VMID}]'
              units: B
              description: 'Retrieves the Root disk usage of the LXC container {#LXC.NAME} on the node {#NODE.NAME}.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.disk
                  error_handler: DISCARD_VALUE
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 1h
              master_item:
                key: 'proxmox_ve.node.lxc[{#NODE.ID},{#LXC.VMID}]'
              tags:
                - tag: component
                  value: disk
                - tag: component
                  value: lxc
                - tag: component
                  value: node
                - tag: lxc
                  value: '{#LXC.NAME}'
                - tag: node
                  value: '{#NODE.NAME}'
            - uuid: 52b92e5ba31d4c27bafc3fe55e57687a
              name: 'Node [{#NODE.NAME}]: LXC [{#LXC.NAME}]: Disk utilization'
              type: CALCULATED
              key: 'proxmox_ve.node.lxc.disk.utilization[{#NODE.ID},{#LXC.VMID}]'
              value_type: FLOAT
              units: '%'
              params: 'last(//proxmox_ve.node.lxc.disk.usage[{#NODE.ID},{#LXC.VMID}]) / last(//proxmox_ve.node.lxc.disk.maxdisk[{#NODE.ID},{#LXC.VMID}]) * 100'
              description: 'Retrieves disk utilization of the LXC container {#LXC.NAME} on the node {#NODE.NAME}.'
              preprocessing:
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 1h
              tags:
                - tag: component
                  value: disk
                - tag: component
                  value: lxc
                - tag: component
                  value: node
                - tag: lxc
                  value: '{#LXC.NAME}'
                - tag: node
                  value: '{#NODE.NAME}'
              trigger_prototypes:
                - uuid: 8935456bef0f4a4ca20bca78e059b43d
                  expression: 'last(/Proxmox VE by HTTP/proxmox_ve.node.lxc.disk.utilization[{#NODE.ID},{#LXC.VMID}]) > {$PVE.TRIGGER.DISK.WARNING:"{#LXC.NAME}"}'
                  name: 'Proxmox VE: Node [{#NODE.NAME}]: LXC [{#LXC.NAME}]: Disk usage high'
                  priority: WARNING
                  description: 'The disk usage of the LXC container {#LXC.NAME} on the node {#NODE.NAME} is high.'
                  tags:
                    - tag: scope
                      value: notice
            - uuid: 06dee8adb3e848d89ab432a4db119e98
              name: 'Node [{#NODE.NAME}]: LXC [{#LXC.NAME}]: Disk write speed'
              type: DEPENDENT
              key: 'proxmox_ve.node.lxc.disk.write[{#NODE.ID},{#LXC.VMID}]'
              units: Bps
              description: 'Retrieves disk write speed of the LXC container {#LXC.NAME} on the node {#NODE.NAME}.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.diskwrite
                  error_handler: DISCARD_VALUE
                - type: CHANGE_PER_SECOND
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 1h
              master_item:
                key: 'proxmox_ve.node.lxc[{#NODE.ID},{#LXC.VMID}]'
              tags:
                - tag: component
                  value: disk
                - tag: component
                  value: lxc
                - tag: component
                  value: node
                - tag: lxc
                  value: '{#LXC.NAME}'
                - tag: node
                  value: '{#NODE.NAME}'
            - uuid: ee43a9fc7a894547a1cc639dc284c60f
              name: 'Node [{#NODE.NAME}]: LXC [{#LXC.NAME}]: Swap total'
              type: DEPENDENT
              key: 'proxmox_ve.node.lxc.maxswap[{#NODE.ID},{#LXC.VMID}]'
              units: B
              description: 'Retrieves the total swap of the LXC container {#LXC.NAME} on the node {#NODE.NAME}.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.maxswap
                  error_handler: DISCARD_VALUE
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 12h
              master_item:
                key: 'proxmox_ve.node.lxc[{#NODE.ID},{#LXC.VMID}]'
              tags:
                - tag: component
                  value: lxc
                - tag: component
                  value: node
                - tag: component
                  value: swap
                - tag: lxc
                  value: '{#LXC.NAME}'
                - tag: node
                  value: '{#NODE.NAME}'
            - uuid: d8130fa283bf46669f1900b571637a1f
              name: 'Node [{#NODE.NAME}]: LXC [{#LXC.NAME}]: Memory total'
              type: DEPENDENT
              key: 'proxmox_ve.node.lxc.memory.max[{#NODE.ID},{#LXC.VMID}]'
              units: B
              description: 'Retrieves the total memory of the LXC container {#LXC.NAME} on the node {#NODE.NAME}.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.maxmem
                  error_handler: DISCARD_VALUE
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 12h
              master_item:
                key: 'proxmox_ve.node.lxc[{#NODE.ID},{#LXC.VMID}]'
              tags:
                - tag: component
                  value: lxc
                - tag: component
                  value: memory
                - tag: component
                  value: node
                - tag: lxc
                  value: '{#LXC.NAME}'
                - tag: node
                  value: '{#NODE.NAME}'
            - uuid: f065a59f04ae4969ab572eee65b7d353
              name: 'Node [{#NODE.NAME}]: LXC [{#LXC.NAME}]: Memory used'
              type: DEPENDENT
              key: 'proxmox_ve.node.lxc.memory.usage[{#NODE.ID},{#LXC.VMID}]'
              units: B
              description: 'Retrieves the memory usage of the LXC container {#LXC.NAME} on the node {#NODE.NAME}.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.mem
                  error_handler: DISCARD_VALUE
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 1h
              master_item:
                key: 'proxmox_ve.node.lxc[{#NODE.ID},{#LXC.VMID}]'
              tags:
                - tag: component
                  value: lxc
                - tag: component
                  value: memory
                - tag: component
                  value: node
                - tag: lxc
                  value: '{#LXC.NAME}'
                - tag: node
                  value: '{#NODE.NAME}'
            - uuid: ba3c961aadf04103b6480c3f496e3d40
              name: 'Node [{#NODE.NAME}]: LXC [{#LXC.NAME}]: Memory utilization'
              type: CALCULATED
              key: 'proxmox_ve.node.lxc.memory.utilization[{#NODE.ID},{#LXC.VMID}]'
              value_type: FLOAT
              units: '%'
              params: 'last(//proxmox_ve.node.lxc.memory.usage[{#NODE.ID},{#LXC.VMID}]) / last(//proxmox_ve.node.lxc.memory.max[{#NODE.ID},{#LXC.VMID}]) * 100'
              description: 'Retrieves memory utilization of the LXC container {#LXC.NAME} on the node {#NODE.NAME}.'
              preprocessing:
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 1h
              tags:
                - tag: component
                  value: lxc
                - tag: component
                  value: memory
                - tag: component
                  value: node
                - tag: lxc
                  value: '{#LXC.NAME}'
                - tag: node
                  value: '{#NODE.NAME}'
              trigger_prototypes:
                - uuid: d61ff3c75f704105864a38f5442d1c19
                  expression: 'last(/Proxmox VE by HTTP/proxmox_ve.node.lxc.memory.utilization[{#NODE.ID},{#LXC.VMID}]) > {$PVE.TRIGGER.MEMORY.WARNING:"{#LXC.NAME}"}'
                  name: 'Proxmox VE: Node [{#NODE.NAME}]: LXC [{#LXC.NAME}]: Memory usage high'
                  priority: WARNING
                  description: 'The memory usage of the LXC container {#LXC.NAME} on the node {#NODE.NAME} is high.'
                  tags:
                    - tag: scope
                      value: notice
            - uuid: d9e7cf16eb0242a79a7c4d86e3a66da8
              name: 'Node [{#NODE.NAME}]: LXC [{#LXC.NAME}]: Network input speed'
              type: DEPENDENT
              key: 'proxmox_ve.node.lxc.network.input[{#NODE.ID},{#LXC.VMID}]'
              units: bps
              description: 'Retrieves network input speed of the LXC container {#LXC.NAME} on the node {#NODE.NAME}.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.netin
                  error_handler: DISCARD_VALUE
                - type: CHANGE_PER_SECOND
                - type: MULTIPLIER
                  parameters:
                    - '8'
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 1h
              master_item:
                key: 'proxmox_ve.node.lxc[{#NODE.ID},{#LXC.VMID}]'
              tags:
                - tag: component
                  value: lxc
                - tag: component
                  value: network
                - tag: component
                  value: node
                - tag: lxc
                  value: '{#LXC.NAME}'
                - tag: node
                  value: '{#NODE.NAME}'
            - uuid: cd38f921a8f84947a7e0619968914e00
              name: 'Node [{#NODE.NAME}]: LXC [{#LXC.NAME}]: Network output speed'
              type: DEPENDENT
              key: 'proxmox_ve.node.lxc.network.output[{#NODE.ID},{#LXC.VMID}]'
              units: bps
              description: 'Retrieves network output speed of the LXC container {#LXC.NAME} on the node {#NODE.NAME}.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.netout
                  error_handler: DISCARD_VALUE
                - type: CHANGE_PER_SECOND
                - type: MULTIPLIER
                  parameters:
                    - '8'
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 1h
              master_item:
                key: 'proxmox_ve.node.lxc[{#NODE.ID},{#LXC.VMID}]'
              tags:
                - tag: component
                  value: lxc
                - tag: component
                  value: network
                - tag: component
                  value: node
                - tag: lxc
                  value: '{#LXC.NAME}'
                - tag: node
                  value: '{#NODE.NAME}'
            - uuid: da080118db964798a7fec566eccaf574
              name: 'Node [{#NODE.NAME}]: LXC [{#LXC.NAME}]: Worked node'
              type: DEPENDENT
              key: 'proxmox_ve.node.lxc.node[{#NODE.ID},{#LXC.VMID}]'
              value_type: CHAR
              description: 'Retrieves the node where the LXC container {#LXC.NAME} is running.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$.data.lxc[?(@.vmid == "{#LXC.VMID}")].node.first()'
                  error_handler: DISCARD_VALUE
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 12h
              master_item:
                key: proxmox_ve.cluster.resources.get
              tags:
                - tag: component
                  value: lxc
                - tag: component
                  value: node
                - tag: lxc
                  value: '{#LXC.NAME}'
                - tag: node
                  value: '{#NODE.NAME}'
              trigger_prototypes:
                - uuid: e586b7afb1ee481e94ba3b9cbdc1031c
                  expression: 'last(/Proxmox VE by HTTP/proxmox_ve.node.lxc.node[{#NODE.ID},{#LXC.VMID}], #1) <> last(/Proxmox VE by HTTP/proxmox_ve.node.lxc.node[{#NODE.ID},{#LXC.VMID}], #2)'
                  name: 'Proxmox VE: Node [{#NODE.NAME}]: LXC [{#LXC.NAME}]: Changed worked node'
                  event_name: 'Proxmox VE: LXC [{#LXC.NAME}] changed worked node to "{ITEM.LASTVALUE}"'
                  priority: INFO
                  description: 'The LXC container {#LXC.NAME} migrated to another node.'
                  manual_close: 'YES'
                  tags:
                    - tag: scope
                      value: notice
            - uuid: 5a24f791a2444f429cbcb26037f29da1
              name: 'Node [{#NODE.NAME}]: LXC [{#LXC.NAME}]: Status'
              type: DEPENDENT
              key: 'proxmox_ve.node.lxc.status[{#NODE.ID},{#LXC.VMID}]'
              description: 'Retrieves the status of the LXC container {#LXC.NAME} on the node {#NODE.NAME}.'
              valuemap:
                name: 'Proxmox LXC/QEMU status'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.status
                  error_handler: CUSTOM_VALUE
                  error_handler_params: unknown
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 12h
                - type: JAVASCRIPT
                  parameters:
                    - |
                      const idx = {
                        'running': 2,
                        'stopped': 1,
                      };
                      
                      return typeof idx[value] === 'undefined' ? 0 : idx[value];
              master_item:
                key: 'proxmox_ve.node.lxc[{#NODE.ID},{#LXC.VMID}]'
              tags:
                - tag: component
                  value: lxc
                - tag: component
                  value: node
                - tag: lxc
                  value: '{#LXC.NAME}'
                - tag: node
                  value: '{#NODE.NAME}'
              trigger_prototypes:
                - uuid: da7614ac842b4d3c9d6e4538c0ec09bc
                  expression: 'last(/Proxmox VE by HTTP/proxmox_ve.node.lxc.status[{#NODE.ID},{#LXC.VMID}]) <> 2'
                  name: 'Proxmox VE: Node [{#NODE.NAME}]: LXC [{#LXC.NAME}]: Not running'
                  priority: WARNING
                  description: 'The LXC container {#LXC.NAME} on the node {#NODE.NAME} is not running.'
                  manual_close: 'YES'
                  tags:
                    - tag: scope
                      value: notice
            - uuid: 440db0f97f3c4639a9e8ceb8bc633cb5
              name: 'Node [{#NODE.NAME}]: LXC [{#LXC.NAME}]: Swap used'
              type: DEPENDENT
              key: 'proxmox_ve.node.lxc.swap.usage[{#NODE.ID},{#LXC.VMID}]'
              units: B
              description: 'Retrieves the swap usage of the LXC container {#LXC.NAME} on the node {#NODE.NAME}.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.swap
                  error_handler: DISCARD_VALUE
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 1h
              master_item:
                key: 'proxmox_ve.node.lxc[{#NODE.ID},{#LXC.VMID}]'
              tags:
                - tag: component
                  value: lxc
                - tag: component
                  value: node
                - tag: component
                  value: swap
                - tag: lxc
                  value: '{#LXC.NAME}'
                - tag: node
                  value: '{#NODE.NAME}'
            - uuid: 17ee49333f0346d5b1073a4c45475dee
              name: 'Node [{#NODE.NAME}]: LXC [{#LXC.NAME}]: Uptime'
              type: DEPENDENT
              key: 'proxmox_ve.node.lxc.uptime[{#NODE.ID},{#LXC.VMID}]'
              units: uptime
              description: 'Retrieves the uptime of the LXC container {#LXC.NAME} on the node {#NODE.NAME}.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.uptime
                  error_handler: DISCARD_VALUE
              master_item:
                key: 'proxmox_ve.node.lxc[{#NODE.ID},{#LXC.VMID}]'
              tags:
                - tag: component
                  value: lxc
                - tag: component
                  value: node
                - tag: component
                  value: uptime
                - tag: lxc
                  value: '{#LXC.NAME}'
                - tag: node
                  value: '{#NODE.NAME}'
              trigger_prototypes:
                - uuid: 12bc18cf9e2e40e5879a4b58efad70a2
                  expression: 'last(/Proxmox VE by HTTP/proxmox_ve.node.lxc.uptime[{#NODE.ID},{#LXC.VMID}]) < {$PVE.TRIGGER.UPTIME:"{#LXC.NAME}"}'
                  name: 'Proxmox VE: Node [{#NODE.NAME}]: LXC [{#LXC.NAME}]: Has been restarted'
                  priority: WARNING
                  description: 'The LXC container {#LXC.NAME} on the node {#NODE.NAME} has been restarted.'
                  dependencies:
                    - name: 'Proxmox VE: Node [{#NODE.NAME}]: LXC [{#LXC.NAME}]: Not running'
                      expression: 'last(/Proxmox VE by HTTP/proxmox_ve.node.lxc.status[{#NODE.ID},{#LXC.VMID}]) <> 2'
                  tags:
                    - tag: scope
                      value: notice
            - uuid: 9c0b4b8892a44c1c8a34e6a802c89d2f
              name: 'Node [{#NODE.NAME}]: LXC [{#LXC.NAME}]: Get info'
              type: HTTP_AGENT
              key: 'proxmox_ve.node.lxc[{#NODE.ID},{#LXC.VMID}]'
              history: '0'
              value_type: TEXT
              description: 'Retrieves information about the LXC container {#LXC.NAME} on the node {#NODE.NAME}.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.data
                  error_handler: CUSTOM_VALUE
                  error_handler_params: '{}'
              timeout: '10'
              url: 'https://{$PVE.URL.HOST}:{$PVE.URL.PORT}/api2/json//nodes/{#NODE.NAME}/lxc/{#LXC.VMID}/status/current'
              status_codes: '200,500,595'
              http_proxy: '{$PVE.PROXY}'
              headers:
                - name: Authorization
                  value: 'PVEAPIToken={$PVE.TOKEN.ID}={$PVE.TOKEN.SECRET}'
              tags:
                - tag: component
                  value: raw
          trigger_prototypes:
            - uuid: 11307aab09fa406aaff00e291e2338d2
              expression: 'avg(/Proxmox VE by HTTP/proxmox_ve.node.lxc.swap.usage[{#NODE.ID},{#LXC.VMID}],5m) / last(/Proxmox VE by HTTP/proxmox_ve.node.lxc.maxswap[{#NODE.ID},{#LXC.VMID}]) * 100 > {$PVE.TRIGGER.SWAP.WARNING:"{#LXC.NAME}"}'
              name: 'Proxmox VE: Node [{#NODE.NAME}]: LXC [{#LXC.NAME}]: Swap usage high'
              priority: WARNING
              description: 'The swap usage of the LXC container {#LXC.NAME} on the node {#NODE.NAME} is high.'
              tags:
                - tag: scope
                  value: notice
          graph_prototypes:
            - uuid: 703372918f4a4f47bc9cab580d73d209
              name: 'Node [{#NODE.NAME}]: LXC [{#LXC.NAME}/{#LXC.VMID}]: CPU utilization'
              graph_items:
                - color: ff0000
                  item:
                    host: 'Proxmox VE by HTTP'
                    key: 'proxmox_ve.node.lxc.cpu[{#NODE.ID},{#LXC.VMID}]'
            - uuid: e3824333db624de6802194b13ee6cafe
              name: 'Node [{#NODE.NAME}]: LXC [{#LXC.NAME}/{#LXC.VMID}]: Disk read speed'
              graph_items:
                - color: 2600ff
                  item:
                    host: 'Proxmox VE by HTTP'
                    key: 'proxmox_ve.node.lxc.disk.read[{#NODE.ID},{#LXC.VMID}]'
                - sortorder: '1'
                  color: 00ff00
                  item:
                    host: 'Proxmox VE by HTTP'
                    key: 'proxmox_ve.node.lxc.disk.write[{#NODE.ID},{#LXC.VMID}]'
            - uuid: ef81ffcc73cd4c8295caccf7dff1a09e
              name: 'Node [{#NODE.NAME}]: LXC [{#LXC.NAME}/{#LXC.VMID}]: Disk used'
              graph_items:
                - color: ff0000
                  item:
                    host: 'Proxmox VE by HTTP'
                    key: 'proxmox_ve.node.lxc.disk.usage[{#NODE.ID},{#LXC.VMID}]'
                - sortorder: '1'
                  drawtype: GRADIENT_LINE
                  color: 00ff00
                  item:
                    host: 'Proxmox VE by HTTP'
                    key: 'proxmox_ve.node.lxc.disk.maxdisk[{#NODE.ID},{#LXC.VMID}]'
            - uuid: 35c458a6feae4d7aa451ade81eb8664e
              name: 'Node [{#NODE.NAME}]: LXC [{#LXC.NAME}/{#LXC.VMID}]: Memory used'
              graph_items:
                - color: ff0000
                  item:
                    host: 'Proxmox VE by HTTP'
                    key: 'proxmox_ve.node.lxc.memory.usage[{#NODE.ID},{#LXC.VMID}]'
                - sortorder: '1'
                  drawtype: GRADIENT_LINE
                  color: 00ff00
                  item:
                    host: 'Proxmox VE by HTTP'
                    key: 'proxmox_ve.node.lxc.memory.max[{#NODE.ID},{#LXC.VMID}]'
            - uuid: 3935a5b9c4384f76a7b50fc1063392b0
              name: 'Node [{#NODE.NAME}]: LXC [{#LXC.NAME}/{#LXC.VMID}]: Network speed'
              graph_items:
                - color: 2600ff
                  item:
                    host: 'Proxmox VE by HTTP'
                    key: 'proxmox_ve.node.lxc.network.input[{#NODE.ID},{#LXC.VMID}]'
                - sortorder: '1'
                  color: 00ff00
                  item:
                    host: 'Proxmox VE by HTTP'
                    key: 'proxmox_ve.node.lxc.network.output[{#NODE.ID},{#LXC.VMID}]'
            - uuid: 2086bbe1f89a45ab9e8d8d15b883bc67
              name: 'Node [{#NODE.NAME}]: LXC [{#LXC.NAME}/{#LXC.VMID}]: Swap used'
              graph_items:
                - color: ff0000
                  item:
                    host: 'Proxmox VE by HTTP'
                    key: 'proxmox_ve.node.lxc.swap.usage[{#NODE.ID},{#LXC.VMID}]'
                - sortorder: '1'
                  drawtype: GRADIENT_LINE
                  color: 00ff00
                  item:
                    host: 'Proxmox VE by HTTP'
                    key: 'proxmox_ve.node.lxc.maxswap[{#NODE.ID},{#LXC.VMID}]'
          master_item:
            key: proxmox_ve.cluster.resources.get
          lld_macro_paths:
            - lld_macro: '{#LXC.NAME}'
              path: $.name
            - lld_macro: '{#LXC.STATUS}'
              path: $.status
            - lld_macro: '{#LXC.VMID}'
              path: $.vmid
            - lld_macro: '{#NODE.NAME}'
              path: $.node
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.data.lxc
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 12h
        - uuid: c9e463381b924dafbf88cea373b3fe50
          name: 'Proxmox QEMU discovery'
          type: DEPENDENT
          key: 'proxmox_ve.node.qemu.discovery[{#NODE.ID}]'
          filter:
            evaltype: AND
            conditions:
              - macro: '{#QEMU.NAME}'
                value: '{$PVE.FILTER.QEMU.MATCH}'
              - macro: '{#QEMU.NAME}'
                value: '{$PVE.FILTER.QEMU.NOTMATCH}'
                operator: NOT_MATCHES_REGEX
              - macro: '{#QEMU.STATUS}'
                value: '{$PVE.FILTER.QEMULXC.STATUS.MATCH}'
          description: 'Discovers QEMU virtual machines on the node {#NODE.NAME}.'
          item_prototypes:
            - uuid: ff60e7840528434996b2e28b80ea151d
              name: 'Node [{#NODE.NAME}]: QEMU [{#QEMU.NAME}]: Guest agent version'
              type: HTTP_AGENT
              key: 'proxmox_ve.node.qemu.agent.version[{#NODE.ID},{#QEMU.VMID}]'
              delay: 12h
              value_type: CHAR
              description: 'Retrieves the QEMU guest agent version for the virtual machine {#QEMU.NAME} on the node {#NODE.NAME}.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.data.result.version
                  error_handler: CUSTOM_VALUE
                  error_handler_params: Unknown
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 12h
              timeout: '10'
              url: 'https://{$PVE.URL.HOST}:{$PVE.URL.PORT}/api2/json//nodes/{#NODE.NAME}/qemu/{#QEMU.VMID}/agent/info'
              status_codes: '200,500,595'
              http_proxy: '{$PVE.PROXY}'
              headers:
                - name: Authorization
                  value: 'PVEAPIToken={$PVE.TOKEN.ID}={$PVE.TOKEN.SECRET}'
              tags:
                - tag: component
                  value: node
                - tag: component
                  value: qemu
                - tag: node
                  value: '{#NODE.NAME}'
                - tag: qemu
                  value: '{#QEMU.NAME}'
              trigger_prototypes:
                - uuid: 757fba13cb1f43af9c8033c8462322e4
                  expression: 'last(/Proxmox VE by HTTP/proxmox_ve.node.qemu.agent.version[{#NODE.ID},{#QEMU.VMID}])="Unknown"'
                  name: 'Proxmox VE: Node [{#NODE.NAME}]: QEMU [{#QEMU.NAME}]: Error getting guest agent data'
                  priority: WARNING
                  description: |
                    Error retrieving the QEMU guest agent data for the virtual machine {#QEMU.NAME} on the node {#NODE.NAME}.
                    The guest agent may not be running.
                  dependencies:
                    - name: 'Proxmox VE: Node [{#NODE.NAME}]: QEMU [{#QEMU.NAME}]: Agent is not enabled'
                      expression: 'last(/Proxmox VE by HTTP/proxmox_ve.node.qemu.agent[{#NODE.ID},{#QEMU.VMID}]) <> 1'
                  tags:
                    - tag: scope
                      value: notice
            - uuid: a73999de348a4d79ae7ec582c2550ce2
              name: 'Node [{#NODE.NAME}]: QEMU [{#QEMU.NAME}]: Guest agent'
              type: DEPENDENT
              key: 'proxmox_ve.node.qemu.agent[{#NODE.ID},{#QEMU.VMID}]'
              description: 'Retrieves the QEMU guest agent status for the virtual machine {#QEMU.NAME} on the node {#NODE.NAME}.'
              valuemap:
                name: 'Proxmox QEMU agent status'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.agent
                  error_handler: CUSTOM_VALUE
                  error_handler_params: '3'
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 12h
              master_item:
                key: 'proxmox_ve.node.qemu[{#NODE.ID},{#QEMU.VMID}]'
              tags:
                - tag: component
                  value: node
                - tag: component
                  value: qemu
                - tag: node
                  value: '{#NODE.NAME}'
                - tag: qemu
                  value: '{#QEMU.NAME}'
              trigger_prototypes:
                - uuid: e9f788fde7bc484eb964b4d6bfa5e293
                  expression: 'last(/Proxmox VE by HTTP/proxmox_ve.node.qemu.agent[{#NODE.ID},{#QEMU.VMID}]) <> 1'
                  name: 'Proxmox VE: Node [{#NODE.NAME}]: QEMU [{#QEMU.NAME}]: Agent is not enabled'
                  priority: INFO
                  description: 'The QEMU guest agent for the virtual machine {#QEMU.NAME} on the node {#NODE.NAME} is not enabled.'
                  tags:
                    - tag: scope
                      value: notice
            - uuid: ff45514952424922b46f2acfd548036d
              name: 'Node [{#NODE.NAME}]: QEMU [{#QEMU.NAME}]: CPU count'
              type: DEPENDENT
              key: 'proxmox_ve.node.qemu.cpu.count[{#NODE.ID},{#QEMU.VMID}]'
              description: 'Retrieves CPU count of the QEMU virtual machine {#QEMU.NAME} on the node {#NODE.NAME}.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.cpus
                  error_handler: DISCARD_VALUE
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 12h
              master_item:
                key: 'proxmox_ve.node.qemu[{#NODE.ID},{#QEMU.VMID}]'
              tags:
                - tag: component
                  value: cpu
                - tag: component
                  value: node
                - tag: component
                  value: qemu
                - tag: node
                  value: '{#NODE.NAME}'
                - tag: qemu
                  value: '{#QEMU.NAME}'
            - uuid: 1c8f0b2d3e4f4a5b8c9d0e1f2a3b4c5d
              name: 'Node [{#NODE.NAME}]: QEMU [{#QEMU.NAME}]: CPU utilization'
              type: DEPENDENT
              key: 'proxmox_ve.node.qemu.cpu.usage[{#NODE.ID},{#QEMU.VMID}]'
              value_type: FLOAT
              units: '%'
              description: 'Retrieves the QEMU CPU utilization for the virtual machine {#QEMU.NAME} on the node {#NODE.NAME}.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.cpu
                  error_handler: DISCARD_VALUE
                - type: MULTIPLIER
                  parameters:
                    - '100'
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 1h
              master_item:
                key: 'proxmox_ve.node.qemu[{#NODE.ID},{#QEMU.VMID}]'
              tags:
                - tag: component
                  value: cpu
                - tag: component
                  value: node
                - tag: component
                  value: qemu
                - tag: node
                  value: '{#NODE.NAME}'
                - tag: qemu
                  value: '{#QEMU.NAME}'
              trigger_prototypes:
                - uuid: 854a8816d577453fabf606fa8eb35304
                  expression: 'avg(/Proxmox VE by HTTP/proxmox_ve.node.qemu.cpu.usage[{#NODE.ID},{#QEMU.VMID}], 5m) > {$PVE.TRIGGER.CPU.WARNING:"{#QEMU.NAME}"}'
                  name: 'Proxmox VE: Node [{#NODE.NAME}]: QEMU [{#QEMU.NAME}]: CPU utilization high'
                  priority: WARNING
                  description: 'The CPU utilization of the QEMU virtual machine {#QEMU.NAME} on the node {#NODE.NAME} is high.'
                  tags:
                    - tag: scope
                      value: notice
            - uuid: 0d1dc0c895e94003b9874e4839707cef
              name: 'Node [{#NODE.NAME}]: QEMU [{#QEMU.NAME}]: Disk read speed'
              type: DEPENDENT
              key: 'proxmox_ve.node.qemu.disk.read[{#NODE.ID},{#QEMU.VMID}]'
              units: Bps
              description: 'Retrieves disk read speed of the QEMU virtual machine {#QEMU.NAME} on the node {#NODE.NAME}.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.diskread
                  error_handler: DISCARD_VALUE
                - type: CHANGE_PER_SECOND
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 1h
              master_item:
                key: 'proxmox_ve.node.qemu[{#NODE.ID},{#QEMU.VMID}]'
              tags:
                - tag: component
                  value: disk
                - tag: component
                  value: node
                - tag: component
                  value: qemu
                - tag: node
                  value: '{#NODE.NAME}'
                - tag: qemu
                  value: '{#QEMU.NAME}'
            - uuid: e3e9d0b1b3114d0199576cb92b4bd811
              name: 'Node [{#NODE.NAME}]: QEMU [{#QEMU.NAME}]: Disk write speed'
              type: DEPENDENT
              key: 'proxmox_ve.node.qemu.disk.write[{#NODE.ID},{#QEMU.VMID}]'
              units: Bps
              description: 'Retrieves disk write speed of the QEMU virtual machine {#QEMU.NAME} on the node {#NODE.NAME}.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.diskwrite
                  error_handler: DISCARD_VALUE
                - type: CHANGE_PER_SECOND
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 1h
              master_item:
                key: 'proxmox_ve.node.qemu[{#NODE.ID},{#QEMU.VMID}]'
              tags:
                - tag: component
                  value: disk
                - tag: component
                  value: node
                - tag: component
                  value: qemu
                - tag: node
                  value: '{#NODE.NAME}'
                - tag: qemu
                  value: '{#QEMU.NAME}'
            - uuid: bad696385bb743d98604ce6e769438d2
              name: 'Node [{#NODE.NAME}]: QEMU [{#QEMU.NAME}]: Memory total'
              type: DEPENDENT
              key: 'proxmox_ve.node.qemu.memory.maxmem[{#NODE.ID},{#QEMU.VMID}]'
              units: B
              description: 'Retrieves the total memory of the QEMU virtual machine {#QEMU.NAME} on the node {#NODE.NAME}.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.maxmem
                  error_handler: DISCARD_VALUE
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 12h
              master_item:
                key: 'proxmox_ve.node.qemu[{#NODE.ID},{#QEMU.VMID}]'
              tags:
                - tag: component
                  value: memory
                - tag: component
                  value: node
                - tag: component
                  value: qemu
                - tag: node
                  value: '{#NODE.NAME}'
                - tag: qemu
                  value: '{#QEMU.NAME}'
            - uuid: c2471ee3018e4e2fb75b52f4af3a5929
              name: 'Node [{#NODE.NAME}]: QEMU [{#QEMU.NAME}]: Memory used'
              type: DEPENDENT
              key: 'proxmox_ve.node.qemu.memory.usage[{#NODE.ID},{#QEMU.VMID}]'
              units: B
              description: 'Retrieves the memory usage of the QEMU virtual machine {#QEMU.NAME} on the node {#NODE.NAME}.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.mem
                  error_handler: DISCARD_VALUE
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 1h
              master_item:
                key: 'proxmox_ve.node.qemu[{#NODE.ID},{#QEMU.VMID}]'
              tags:
                - tag: component
                  value: memory
                - tag: component
                  value: node
                - tag: component
                  value: qemu
                - tag: node
                  value: '{#NODE.NAME}'
                - tag: qemu
                  value: '{#QEMU.NAME}'
            - uuid: b72d9654decf4bb998386c11892fe137
              name: 'Node [{#NODE.NAME}]: QEMU [{#QEMU.NAME}]: Memory utilization'
              type: CALCULATED
              key: 'proxmox_ve.node.qemu.memory.utilization[{#NODE.ID},{#QEMU.VMID}]'
              value_type: FLOAT
              units: '%'
              params: 'last(//proxmox_ve.node.qemu.memory.usage[{#NODE.ID},{#QEMU.VMID}]) / last(//proxmox_ve.node.qemu.memory.maxmem[{#NODE.ID},{#QEMU.VMID}]) * 100'
              description: 'Retrieves memory utilization of the QEMU virtual machine {#QEMU.NAME} on the node {#NODE.NAME}.'
              preprocessing:
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 1h
              tags:
                - tag: component
                  value: memory
                - tag: component
                  value: node
                - tag: component
                  value: qemu
                - tag: node
                  value: '{#NODE.NAME}'
                - tag: qemu
                  value: '{#QEMU.NAME}'
              trigger_prototypes:
                - uuid: 88fecebb47ec4af89ea2d0f458e25b64
                  expression: 'avg(/Proxmox VE by HTTP/proxmox_ve.node.qemu.memory.utilization[{#NODE.ID},{#QEMU.VMID}],5m) > {$PVE.TRIGGER.MEMORY.WARNING:"{#QEMU.NAME}"}'
                  name: 'Proxmox VE: Node [{#NODE.NAME}]: QEMU [{#QEMU.NAME}]: Memory usage high'
                  priority: WARNING
                  description: 'The memory usage of the QEMU virtual machine {#QEMU.NAME} on the node {#NODE.NAME} is high.'
                  tags:
                    - tag: scope
                      value: notice
            - uuid: d112f6a55e484f3f816f20f7768a9e3e
              name: 'Node [{#NODE.NAME}]: QEMU [{#QEMU.NAME}]: Network input speed'
              type: DEPENDENT
              key: 'proxmox_ve.node.qemu.network.input[{#NODE.ID},{#QEMU.VMID}]'
              units: bps
              description: 'Retrieves network input speed of the QEMU virtual machine {#QEMU.NAME} on the node {#NODE.NAME}.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.netin
                  error_handler: DISCARD_VALUE
                - type: CHANGE_PER_SECOND
                - type: MULTIPLIER
                  parameters:
                    - '8'
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 1h
              master_item:
                key: 'proxmox_ve.node.qemu[{#NODE.ID},{#QEMU.VMID}]'
              tags:
                - tag: component
                  value: network
                - tag: component
                  value: node
                - tag: component
                  value: qemu
                - tag: node
                  value: '{#NODE.NAME}'
                - tag: qemu
                  value: '{#QEMU.NAME}'
            - uuid: e8344592bc0b40aa91528af2a2c4bd15
              name: 'Node [{#NODE.NAME}]: QEMU [{#QEMU.NAME}]: Network output speed'
              type: DEPENDENT
              key: 'proxmox_ve.node.qemu.network.output[{#NODE.ID},{#QEMU.VMID}]'
              units: bps
              description: 'Retrieves network output speed of the QEMU virtual machine {#QEMU.NAME} on the node {#NODE.NAME}.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.netout
                  error_handler: DISCARD_VALUE
                - type: CHANGE_PER_SECOND
                - type: MULTIPLIER
                  parameters:
                    - '8'
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 1h
              master_item:
                key: 'proxmox_ve.node.qemu[{#NODE.ID},{#QEMU.VMID}]'
              tags:
                - tag: component
                  value: network
                - tag: component
                  value: node
                - tag: component
                  value: qemu
                - tag: node
                  value: '{#NODE.NAME}'
                - tag: qemu
                  value: '{#QEMU.NAME}'
            - uuid: bbdf2640ea1e43a897da5d76f373fc80
              name: 'Node [{#NODE.NAME}]: QEMU [{#QEMU.NAME}]: Worked node'
              type: DEPENDENT
              key: 'proxmox_ve.node.qemu.node[{#NODE.ID},{#QEMU.VMID}]'
              value_type: CHAR
              description: 'Retrieves the node where the QEMU virtual machine {#QEMU.NAME} is running.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$.data.qemu[?(@.vmid == "{#QEMU.VMID}")].node.first()'
                  error_handler: DISCARD_VALUE
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 12h
              master_item:
                key: proxmox_ve.cluster.resources.get
              tags:
                - tag: component
                  value: node
                - tag: component
                  value: qemu
                - tag: node
                  value: '{#NODE.NAME}'
                - tag: qemu
                  value: '{#QEMU.NAME}'
              trigger_prototypes:
                - uuid: a02742905e2c4fbdb2f582d0b1905ee6
                  expression: 'last(/Proxmox VE by HTTP/proxmox_ve.node.qemu.node[{#NODE.ID},{#QEMU.VMID}], #1) <> last(/Proxmox VE by HTTP/proxmox_ve.node.qemu.node[{#NODE.ID},{#QEMU.VMID}], #2)'
                  name: 'Proxmox VE: Node [{#NODE.NAME}]: QEMU [{#QEMU.NAME}]: Changed worked node'
                  event_name: 'Proxmox VE: QEMU [{#QEMU.NAME}] changed worked node to "{ITEM.LASTVALUE}"'
                  priority: INFO
                  description: 'The QEMU virtual machine {#QEMU.NAME} migrated to another node.'
                  manual_close: 'YES'
                  tags:
                    - tag: scope
                      value: notice
            - uuid: 70dd2565afe54dc9b77a7c49f4ef82c1
              name: 'Node [{#NODE.NAME}]: QEMU [{#QEMU.NAME}]: Status'
              type: DEPENDENT
              key: 'proxmox_ve.node.qemu.status[{#NODE.ID},{#QEMU.VMID}]'
              description: 'Retrieves the status of the QEMU virtual machine {#QEMU.NAME} on the node {#NODE.NAME}.'
              valuemap:
                name: 'Proxmox LXC/QEMU status'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.status
                  error_handler: CUSTOM_VALUE
                  error_handler_params: unknown
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 1h
                - type: JAVASCRIPT
                  parameters:
                    - |
                      const idx = {
                        'running': 2,
                        'stopped': 1,
                      };
                      
                      return typeof idx[value] === 'undefined' ? 0 : idx[value];
              master_item:
                key: 'proxmox_ve.node.qemu[{#NODE.ID},{#QEMU.VMID}]'
              tags:
                - tag: component
                  value: node
                - tag: component
                  value: qemu
                - tag: node
                  value: '{#NODE.NAME}'
                - tag: qemu
                  value: '{#QEMU.NAME}'
              trigger_prototypes:
                - uuid: 692bf9da2b484abea039746735cefd48
                  expression: 'last(/Proxmox VE by HTTP/proxmox_ve.node.qemu.status[{#NODE.ID},{#QEMU.VMID}]) <> 2'
                  name: 'Proxmox VE: Node [{#NODE.NAME}]: QEMU [{#QEMU.NAME}]: Not running'
                  priority: WARNING
                  description: 'The QEMU virtual machine {#QEMU.NAME} on the node {#NODE.NAME} is not running.'
                  tags:
                    - tag: scope
                      value: notice
            - uuid: ed946713280f4cf89d6bdc7f258618b7
              name: 'Node [{#NODE.NAME}]: QEMU [{#QEMU.NAME}]: Time zone'
              type: HTTP_AGENT
              key: 'proxmox_ve.node.qemu.timezone[{#NODE.ID},{#QEMU.VMID}]'
              delay: 12h
              value_type: CHAR
              description: 'Retrieves the system timezone of the QEMU virtual machine {#QEMU.NAME} on the node {#NODE.NAME}.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.data.result.zone
                  error_handler: CUSTOM_VALUE
                  error_handler_params: Unknown
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 12h
              timeout: '10'
              url: 'https://{$PVE.URL.HOST}:{$PVE.URL.PORT}/api2/json//nodes/{#NODE.NAME}/qemu/{#QEMU.VMID}/agent/get-timezone'
              status_codes: '200,500,595'
              http_proxy: '{$PVE.PROXY}'
              headers:
                - name: Authorization
                  value: 'PVEAPIToken={$PVE.TOKEN.ID}={$PVE.TOKEN.SECRET}'
              tags:
                - tag: component
                  value: node
                - tag: component
                  value: qemu
                - tag: component
                  value: time
                - tag: node
                  value: '{#NODE.NAME}'
                - tag: qemu
                  value: '{#QEMU.NAME}'
            - uuid: c1b4a1af4238431db864d4bff66b1c9c
              name: 'Node [{#NODE.NAME}]: QEMU [{#QEMU.NAME}]: Time'
              type: HTTP_AGENT
              key: 'proxmox_ve.node.qemu.time[{#NODE.ID},{#QEMU.VMID}]'
              delay: 10m
              value_type: FLOAT
              units: unixtime
              description: 'Retrieves the system time of the QEMU virtual machine {#QEMU.NAME} on the node {#NODE.NAME}.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.data.result
                  error_handler: DISCARD_VALUE
                - type: MULTIPLIER
                  parameters:
                    - '1.0E-9'
              timeout: '10'
              url: 'https://{$PVE.URL.HOST}:{$PVE.URL.PORT}/api2/json//nodes/{#NODE.NAME}/qemu/{#QEMU.VMID}/agent/get-time'
              status_codes: '200,500,595'
              http_proxy: '{$PVE.PROXY}'
              headers:
                - name: Authorization
                  value: 'PVEAPIToken={$PVE.TOKEN.ID}={$PVE.TOKEN.SECRET}'
              tags:
                - tag: component
                  value: node
                - tag: component
                  value: qemu
                - tag: component
                  value: time
                - tag: node
                  value: '{#NODE.NAME}'
                - tag: qemu
                  value: '{#QEMU.NAME}'
            - uuid: 2e978c24fadb4f7eb0157d883c7d3bfb
              name: 'Node [{#NODE.NAME}]: QEMU [{#QEMU.NAME}]: Uptime'
              type: DEPENDENT
              key: 'proxmox_ve.node.qemu.uptime[{#NODE.ID},{#QEMU.VMID}]'
              units: uptime
              description: 'Retrieves the uptime of the QEMU virtual machine {#QEMU.NAME} on the node {#NODE.NAME}.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.uptime
                  error_handler: DISCARD_VALUE
              master_item:
                key: 'proxmox_ve.node.qemu[{#NODE.ID},{#QEMU.VMID}]'
              tags:
                - tag: component
                  value: node
                - tag: component
                  value: qemu
                - tag: component
                  value: uptime
                - tag: node
                  value: '{#NODE.NAME}'
                - tag: qemu
                  value: '{#QEMU.NAME}'
              trigger_prototypes:
                - uuid: 8c9c94cbdd8b491280faff5bc6f10b41
                  expression: 'last(/Proxmox VE by HTTP/proxmox_ve.node.qemu.uptime[{#NODE.ID},{#QEMU.VMID}]) < {$PVE.TRIGGER.UPTIME:"{#QEMU.NAME}"}'
                  name: 'Proxmox VE: Node [{#NODE.NAME}]: QEMU [{#QEMU.NAME}]: Has been restarted'
                  priority: WARNING
                  description: 'The QEMU virtual machine {#QEMU.NAME} on the node {#NODE.NAME} has been restarted.'
                  dependencies:
                    - name: 'Proxmox VE: Node [{#NODE.NAME}]: QEMU [{#QEMU.NAME}]: Not running'
                      expression: 'last(/Proxmox VE by HTTP/proxmox_ve.node.qemu.status[{#NODE.ID},{#QEMU.VMID}]) <> 2'
                  tags:
                    - tag: scope
                      value: notice
            - uuid: 49287abe4f694a9895cbb66adf275bde
              name: 'Node [{#NODE.NAME}]: QEMU [{#QEMU.NAME}]: Get info'
              type: HTTP_AGENT
              key: 'proxmox_ve.node.qemu[{#NODE.ID},{#QEMU.VMID}]'
              history: '0'
              value_type: TEXT
              description: 'Retrieves information about the QEMU virtual machine {#QEMU.NAME} on the node {#NODE.NAME}.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.data
                  error_handler: CUSTOM_VALUE
                  error_handler_params: '{}'
              timeout: '10'
              url: 'https://{$PVE.URL.HOST}:{$PVE.URL.PORT}/api2/json//nodes/{#NODE.NAME}/qemu/{#QEMU.VMID}/status/current'
              status_codes: '200,500,595'
              http_proxy: '{$PVE.PROXY}'
              headers:
                - name: Authorization
                  value: 'PVEAPIToken={$PVE.TOKEN.ID}={$PVE.TOKEN.SECRET}'
              tags:
                - tag: component
                  value: raw
          graph_prototypes:
            - uuid: e9fb079bd82b4644acea529990dec8a3
              name: 'Node [{#NODE.NAME}]: QEMU [{#QEMU.NAME}/{#QEMU.VMID}]: CPU utilization'
              graph_items:
                - color: ff0000
                  item:
                    host: 'Proxmox VE by HTTP'
                    key: 'proxmox_ve.node.qemu.cpu.usage[{#NODE.ID},{#QEMU.VMID}]'
            - uuid: 3d8f0b2d3e4f4a5b8c9d0e1f2a3b4c5f
              name: 'Node [{#NODE.NAME}]: QEMU [{#QEMU.NAME}/{#QEMU.VMID}]: Disk read speed'
              graph_items:
                - color: 2600ff
                  item:
                    host: 'Proxmox VE by HTTP'
                    key: 'proxmox_ve.node.qemu.disk.read[{#NODE.ID},{#QEMU.VMID}]'
                - sortorder: '1'
                  color: 00ff00
                  item:
                    host: 'Proxmox VE by HTTP'
                    key: 'proxmox_ve.node.qemu.disk.write[{#NODE.ID},{#QEMU.VMID}]'
            - uuid: ba9b128b524e41a0a130b747daa90262
              name: 'Node [{#NODE.NAME}]: QEMU [{#QEMU.NAME}/{#QEMU.VMID}]: Memory used'
              graph_items:
                - color: ff0000
                  item:
                    host: 'Proxmox VE by HTTP'
                    key: 'proxmox_ve.node.qemu.memory.usage[{#NODE.ID},{#QEMU.VMID}]'
                - sortorder: '1'
                  drawtype: GRADIENT_LINE
                  color: 00ff00
                  item:
                    host: 'Proxmox VE by HTTP'
                    key: 'proxmox_ve.node.qemu.memory.maxmem[{#NODE.ID},{#QEMU.VMID}]'
            - uuid: f200d341935549c798ace87b105321f0
              name: 'Node [{#NODE.NAME}]: QEMU [{#QEMU.NAME}/{#QEMU.VMID}]: Network speed'
              graph_items:
                - color: 2600ff
                  item:
                    host: 'Proxmox VE by HTTP'
                    key: 'proxmox_ve.node.qemu.network.input[{#NODE.ID},{#QEMU.VMID}]'
                - sortorder: '1'
                  color: 00ff00
                  item:
                    host: 'Proxmox VE by HTTP'
                    key: 'proxmox_ve.node.qemu.network.output[{#NODE.ID},{#QEMU.VMID}]'
          master_item:
            key: proxmox_ve.cluster.resources.get
          lld_macro_paths:
            - lld_macro: '{#NODE.NAME}'
              path: $.node
            - lld_macro: '{#QEMU.NAME}'
              path: $.name
            - lld_macro: '{#QEMU.STATUS}'
              path: $.status
            - lld_macro: '{#QEMU.VMID}'
              path: $.vmid
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.data.qemu
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 12h
        - uuid: 3e39886146c24b3e82d57ac347495c5c
          name: 'Node [{#NODE.NAME}]: QEMU [{#QEMU.NAME}]: Filesystem discovery'
          type: HTTP_AGENT
          key: 'proxmox_ve.node.qemu.filesystem.discovery[{#NODE.ID},{#QEMU.VMID}]'
          delay: '{$PVE.PARAMS.INTERVAL.QEMU.FS}'
          filter:
            evaltype: AND
            conditions:
              - macro: '{#QEMU.FS.MOUNTPOINT}'
                value: '{$PVE.FILTER.QEMU.FS.MOUNT_POINT.MATCH}'
              - macro: '{#QEMU.FS.MOUNTPOINT}'
                value: '{$PVE.FILTER.QEMU.FS.MOUNT_POINT.NOTMATCH}'
                operator: NOT_MATCHES_REGEX
              - macro: '{#QEMU.FS.TYPE}'
                value: '{$PVE.FILTER.QEMU.FS.TYPE.MATCH}'
              - macro: '{#QEMU.FS.TYPE}'
                value: '{$PVE.FILTER.QEMU.FS.TYPE.NOTMATCH}'
                operator: NOT_MATCHES_REGEX
          description: 'Discovers filesystems of the QEMU virtual machine {#QEMU.NAME} on the node {#NODE.NAME}.'
          item_prototypes:
            - uuid: 814d919286a845429064bd2c6f7f89cf
              name: 'Node [{#NODE.NAME}]: QEMU [{#QEMU.NAME}][{#QEMU.FS.MOUNTPOINT}]: Filesystem total (privileged)'
              type: DEPENDENT
              key: 'proxmox_ve.node.qemu.filesystem.total.privileged[{#NODE.ID},{#QEMU.VMID},{#QEMU.FS.MOUNTPOINT}]'
              units: B
              description: 'Retrieves the total space of the privileged filesystem mounted at {#QEMU.FS.MOUNTPOINT} of the QEMU virtual machine {#QEMU.NAME} on the node {#NODE.NAME}.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$["total-bytes-privileged"]'
                  error_handler: DISCARD_VALUE
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 12h
              master_item:
                key: 'proxmox_ve.node.qemu.filesystem[{#NODE.ID},{#QEMU.VMID},{#QEMU.FS.MOUNTPOINT}]'
              tags:
                - tag: component
                  value: filesystem
                - tag: component
                  value: node
                - tag: component
                  value: qemu
                - tag: filesystem
                  value: '{#QEMU.FS.MOUNTPOINT}'
                - tag: node
                  value: '{#NODE.NAME}'
                - tag: qemu
                  value: '{#QEMU.NAME}'
            - uuid: ccc52ebc5f8d4eae88c09d7dfac7580f
              name: 'Node [{#NODE.NAME}]: QEMU [{#QEMU.NAME}][{#QEMU.FS.MOUNTPOINT}]: Filesystem total'
              type: DEPENDENT
              key: 'proxmox_ve.node.qemu.filesystem.total[{#NODE.ID},{#QEMU.VMID},{#QEMU.FS.MOUNTPOINT}]'
              units: B
              description: 'Retrieves the total space of the filesystem mounted at {#QEMU.FS.MOUNTPOINT} of the QEMU virtual machine {#QEMU.NAME} on the node {#NODE.NAME}.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$["total-bytes"]'
                  error_handler: DISCARD_VALUE
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 12h
              master_item:
                key: 'proxmox_ve.node.qemu.filesystem[{#NODE.ID},{#QEMU.VMID},{#QEMU.FS.MOUNTPOINT}]'
              tags:
                - tag: component
                  value: filesystem
                - tag: component
                  value: node
                - tag: component
                  value: qemu
                - tag: filesystem
                  value: '{#QEMU.FS.MOUNTPOINT}'
                - tag: node
                  value: '{#NODE.NAME}'
                - tag: qemu
                  value: '{#QEMU.NAME}'
            - uuid: d3860343ad874217a7739c444a85dfc1
              name: 'Node [{#NODE.NAME}]: QEMU [{#QEMU.NAME}][{#QEMU.FS.MOUNTPOINT}]: Filesystem used'
              type: DEPENDENT
              key: 'proxmox_ve.node.qemu.filesystem.usage[{#NODE.ID},{#QEMU.VMID},{#QEMU.FS.MOUNTPOINT}]'
              units: B
              description: 'Retrieves the used space of the filesystem mounted at {#QEMU.FS.MOUNTPOINT} of the QEMU virtual machine {#QEMU.NAME} on the node {#NODE.NAME}.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$["used-bytes"]'
                  error_handler: DISCARD_VALUE
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 1h
              master_item:
                key: 'proxmox_ve.node.qemu.filesystem[{#NODE.ID},{#QEMU.VMID},{#QEMU.FS.MOUNTPOINT}]'
              tags:
                - tag: component
                  value: filesystem
                - tag: component
                  value: node
                - tag: component
                  value: qemu
                - tag: filesystem
                  value: '{#QEMU.FS.MOUNTPOINT}'
                - tag: node
                  value: '{#NODE.NAME}'
                - tag: qemu
                  value: '{#QEMU.NAME}'
            - uuid: 4a7a0540bf0f45edab0b6a33957957cf
              name: 'Node [{#NODE.NAME}]: QEMU [{#QEMU.NAME}][{#QEMU.FS.MOUNTPOINT}]: Filesystem utilization'
              type: CALCULATED
              key: 'proxmox_ve.node.qemu.filesystem.utilization[{#NODE.ID},{#QEMU.VMID},{#QEMU.FS.MOUNTPOINT}]'
              value_type: FLOAT
              units: '%'
              params: 'last(//proxmox_ve.node.qemu.filesystem.usage[{#NODE.ID},{#QEMU.VMID},{#QEMU.FS.MOUNTPOINT}]) / last(//proxmox_ve.node.qemu.filesystem.total[{#NODE.ID},{#QEMU.VMID},{#QEMU.FS.MOUNTPOINT}]) * 100'
              description: 'Retrieves filesystem utilization of the QEMU virtual machine {#QEMU.NAME} on the node {#NODE.NAME}.'
              preprocessing:
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 1h
              tags:
                - tag: component
                  value: filesystem
                - tag: component
                  value: node
                - tag: component
                  value: qemu
                - tag: filesystem
                  value: '{#QEMU.FS.MOUNTPOINT}'
                - tag: node
                  value: '{#NODE.NAME}'
                - tag: qemu
                  value: '{#QEMU.NAME}'
              trigger_prototypes:
                - uuid: 0ea2852582cf4a48b1d5c1a74713e9e1
                  expression: 'last(/Proxmox VE by HTTP/proxmox_ve.node.qemu.filesystem.utilization[{#NODE.ID},{#QEMU.VMID},{#QEMU.FS.MOUNTPOINT}]) > {$PVE.TRIGGER.DISK.WARNING:"{#QEMU.NAME}"}'
                  name: 'Proxmox VE: Node [{#NODE.NAME}]: QEMU [{#QEMU.NAME}][{#QEMU.FS.MOUNTPOINT}]: Filesystem used high'
                  priority: WARNING
                  description: 'The filesystem usage of {#QEMU.FS.MOUNTPOINT} on the QEMU virtual machine {#QEMU.NAME} on the node {#NODE.NAME} is high.'
                  tags:
                    - tag: scope
                      value: notice
            - uuid: 3f550a78afa34e79a550d0192e66bac4
              name: 'Node [{#NODE.NAME}]: QEMU [{#QEMU.NAME}][{#QEMU.FS.MOUNTPOINT}]: Filesystem get info'
              type: HTTP_AGENT
              key: 'proxmox_ve.node.qemu.filesystem[{#NODE.ID},{#QEMU.VMID},{#QEMU.FS.MOUNTPOINT}]'
              delay: 10m
              history: '0'
              value_type: TEXT
              description: 'Retrieves information about the filesystem mounted at {#QEMU.FS.MOUNTPOINT} of the QEMU virtual machine {#QEMU.NAME} on the node {#NODE.NAME}.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$.data.result[?(@.mountpoint=="{#QEMU.FS.MOUNTPOINT}")].first()'
                  error_handler: DISCARD_VALUE
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 1h
              timeout: '10'
              url: 'https://{$PVE.URL.HOST}:{$PVE.URL.PORT}/api2/json//nodes/{#NODE.NAME}/qemu/{#QEMU.VMID}/agent/get-fsinfo'
              status_codes: '200,500,595'
              http_proxy: '{$PVE.PROXY}'
              headers:
                - name: Authorization
                  value: 'PVEAPIToken={$PVE.TOKEN.ID}={$PVE.TOKEN.SECRET}'
              tags:
                - tag: component
                  value: raw
          graph_prototypes:
            - uuid: cd8aea318eea413b9f774739e6effda8
              name: 'Node [{#NODE.NAME}]: QEMU [{#QEMU.NAME}/{#QEMU.VMID}][{#QEMU.FS.MOUNTPOINT}]: Filesystem used'
              graph_items:
                - color: ff0000
                  item:
                    host: 'Proxmox VE by HTTP'
                    key: 'proxmox_ve.node.qemu.filesystem.usage[{#NODE.ID},{#QEMU.VMID},{#QEMU.FS.MOUNTPOINT}]'
                - sortorder: '1'
                  color: 00ff00
                  item:
                    host: 'Proxmox VE by HTTP'
                    key: 'proxmox_ve.node.qemu.filesystem.total[{#NODE.ID},{#QEMU.VMID},{#QEMU.FS.MOUNTPOINT}]'
          parent_discovery_rule:
            key: 'proxmox_ve.node.qemu.discovery[{#NODE.ID}]'
          timeout: '10'
          url: 'https://{$PVE.URL.HOST}:{$PVE.URL.PORT}/api2/json/nodes/{#NODE.NAME}/qemu/{#QEMU.VMID}/agent/get-fsinfo'
          status_codes: '200,500,595'
          http_proxy: '{$PVE.PROXY}'
          headers:
            - name: Authorization
              value: 'PVEAPIToken={$PVE.TOKEN.ID}={$PVE.TOKEN.SECRET}'
          lld_macro_paths:
            - lld_macro: '{#QEMU.FS.MOUNTPOINT}'
              path: $.mountpoint
            - lld_macro: '{#QEMU.FS.TYPE}'
              path: $.type
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.data.result
              error_handler: CUSTOM_VALUE
              error_handler_params: '[]'
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 1h
        - uuid: 4f8c1b2d3e4f4a5b8c9d0e1f2a3b4c5e
          name: 'Node [{#NODE.NAME}]: QEMU [{#QEMU.NAME}]: Network interfaces discovery'
          type: HTTP_AGENT
          key: 'proxmox_ve.node.qemu.network.discovery[{#NODE.ID},{#QEMU.VMID}]'
          delay: '{$PVE.PARAMS.INTERVAL.QEMU.NETWORK}'
          filter:
            evaltype: AND
            conditions:
              - macro: '{#QEMU.NETIF.NAME}'
                value: '{$PVE.FILTER.QEMU.NET.IFACE.NAME.MATCH}'
              - macro: '{#QEMU.NETIF.NAME}'
                value: '{$PVE.FILTER.QEMU.NET.IFACE.NAME.NOTMATCH}'
                operator: NOT_MATCHES_REGEX
          description: 'Discovers network interfaces of the QEMU virtual machine {#QEMU.NAME} on the node {#NODE.NAME}.'
          item_prototypes:
            - uuid: 0ca6ed3bdf7d4584a34ba3452f295146
              name: 'Node [{#NODE.NAME}]: QEMU [{#QEMU.NAME}][{#QEMU.NETIF.NAME}]: Network input dropped'
              type: DEPENDENT
              key: 'proxmox_ve.node.qemu.network.input.dropped[{#NODE.ID},{#QEMU.VMID},{#QEMU.NETIF.NAME}]'
              units: '!dropped'
              description: 'Retrieves the number of input packets dropped on the network interface {#QEMU.NETIF.NAME} of the QEMU virtual machine {#QEMU.NAME} on the node {#NODE.NAME}.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$["statistics"]["rx-dropped"]'
                  error_handler: DISCARD_VALUE
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 12h
              master_item:
                key: 'proxmox_ve.node.qemu.network[{#NODE.ID},{#QEMU.VMID},{#QEMU.NETIF.NAME}]'
              tags:
                - tag: component
                  value: network
                - tag: component
                  value: node
                - tag: component
                  value: qemu
                - tag: iface
                  value: '{#QEMU.NETIF.NAME}'
                - tag: node
                  value: '{#NODE.NAME}'
                - tag: qemu
                  value: '{#QEMU.NAME}'
            - uuid: 763cba20cd544659aafdd81e66c81d44
              name: 'Node [{#NODE.NAME}]: QEMU [{#QEMU.NAME}][{#QEMU.NETIF.NAME}]: Network input errors'
              type: DEPENDENT
              key: 'proxmox_ve.node.qemu.network.input.errors[{#NODE.ID},{#QEMU.VMID},{#QEMU.NETIF.NAME}]'
              units: '!errors'
              description: 'Retrieves the number of input errors on the network interface {#QEMU.NETIF.NAME} of the QEMU virtual machine {#QEMU.NAME} on the node {#NODE.NAME}.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$["statistics"]["rx-errs"]'
                  error_handler: DISCARD_VALUE
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 12h
              master_item:
                key: 'proxmox_ve.node.qemu.network[{#NODE.ID},{#QEMU.VMID},{#QEMU.NETIF.NAME}]'
              tags:
                - tag: component
                  value: network
                - tag: component
                  value: node
                - tag: component
                  value: qemu
                - tag: iface
                  value: '{#QEMU.NETIF.NAME}'
                - tag: node
                  value: '{#NODE.NAME}'
                - tag: qemu
                  value: '{#QEMU.NAME}'
            - uuid: dc4f4cdf62bd49fc9a9bf6d705fd2fe4
              name: 'Node [{#NODE.NAME}]: QEMU [{#QEMU.NAME}][{#QEMU.NETIF.NAME}]: Network input speed (in bps)'
              type: DEPENDENT
              key: 'proxmox_ve.node.qemu.network.input.speed.bits[{#NODE.ID},{#QEMU.VMID},{#QEMU.NETIF.NAME}]'
              units: bps
              description: 'Retrieves the input speed of the network interface {#QEMU.NETIF.NAME} of the QEMU virtual machine {#QEMU.NAME} on the node {#NODE.NAME}.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$["statistics"]["rx-bytes"]'
                  error_handler: DISCARD_VALUE
                - type: MULTIPLIER
                  parameters:
                    - '8'
                - type: CHANGE_PER_SECOND
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 1h
              master_item:
                key: 'proxmox_ve.node.qemu.network[{#NODE.ID},{#QEMU.VMID},{#QEMU.NETIF.NAME}]'
              tags:
                - tag: component
                  value: network
                - tag: component
                  value: node
                - tag: component
                  value: qemu
                - tag: iface
                  value: '{#QEMU.NETIF.NAME}'
                - tag: node
                  value: '{#NODE.NAME}'
                - tag: qemu
                  value: '{#QEMU.NAME}'
            - uuid: 554ffe79db404b6a864a0af54be2120a
              name: 'Node [{#NODE.NAME}]: QEMU [{#QEMU.NAME}][{#QEMU.NETIF.NAME}]: Network input speed (in packets/s)'
              type: DEPENDENT
              key: 'proxmox_ve.node.qemu.network.input.speed.packets[{#NODE.ID},{#QEMU.VMID},{#QEMU.NETIF.NAME}]'
              units: packets/s
              description: 'Retrieves the input speed in packets of the network interface {#QEMU.NETIF.NAME} of the QEMU virtual machine {#QEMU.NAME} on the node {#NODE.NAME}.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$["statistics"]["rx-packets"]'
                  error_handler: DISCARD_VALUE
                - type: CHANGE_PER_SECOND
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 1h
              master_item:
                key: 'proxmox_ve.node.qemu.network[{#NODE.ID},{#QEMU.VMID},{#QEMU.NETIF.NAME}]'
              tags:
                - tag: component
                  value: network
                - tag: component
                  value: node
                - tag: component
                  value: qemu
                - tag: iface
                  value: '{#QEMU.NETIF.NAME}'
                - tag: node
                  value: '{#NODE.NAME}'
                - tag: qemu
                  value: '{#QEMU.NAME}'
            - uuid: d60d950efd6c4ba8bee2cf9b30516285
              name: 'Node [{#NODE.NAME}]: QEMU [{#QEMU.NAME}][{#QEMU.NETIF.NAME}]: Hardware address'
              type: DEPENDENT
              key: 'proxmox_ve.node.qemu.network.mac[{#NODE.ID},{#QEMU.VMID},{#QEMU.NETIF.NAME}]'
              value_type: CHAR
              description: 'Retrieves the hardware address of the network interface {#QEMU.NETIF.NAME} of the QEMU virtual machine {#QEMU.NAME} on the node {#NODE.NAME}.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$["hardware-address"]'
                  error_handler: DISCARD_VALUE
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 12h
              master_item:
                key: 'proxmox_ve.node.qemu.network[{#NODE.ID},{#QEMU.VMID},{#QEMU.NETIF.NAME}]'
              tags:
                - tag: component
                  value: network
                - tag: component
                  value: node
                - tag: component
                  value: qemu
                - tag: iface
                  value: '{#QEMU.NETIF.NAME}'
                - tag: node
                  value: '{#NODE.NAME}'
                - tag: qemu
                  value: '{#QEMU.NAME}'
            - uuid: efd5da36a4064a4e910f74aa972654b0
              name: 'Node [{#NODE.NAME}]: QEMU [{#QEMU.NAME}][{#QEMU.NETIF.NAME}]: Network output dropped'
              type: DEPENDENT
              key: 'proxmox_ve.node.qemu.network.output.dropped[{#NODE.ID},{#QEMU.VMID},{#QEMU.NETIF.NAME}]'
              units: '!dropped'
              description: 'Retrieves the number of output packets dropped on the network interface {#QEMU.NETIF.NAME} of the QEMU virtual machine {#QEMU.NAME} on the node {#NODE.NAME}.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$["statistics"]["tx-dropped"]'
                  error_handler: DISCARD_VALUE
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 12h
              master_item:
                key: 'proxmox_ve.node.qemu.network[{#NODE.ID},{#QEMU.VMID},{#QEMU.NETIF.NAME}]'
              tags:
                - tag: component
                  value: network
                - tag: component
                  value: node
                - tag: component
                  value: qemu
                - tag: iface
                  value: '{#QEMU.NETIF.NAME}'
                - tag: node
                  value: '{#NODE.NAME}'
                - tag: qemu
                  value: '{#QEMU.NAME}'
            - uuid: d1764e64cdba4627b10bfbb33f500417
              name: 'Node [{#NODE.NAME}]: QEMU [{#QEMU.NAME}][{#QEMU.NETIF.NAME}]: Network output errors'
              type: DEPENDENT
              key: 'proxmox_ve.node.qemu.network.output.errors[{#NODE.ID},{#QEMU.VMID},{#QEMU.NETIF.NAME}]'
              units: '!errors'
              description: 'Retrieves the number of output errors on the network interface {#QEMU.NETIF.NAME} of the QEMU virtual machine {#QEMU.NAME} on the node {#NODE.NAME}.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$["statistics"]["tx-errs"]'
                  error_handler: DISCARD_VALUE
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 12h
              master_item:
                key: 'proxmox_ve.node.qemu.network[{#NODE.ID},{#QEMU.VMID},{#QEMU.NETIF.NAME}]'
              tags:
                - tag: component
                  value: network
                - tag: component
                  value: node
                - tag: component
                  value: qemu
                - tag: iface
                  value: '{#QEMU.NETIF.NAME}'
                - tag: node
                  value: '{#NODE.NAME}'
                - tag: qemu
                  value: '{#QEMU.NAME}'
            - uuid: f7a698fdd2794932a11388b95d539143
              name: 'Node [{#NODE.NAME}]: QEMU [{#QEMU.NAME}][{#QEMU.NETIF.NAME}]: Network output speed (in bps)'
              type: DEPENDENT
              key: 'proxmox_ve.node.qemu.network.output.speed.bits[{#NODE.ID},{#QEMU.VMID},{#QEMU.NETIF.NAME}]'
              units: bps
              description: 'Retrieves the output speed of the network interface {#QEMU.NETIF.NAME} of the QEMU virtual machine {#QEMU.NAME} on the node {#NODE.NAME}.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$["statistics"]["tx-bytes"]'
                  error_handler: DISCARD_VALUE
                - type: MULTIPLIER
                  parameters:
                    - '8'
                - type: CHANGE_PER_SECOND
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 1h
              master_item:
                key: 'proxmox_ve.node.qemu.network[{#NODE.ID},{#QEMU.VMID},{#QEMU.NETIF.NAME}]'
              tags:
                - tag: component
                  value: network
                - tag: component
                  value: node
                - tag: component
                  value: qemu
                - tag: iface
                  value: '{#QEMU.NETIF.NAME}'
                - tag: node
                  value: '{#NODE.NAME}'
                - tag: qemu
                  value: '{#QEMU.NAME}'
            - uuid: 958a63c0c82e4545b18033ff8bff5384
              name: 'Node [{#NODE.NAME}]: QEMU [{#QEMU.NAME}][{#QEMU.NETIF.NAME}]: Network output speed (in packets/s)'
              type: DEPENDENT
              key: 'proxmox_ve.node.qemu.network.output.speed.packets[{#NODE.ID},{#QEMU.VMID},{#QEMU.NETIF.NAME}]'
              units: packets/s
              description: 'Retrieves the output speed in packets of the network interface {#QEMU.NETIF.NAME} of the QEMU virtual machine {#QEMU.NAME} on the node {#NODE.NAME}.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$["statistics"]["tx-packets"]'
                  error_handler: DISCARD_VALUE
                - type: CHANGE_PER_SECOND
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 1h
              master_item:
                key: 'proxmox_ve.node.qemu.network[{#NODE.ID},{#QEMU.VMID},{#QEMU.NETIF.NAME}]'
              tags:
                - tag: component
                  value: network
                - tag: component
                  value: node
                - tag: component
                  value: qemu
                - tag: iface
                  value: '{#QEMU.NETIF.NAME}'
                - tag: node
                  value: '{#NODE.NAME}'
                - tag: qemu
                  value: '{#QEMU.NAME}'
            - uuid: 8455021604db43ff80d860ca4ca87e2c
              name: 'Node [{#NODE.NAME}]: QEMU [{#QEMU.NAME}][{#QEMU.NETIF.NAME}]: Network interface info'
              type: HTTP_AGENT
              key: 'proxmox_ve.node.qemu.network[{#NODE.ID},{#QEMU.VMID},{#QEMU.NETIF.NAME}]'
              history: '0'
              value_type: TEXT
              description: 'Retrieves information about the network interface {#QEMU.NETIF.NAME} of the QEMU virtual machine {#QEMU.NAME} on the node {#NODE.NAME}.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$.data.result[?(@.name=="{#QEMU.NETIF.NAME}")].first()'
                  error_handler: DISCARD_VALUE
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 12h
              timeout: '10'
              url: 'https://{$PVE.URL.HOST}:{$PVE.URL.PORT}/api2/json//nodes/{#NODE.NAME}/qemu/{#QEMU.VMID}/agent/network-get-interfaces'
              status_codes: '200,500,595'
              http_proxy: '{$PVE.PROXY}'
              headers:
                - name: Authorization
                  value: 'PVEAPIToken={$PVE.TOKEN.ID}={$PVE.TOKEN.SECRET}'
              tags:
                - tag: component
                  value: raw
          graph_prototypes:
            - uuid: 1a7a579a10784f4d8b5087f26c507aca
              name: 'Node [{#NODE.NAME}]: QEMU [{#QEMU.NAME}/{#QEMU.VMID}][{#QEMU.NETIF.NAME}]: Network speed'
              graph_items:
                - color: 2600ff
                  item:
                    host: 'Proxmox VE by HTTP'
                    key: 'proxmox_ve.node.qemu.network.input.speed.bits[{#NODE.ID},{#QEMU.VMID},{#QEMU.NETIF.NAME}]'
                - sortorder: '1'
                  color: 00ff00
                  item:
                    host: 'Proxmox VE by HTTP'
                    key: 'proxmox_ve.node.qemu.network.output.speed.bits[{#NODE.ID},{#QEMU.VMID},{#QEMU.NETIF.NAME}]'
            - uuid: cff8762c3c0d40b199852574749b08de
              name: 'Node [{#NODE.NAME}]: QEMU [{#QEMU.NAME}/{#QEMU.VMID}][{#QEMU.NETIF.NAME}]: Network speed (in packets/s)'
              graph_items:
                - color: 2600ff
                  item:
                    host: 'Proxmox VE by HTTP'
                    key: 'proxmox_ve.node.qemu.network.input.speed.packets[{#NODE.ID},{#QEMU.VMID},{#QEMU.NETIF.NAME}]'
                - sortorder: '1'
                  color: 00ff00
                  item:
                    host: 'Proxmox VE by HTTP'
                    key: 'proxmox_ve.node.qemu.network.output.speed.packets[{#NODE.ID},{#QEMU.VMID},{#QEMU.NETIF.NAME}]'
          parent_discovery_rule:
            key: 'proxmox_ve.node.qemu.discovery[{#NODE.ID}]'
          timeout: '10'
          url: 'https://{$PVE.URL.HOST}:{$PVE.URL.PORT}/api2/json/nodes/{#NODE.NAME}/qemu/{#QEMU.VMID}/agent/network-get-interfaces'
          status_codes: '200,500,595'
          http_proxy: '{$PVE.PROXY}'
          headers:
            - name: Authorization
              value: 'PVEAPIToken={$PVE.TOKEN.ID}={$PVE.TOKEN.SECRET}'
          lld_macro_paths:
            - lld_macro: '{#QEMU.NETIF.IP}'
              path: '$["ip-addresses"]'
            - lld_macro: '{#QEMU.NETIF.NAME}'
              path: $.name
            - lld_macro: '{#QEMU.NETIF.STATISTICS}'
              path: $.statistics
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.data.result
              error_handler: CUSTOM_VALUE
              error_handler_params: '[]'
          overrides:
            - name: 'Disable statistics'
              step: '1'
              filter:
                conditions:
                  - macro: '{#QEMU.NETIF.STATISTICS}'
                    operator: NOT_EXISTS
              operations:
                - operator: REGEXP
                  value: input|output
                  discover: NO_DISCOVER
            - name: 'Disable IP addresses discovery'
              step: '2'
              filter:
                conditions:
                  - macro: '{#QEMU.NETIF.IP}'
                    operator: NOT_EXISTS
              operations:
                - operationobject: LLD_RULE_PROTOTYPE
                  operator: LIKE
                  value: 'IP addresses'
                  discover: NO_DISCOVER
        - uuid: 16052c645d144eeeb17d6f2acded0863
          name: 'Node [{#NODE.NAME}]: QEMU [{#QEMU.NAME}][{#QEMU.NETIF.NAME}]: IP addresses discovery'
          type: HTTP_AGENT
          key: 'proxmox_ve.node.qemu.network.ip.discovery[{#NODE.ID},{#QEMU.VMID},{#QEMU.NETIF.NAME}]'
          delay: '{$PVE.PARAMS.INTERVAL.QEMU.NETWORK}'
          description: 'Discovers network interfaces of the QEMU virtual machine {#QEMU.NAME} on the node {#NODE.NAME}.'
          item_prototypes:
            - uuid: 7e0d9797f75646b1ac464a55515a0969
              name: 'Node [{#NODE.NAME}]: QEMU [{#QEMU.NAME}][{#QEMU.NETIF.NAME}]: IP address #{#QEMU.NETIF.IP.ID}'
              type: HTTP_AGENT
              key: 'proxmox_ve.node.qemu.network.ip[{#NODE.ID},{#QEMU.VMID},{#QEMU.NETIF.NAME},{#QEMU.NETIF.IP.ID}]'
              delay: 12h
              value_type: CHAR
              description: 'Retrieves information about the IP address {#QEMU.NETIF.IP.ADDRESS} of the network interface {#QEMU.NETIF.NAME} of the QEMU virtual machine {#QEMU.NAME} on the node {#NODE.NAME}.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$.data.result[?(@.name=="{#QEMU.NETIF.NAME}")]["ip-addresses"].first()'
                  error_handler: DISCARD_VALUE
                - type: JAVASCRIPT
                  parameters:
                    - |
                      try {
                      	var data = JSON.parse(value);
                      
                      	data.sort(function (a, b) {
                      		return a['ip-address'].localeCompare(b['ip-address']);
                      	});
                      
                      	for (var i = 0; i < data.length; i++) {
                      		data[i]['id'] = i + 1;
                      	}
                      
                      	return JSON.stringify(data);
                      
                      } catch (e) {
                      
                      	Zabbix.log(3, "[ERROR] Proxmox ip address discovery error: " + e + " for value: " + value);
                      
                      	return JSON.stringify([]);
                      }
                - type: JSONPATH
                  parameters:
                    - '$.[?(@.id=="{#QEMU.NETIF.IP.ID}")].first()'
                  error_handler: DISCARD_VALUE
                - type: JAVASCRIPT
                  parameters:
                    - |
                      try {
                      	var data = JSON.parse(value);
                      
                      	return data['ip-address'] + '/' + data['prefix'];
                      
                      } catch (e) {
                      
                      	Zabbix.log(3, "[ERROR] Proxmox ip address parsing error: " + e + " for value: " + value);
                      
                      	return "[ERROR] Proxmox ip address parsing error: " + e + " for value: " + value;
                      }
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 12h
              timeout: '10'
              url: 'https://{$PVE.URL.HOST}:{$PVE.URL.PORT}/api2/json//nodes/{#NODE.NAME}/qemu/{#QEMU.VMID}/agent/network-get-interfaces'
              status_codes: '200,500,595'
              http_proxy: '{$PVE.PROXY}'
              headers:
                - name: Authorization
                  value: 'PVEAPIToken={$PVE.TOKEN.ID}={$PVE.TOKEN.SECRET}'
              tags:
                - tag: component
                  value: network
                - tag: component
                  value: node
                - tag: component
                  value: qemu
                - tag: iface
                  value: '{#QEMU.NETIF.NAME}'
                - tag: node
                  value: '{#NODE.NAME}'
                - tag: qemu
                  value: '{#QEMU.NAME}'
          parent_discovery_rule:
            key: 'proxmox_ve.node.qemu.network.discovery[{#NODE.ID},{#QEMU.VMID}]'
          timeout: '10'
          url: 'https://{$PVE.URL.HOST}:{$PVE.URL.PORT}/api2/json/nodes/{#NODE.NAME}/qemu/{#QEMU.VMID}/agent/network-get-interfaces'
          status_codes: '200,500,595'
          http_proxy: '{$PVE.PROXY}'
          headers:
            - name: Authorization
              value: 'PVEAPIToken={$PVE.TOKEN.ID}={$PVE.TOKEN.SECRET}'
          lld_macro_paths:
            - lld_macro: '{#QEMU.NETIF.IP.ADDRESS}'
              path: '$["ip-address"]'
            - lld_macro: '{#QEMU.NETIF.IP.ID}'
              path: $.id
          preprocessing:
            - type: JSONPATH
              parameters:
                - '$.data.result[?(@.name=="{#QEMU.NETIF.NAME}")]["ip-addresses"].first()'
              error_handler: CUSTOM_VALUE
              error_handler_params: '[]'
            - type: JAVASCRIPT
              parameters:
                - |
                  try {
                  	var data = JSON.parse(value);
                  
                  	data.sort(function (a, b) {
                  		return a['ip-address'].localeCompare(b['ip-address']);
                  	});
                  
                  	for (var i = 0; i < data.length; i++) {
                  		data[i]['id'] = i + 1;
                  	}
                  
                  	return JSON.stringify(data);
                  
                  } catch (e) {
                  
                  	Zabbix.log(3, "[ERROR] Proxmox ip address discovery error: " + e + " for value: " + value);
                  
                  	return JSON.stringify([]);
                  }
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 12h
        - uuid: b022e5c58bd64db389dab20b44e372a7
          name: 'Node [{#NODE.NAME}]: QEMU [{#QEMU.NAME}]: OS info discovery'
          type: HTTP_AGENT
          key: 'proxmox_ve.node.qemu.os.discovery[{#NODE.ID},{#QEMU.VMID}]'
          delay: '{$PVE.PARAMS.INTERVAL.QEMU.OS}'
          filter:
            evaltype: AND
            conditions:
              - macro: '{#QEMU.OS.METRIC}'
                value: '{$PVE.FILTER.QEMU.OS.METRIC.MATCH}'
              - macro: '{#QEMU.OS.METRIC}'
                value: '{$PVE.FILTER.QEMU.OS.METRIC.NOTMATCH}'
                operator: NOT_MATCHES_REGEX
          description: 'Discovers operating system information of the QEMU virtual machine {#QEMU.NAME} on the node {#NODE.NAME}.'
          item_prototypes:
            - uuid: 52ee9eeab05443269000c1ae2f6dde6c
              name: 'Node [{#NODE.NAME}]: QEMU [{#QEMU.NAME}]: OS [{#QEMU.OS.METRIC}]'
              type: HTTP_AGENT
              key: 'proxmox_ve.node.qemu.os.info[{#NODE.ID},{#QEMU.VMID},{#QEMU.OS.METRIC}]'
              delay: '{$PVE.PARAMS.INTERVAL.QEMU.OS}'
              value_type: CHAR
              description: 'Retrieves the operating system information of the QEMU virtual machine {#QEMU.NAME} on the node {#NODE.NAME}.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$.data.result["{#QEMU.OS.METRIC}"]'
                  error_handler: DISCARD_VALUE
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 12h
              timeout: '10'
              url: 'https://{$PVE.URL.HOST}:{$PVE.URL.PORT}/api2/json//nodes/{#NODE.NAME}/qemu/{#QEMU.VMID}/agent/get-osinfo'
              status_codes: '200,500,595'
              http_proxy: '{$PVE.PROXY}'
              headers:
                - name: Authorization
                  value: 'PVEAPIToken={$PVE.TOKEN.ID}={$PVE.TOKEN.SECRET}'
              tags:
                - tag: component
                  value: node
                - tag: component
                  value: os
                - tag: component
                  value: qemu
                - tag: node
                  value: '{#NODE.NAME}'
                - tag: os
                  value: '{#QEMU.OS.METRIC}'
                - tag: qemu
                  value: '{#QEMU.NAME}'
          parent_discovery_rule:
            key: 'proxmox_ve.node.qemu.discovery[{#NODE.ID}]'
          timeout: '10'
          url: 'https://{$PVE.URL.HOST}:{$PVE.URL.PORT}/api2/json/nodes/{#NODE.NAME}/qemu/{#QEMU.VMID}/agent/get-osinfo'
          status_codes: '200,500,595'
          http_proxy: '{$PVE.PROXY}'
          headers:
            - name: Authorization
              value: 'PVEAPIToken={$PVE.TOKEN.ID}={$PVE.TOKEN.SECRET}'
          lld_macro_paths:
            - lld_macro: '{#QEMU.OS.METRIC}'
              path: $.metric
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.data.result
              error_handler: DISCARD_VALUE
            - type: JAVASCRIPT
              parameters:
                - |
                  try {
                  	var data = JSON.parse(value),
                  		output = [];
                  
                  	for (var field in data) {
                  		if (data.hasOwnProperty(field)) {
                  			output.push({
                  				metric: field,
                  				value: data[field]
                  			});
                  		}
                  	}
                  
                  	output.sort(function (a, b) {
                  		return a['metric'].localeCompare(b['metric']);
                  	});
                  
                  	return JSON.stringify(output);
                  
                  } catch (e) {
                  
                  	Zabbix.log(3, '[ERROR] Proxmox OS info discovery error: ' + e + ' for value: ' + value);
                  
                  	return JSON.stringify([]);
                  }
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 12h
        - uuid: 9edd36cafac843879c698b70d925e472
          name: 'Node [{#NODE.NAME}]: Storage discovery'
          type: HTTP_AGENT
          key: 'proxmox_ve.node.storage.discovery[{#NODE.ID}]'
          delay: '{$PVE.PARAMS.INTERVAL.STORAGE}'
          filter:
            evaltype: AND
            conditions:
              - macro: '{#STORAGE.NAME}'
                value: '{$PVE.FILTER.STORAGE.NAME.MATCH}'
              - macro: '{#STORAGE.NAME}'
                value: '{$PVE.FILTER.STORAGE.NAME.NOTMATCH}'
                operator: NOT_MATCHES_REGEX
              - macro: '{#STORAGE.SHARED}'
                value: '0'
          description: 'Discovers storage devices on the node {#NODE.NAME}.'
          item_prototypes:
            - uuid: 48fdd99d2647428f864bc26aa860deba
              name: 'Node [{#NODE.NAME}]: Storage [{#STORAGE.NAME}]: Content'
              type: DEPENDENT
              key: 'proxmox_ve.node.storage.content[{#NODE.ID},{#STORAGE.NAME}]'
              value_type: CHAR
              description: 'Retrieves the content type of the storage device "{#STORAGE.NAME}" on the node {#NODE.NAME}.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.content
                  error_handler: DISCARD_VALUE
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 12h
              master_item:
                key: 'proxmox_ve.node.storage[{#NODE.ID},{#STORAGE.NAME}]'
              tags:
                - tag: component
                  value: node
                - tag: component
                  value: storage
                - tag: node
                  value: '{#NODE.NAME}'
                - tag: storage
                  value: '{#STORAGE.NAME}'
            - uuid: d36ce78b8ad242d2b436155c9ce566c8
              name: 'Node [{#NODE.NAME}]: Storage [{#STORAGE.NAME}]: Total'
              type: DEPENDENT
              key: 'proxmox_ve.node.storage.total[{#NODE.ID},{#STORAGE.NAME}]'
              units: B
              description: 'Retrieves the total space of the storage device "{#STORAGE.NAME}" on the node {#NODE.NAME}.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.total
                  error_handler: DISCARD_VALUE
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 12h
              master_item:
                key: 'proxmox_ve.node.storage[{#NODE.ID},{#STORAGE.NAME}]'
              tags:
                - tag: component
                  value: node
                - tag: component
                  value: storage
                - tag: node
                  value: '{#NODE.NAME}'
                - tag: storage
                  value: '{#STORAGE.NAME}'
            - uuid: 6aabad76c8c44dc982469478cb7be3a9
              name: 'Node [{#NODE.NAME}]: Storage [{#STORAGE.NAME}]: Type'
              type: DEPENDENT
              key: 'proxmox_ve.node.storage.type[{#NODE.ID},{#STORAGE.NAME}]'
              value_type: CHAR
              description: 'Retrieves the type of the storage device "{#STORAGE.NAME}" on the node {#NODE.NAME}.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.type
                  error_handler: DISCARD_VALUE
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 12h
              master_item:
                key: 'proxmox_ve.node.storage[{#NODE.ID},{#STORAGE.NAME}]'
              tags:
                - tag: component
                  value: node
                - tag: component
                  value: storage
                - tag: node
                  value: '{#NODE.NAME}'
                - tag: storage
                  value: '{#STORAGE.NAME}'
            - uuid: 2441813b412e47608f7267a6e720a108
              name: 'Node [{#NODE.NAME}]: Storage [{#STORAGE.NAME}]: Used'
              type: DEPENDENT
              key: 'proxmox_ve.node.storage.used[{#NODE.ID},{#STORAGE.NAME}]'
              units: B
              description: 'Retrieves the used space of the storage device "{#STORAGE.NAME}" on the node {#NODE.NAME}.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.used
                  error_handler: DISCARD_VALUE
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 12h
              master_item:
                key: 'proxmox_ve.node.storage[{#NODE.ID},{#STORAGE.NAME}]'
              tags:
                - tag: component
                  value: node
                - tag: component
                  value: storage
                - tag: node
                  value: '{#NODE.NAME}'
                - tag: storage
                  value: '{#STORAGE.NAME}'
            - uuid: 7134005131c24ac28f2b09e77c1c6a25
              name: 'Node [{#NODE.NAME}]: Storage [{#STORAGE.NAME}]: Utilization'
              type: CALCULATED
              key: 'proxmox_ve.node.storage.utilization[{#NODE.ID},{#STORAGE.NAME}]'
              value_type: FLOAT
              units: '%'
              params: 'last(//proxmox_ve.node.storage.used[{#NODE.ID},{#STORAGE.NAME}]) / last(//proxmox_ve.node.storage.total[{#NODE.ID},{#STORAGE.NAME}]) * 100'
              description: 'Retrieves the utilization percentage of the storage device "{#STORAGE.NAME}" on the node {#NODE.NAME}.'
              preprocessing:
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 12h
              tags:
                - tag: component
                  value: node
                - tag: component
                  value: storage
                - tag: node
                  value: '{#NODE.NAME}'
                - tag: storage
                  value: '{#STORAGE.NAME}'
              trigger_prototypes:
                - uuid: 366f5a856684456fbdbcb89653eeb28f
                  expression: 'last(/Proxmox VE by HTTP/proxmox_ve.node.storage.utilization[{#NODE.ID},{#STORAGE.NAME}]) > {$PVE.TRIGGER.DISK.WARNING:"{#STORAGE.NAME}"}'
                  name: 'Proxmox VE: Node [{#NODE.NAME}]: Storage [{#STORAGE.NAME}]: Usage high'
                  priority: WARNING
                  description: 'The storage usage of {#STORAGE.NAME} on the node {#NODE.NAME} is high.'
                  tags:
                    - tag: scope
                      value: notice
            - uuid: 50680ac0ba6c42c7b7b28822f41364b5
              name: 'Node [{#NODE.NAME}]: Storage [{#STORAGE.NAME}]: Get info'
              type: HTTP_AGENT
              key: 'proxmox_ve.node.storage[{#NODE.ID},{#STORAGE.NAME}]'
              delay: 1h
              history: '0'
              value_type: TEXT
              description: 'Retrieves information about the storage device "{#STORAGE.NAME}" on the node {#NODE.NAME}.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$.data[?(@.storage=="{#STORAGE.NAME}")].first()'
                  error_handler: DISCARD_VALUE
              timeout: '10'
              url: 'https://{$PVE.URL.HOST}:{$PVE.URL.PORT}/api2/json//nodes/{#NODE.NAME}/storage'
              status_codes: '200,500,595'
              http_proxy: '{$PVE.PROXY}'
              headers:
                - name: Authorization
                  value: 'PVEAPIToken={$PVE.TOKEN.ID}={$PVE.TOKEN.SECRET}'
              tags:
                - tag: component
                  value: raw
          trigger_prototypes:
            - uuid: 65718347d14743b88ffa60051f688c37
              expression: 'last(/Proxmox VE by HTTP/proxmox_ve.node.storage.used[{#NODE.ID},{#STORAGE.NAME}]) / last(/Proxmox VE by HTTP/proxmox_ve.node.storage.total[{#NODE.ID},{#STORAGE.NAME}]) * 100 > {$PVE.TRIGGER.DISK.WARNING:"{#STORAGE.NAME}"}'
              name: 'Proxmox VE: Node [{#NODE.NAME}]: Storage [{#STORAGE.NAME}]: Usage high'
              priority: WARNING
              description: 'The storage usage of {#STORAGE.NAME} on the node {#NODE.NAME} is high.'
              tags:
                - tag: scope
                  value: notice
          graph_prototypes:
            - uuid: cdc304fb2ed84bd68a81ad6ae4c757b2
              name: 'Node [{#NODE.NAME}]: Storage [{#STORAGE.NAME}]: Used'
              graph_items:
                - color: ff0000
                  item:
                    host: 'Proxmox VE by HTTP'
                    key: 'proxmox_ve.node.storage.used[{#NODE.ID},{#STORAGE.NAME}]'
                - sortorder: '1'
                  color: 00ff00
                  item:
                    host: 'Proxmox VE by HTTP'
                    key: 'proxmox_ve.node.storage.total[{#NODE.ID},{#STORAGE.NAME}]'
          parent_discovery_rule:
            key: proxmox_ve.nodes.discovery
          timeout: '10'
          url: 'https://{$PVE.URL.HOST}:{$PVE.URL.PORT}/api2/json/nodes/{#NODE.NAME}/storage'
          status_codes: '200,500,595'
          http_proxy: '{$PVE.PROXY}'
          headers:
            - name: Authorization
              value: 'PVEAPIToken={$PVE.TOKEN.ID}={$PVE.TOKEN.SECRET}'
          lld_macro_paths:
            - lld_macro: '{#STORAGE.NAME}'
              path: $.storage
            - lld_macro: '{#STORAGE.SHARED}'
              path: $.shared
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.data
              error_handler: CUSTOM_VALUE
              error_handler_params: '[]'
            - type: DISCARD_UNCHANGED_HEARTBEAT
              parameters:
                - 12h
        - uuid: e2368ac335164029bddef00a10efa820
          name: 'Proxmox nodes discovery'
          type: DEPENDENT
          key: proxmox_ve.nodes.discovery
          filter:
            evaltype: AND
            conditions:
              - macro: '{#NODE.NAME}'
                value: '{$PVE.FILTER.NODE.MATCH}'
              - macro: '{#NODE.NAME}'
                value: '{$PVE.FILTER.NODE.NOTMATCH}'
                operator: NOT_MATCHES_REGEX
              - macro: '{#NODE.STATUS}'
                value: '{$PVE.FILTER.NODE.STATUS}'
          item_prototypes:
            - uuid: f740ea0d181c47e392f8d6062af1a61a
              name: 'Node [{#NODE.NAME}]: CPU count'
              type: DEPENDENT
              key: 'proxmox_ve.node.cpu.max[{#NODE.ID}]'
              units: '!CPU'
              description: 'Retrieves the maximum CPU count of the node {#NODE.NAME}.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$.[?(@.id == "{#NODE.ID}")].maxcpu.first()'
                  error_handler: DISCARD_VALUE
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 12h
              master_item:
                key: proxmox_ve.get_node_data
              tags:
                - tag: component
                  value: cpu
                - tag: component
                  value: node
                - tag: node
                  value: '{#NODE.NAME}'
            - uuid: 3623b2e888414569871582c79026317b
              name: 'Node [{#NODE.NAME}]: CPU utilization'
              type: DEPENDENT
              key: 'proxmox_ve.node.cpu[{#NODE.ID}]'
              value_type: FLOAT
              units: '%'
              description: 'Retrieves the CPU utilization of the node {#NODE.NAME}.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$.[?(@.id == "{#NODE.ID}")].cpu.first()'
                  error_handler: DISCARD_VALUE
                - type: MULTIPLIER
                  parameters:
                    - '100'
              master_item:
                key: proxmox_ve.get_node_data
              tags:
                - tag: component
                  value: cpu
                - tag: component
                  value: node
                - tag: node
                  value: '{#NODE.NAME}'
              trigger_prototypes:
                - uuid: 7b583e627961448cb9b580fdce9697ad
                  expression: 'avg(/Proxmox VE by HTTP/proxmox_ve.node.cpu[{#NODE.ID}], 5m) > {$PVE.TRIGGER.CPU.WARNING:"{#NODE.NAME}"}'
                  name: 'Proxmox VE: Node [{#NODE.NAME}] CPU utilization high'
                  priority: WARNING
                  description: 'The CPU utilization of the node {#NODE.NAME} is high.'
                  tags:
                    - tag: scope
                      value: node
                    - tag: scope
                      value: performance
            - uuid: 06e86fe02b47408cb06ee7573eb3daf8
              name: 'Node [{#NODE.NAME}]: Disk utilization'
              type: CALCULATED
              key: 'proxmox_ve.node.disk.utilization[{#NODE.ID}]'
              value_type: FLOAT
              units: '%'
              params: 'last(//proxmox_ve.node.disk[{#NODE.ID}]) / last(//proxmox_ve.node.maxdisk[{#NODE.ID}]) * 100'
              description: 'Retrieves the disk utilization percentage for the node {#NODE.NAME}.'
              preprocessing:
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 1h
              tags:
                - tag: component
                  value: disk
                - tag: component
                  value: node
                - tag: node
                  value: '{#NODE.NAME}'
              trigger_prototypes:
                - uuid: 5242f0529716497e976ea3d1f9455ef4
                  expression: 'avg(/Proxmox VE by HTTP/proxmox_ve.node.disk.utilization[{#NODE.ID}], 5m) > {$PVE.TRIGGER.DISK.WARNING:"{#NODE.NAME}"}'
                  name: 'Proxmox VE: Node [{#NODE.NAME}] disk utilization high'
                  priority: WARNING
                  description: 'The disk utilization of the node {#NODE.NAME} is high.'
                  tags:
                    - tag: scope
                      value: capacity
                    - tag: scope
                      value: node
            - uuid: 1143bf5a89a243fa805055432eaef82d
              name: 'Node [{#NODE.NAME}]: Disk used'
              type: DEPENDENT
              key: 'proxmox_ve.node.disk[{#NODE.ID}]'
              units: B
              description: 'Retrieves the disk used by the node {#NODE.NAME}.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$.[?(@.id == "{#NODE.ID}")].disk.first()'
                  error_handler: DISCARD_VALUE
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 1h
              master_item:
                key: proxmox_ve.get_node_data
              tags:
                - tag: component
                  value: disk
                - tag: component
                  value: node
                - tag: node
                  value: '{#NODE.NAME}'
            - uuid: 357ea448aa994da6bd7b613775c661dc
              name: 'Node [{#NODE.NAME}]: Number of PCI devices'
              type: HTTP_AGENT
              key: 'proxmox_ve.node.hardware.pci[{#NODE.ID}]'
              delay: 1h
              description: 'Retrieves the number of PCI devices on the node {#NODE.NAME}.'
              valuemap:
                name: 'Proxmox node PCI/USB devices'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.data.length()
                  error_handler: CUSTOM_VALUE
                  error_handler_params: '0'
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 12h
              timeout: '10'
              url: 'https://{$PVE.URL.HOST}:{$PVE.URL.PORT}/api2/json//nodes/{#NODE.NAME}/hardware/pci'
              status_codes: '200,500,595'
              http_proxy: '{$PVE.PROXY}'
              headers:
                - name: Authorization
                  value: 'PVEAPIToken={$PVE.TOKEN.ID}={$PVE.TOKEN.SECRET}'
              tags:
                - tag: component
                  value: hardware
                - tag: component
                  value: node
                - tag: hardware
                  value: pci
                - tag: node
                  value: '{#NODE.NAME}'
              trigger_prototypes:
                - uuid: 43e606503d7d424294b708b69d3cc3b4
                  expression: 'change(/Proxmox VE by HTTP/proxmox_ve.node.hardware.pci[{#NODE.ID}]) <> 0'
                  name: 'Proxmox VE: Node [{#NODE.NAME}] changed number of PCI devices'
                  priority: INFO
                  description: 'The number of PCI devices on the node {#NODE.NAME} has changed.'
                  manual_close: 'YES'
            - uuid: d2a13387aa4f4ac0b811634630607d57
              name: 'Node [{#NODE.NAME}]: Number of USB devices'
              type: HTTP_AGENT
              key: 'proxmox_ve.node.hardware.usb[{#NODE.ID}]'
              delay: 1h
              description: 'Retrieves the number of USB devices on the node {#NODE.NAME}.'
              valuemap:
                name: 'Proxmox node PCI/USB devices'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.data.length()
                  error_handler: CUSTOM_VALUE
                  error_handler_params: '0'
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 12h
              timeout: '10'
              url: 'https://{$PVE.URL.HOST}:{$PVE.URL.PORT}/api2/json//nodes/{#NODE.NAME}/hardware/usb'
              status_codes: '200,500,595'
              http_proxy: '{$PVE.PROXY}'
              headers:
                - name: Authorization
                  value: 'PVEAPIToken={$PVE.TOKEN.ID}={$PVE.TOKEN.SECRET}'
              tags:
                - tag: component
                  value: hardware
                - tag: component
                  value: node
                - tag: hardware
                  value: usb
                - tag: node
                  value: '{#NODE.NAME}'
              trigger_prototypes:
                - uuid: e2b3c254d6c14e40adc19ebacc58d5c7
                  expression: 'change(/Proxmox VE by HTTP/proxmox_ve.node.hardware.usb[{#NODE.ID}]) <> 0'
                  name: 'Proxmox VE: Node [{#NODE.NAME}] changed number of USB devices'
                  priority: INFO
                  description: 'The number of USB devices on the node {#NODE.NAME} has changed.'
                  manual_close: 'YES'
            - uuid: 1936539905a643869db29b38b3c5c4ae
              name: 'Node [{#NODE.NAME}]: IP address'
              type: DEPENDENT
              key: 'proxmox_ve.node.ip[{#NODE.ID}]'
              value_type: CHAR
              description: 'Retrieves the IP address of the node {#NODE.NAME}.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$.data.nodes["{#NODE.NAME}"].ip'
                  error_handler: CUSTOM_VALUE
                  error_handler_params: Unknown
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 12h
              master_item:
                key: proxmox_ve.cluster.resources.get
              tags:
                - tag: component
                  value: network
                - tag: component
                  value: node
                - tag: node
                  value: '{#NODE.NAME}'
            - uuid: 26f241c06bd549d9a275da63fa5e3005
              name: 'Node [{#NODE.NAME}]: Time (local)'
              type: DEPENDENT
              key: 'proxmox_ve.node.localtime[{#NODE.ID}]'
              units: unixtime
              description: 'Retrieves the local time of the node {#NODE.NAME}.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.localtime
                  error_handler: CUSTOM_VALUE
                  error_handler_params: '0'
              master_item:
                key: 'proxmox_ve.node.time.info[{#NODE.ID}]'
              tags:
                - tag: component
                  value: node
                - tag: component
                  value: time
                - tag: node
                  value: '{#NODE.NAME}'
            - uuid: 466efa04cd384304b88e071f40bb7d71
              name: 'Node [{#NODE.NAME}]: Disk total'
              type: DEPENDENT
              key: 'proxmox_ve.node.maxdisk[{#NODE.ID}]'
              units: B
              description: 'Retrieves the total disk space on the node {#NODE.NAME}.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$.[?(@.id == "{#NODE.ID}")].maxdisk.first()'
                  error_handler: DISCARD_VALUE
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 12h
              master_item:
                key: proxmox_ve.get_node_data
              tags:
                - tag: component
                  value: disk
                - tag: component
                  value: node
                - tag: node
                  value: '{#NODE.NAME}'
            - uuid: 33b2e681a3444ca2aaf783ff1b4c2262
              name: 'Node [{#NODE.NAME}]: Memory total'
              type: DEPENDENT
              key: 'proxmox_ve.node.maxmem[{#NODE.ID}]'
              units: B
              description: 'Retrieves the total memory on the node {#NODE.NAME}.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$.[?(@.id == "{#NODE.ID}")].maxmem.first()'
                  error_handler: DISCARD_VALUE
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 12h
              master_item:
                key: proxmox_ve.get_node_data
              tags:
                - tag: component
                  value: memory
                - tag: component
                  value: node
                - tag: node
                  value: '{#NODE.NAME}'
            - uuid: bda2c8134071495aa81c1d3be7b7aafb
              name: 'Node [{#NODE.NAME}]: Memory utilization'
              type: CALCULATED
              key: 'proxmox_ve.node.mem.utilization[{#NODE.ID}]'
              value_type: FLOAT
              units: '%'
              params: 'last(//proxmox_ve.node.mem[{#NODE.ID}]) / last(//proxmox_ve.node.maxmem[{#NODE.ID}]) * 100'
              description: 'Retrieves the memory utilization percentage for the node {#NODE.NAME}.'
              preprocessing:
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 1h
              tags:
                - tag: component
                  value: memory
                - tag: component
                  value: node
                - tag: node
                  value: '{#NODE.NAME}'
              trigger_prototypes:
                - uuid: 868833059aab4d2dbc71ef5a8ddf2684
                  expression: 'avg(/Proxmox VE by HTTP/proxmox_ve.node.mem.utilization[{#NODE.ID}], 5m) > {$PVE.TRIGGER.MEMORY.WARNING:"{#NODE.NAME}"}'
                  name: 'Proxmox VE: Node [{#NODE.NAME}] memory utilization high'
                  priority: WARNING
                  description: 'The memory utilization of the node {#NODE.NAME} is high.'
                  tags:
                    - tag: scope
                      value: node
                    - tag: scope
                      value: performance
            - uuid: a9b3314f781b4c139eeadec13c8ca545
              name: 'Node [{#NODE.NAME}]: Memory used'
              type: DEPENDENT
              key: 'proxmox_ve.node.mem[{#NODE.ID}]'
              units: B
              description: 'Retrieves the memory used by the node {#NODE.NAME}.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$.[?(@.id == "{#NODE.ID}")].mem.first()'
                  error_handler: DISCARD_VALUE
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 1h
              master_item:
                key: proxmox_ve.get_node_data
              tags:
                - tag: component
                  value: memory
                - tag: component
                  value: node
                - tag: node
                  value: '{#NODE.NAME}'
            - uuid: 836090c775494266ab89ca15de989477
              name: 'Node [{#NODE.NAME}]: Status'
              type: DEPENDENT
              key: 'proxmox_ve.node.status[{#NODE.ID}]'
              description: 'Retrieves the status of the node {#NODE.NAME}.'
              valuemap:
                name: 'Proxmox node status'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$.[?(@.id == "{#NODE.ID}")].status.first()'
                  error_handler: CUSTOM_VALUE
                  error_handler_params: unknown
                - type: JAVASCRIPT
                  parameters:
                    - |
                      const status_map = {
                      	'online': '10',
                      	'unknown': '5',
                      	'offline': '1'
                      };
                      
                      return typeof status_map[value] === 'undefined' ? '0' : status_map[value];
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 12h
              master_item:
                key: proxmox_ve.get_node_data
              tags:
                - tag: component
                  value: node
                - tag: node
                  value: '{#NODE.NAME}'
              trigger_prototypes:
                - uuid: 5b79405280c04f55b53b0128026e916f
                  expression: 'last(/Proxmox VE by HTTP/proxmox_ve.node.status[{#NODE.ID}]) <> 10'
                  name: 'Proxmox VE: Node [{#NODE.NAME}] not online'
                  priority: WARNING
                  description: 'The node {#NODE.NAME} is not online.'
                  manual_close: 'YES'
            - uuid: 9d296d36d26648f3be04b2d154434b87
              name: 'Node [{#NODE.NAME}]: Subscribe level'
              type: DEPENDENT
              key: 'proxmox_ve.node.subscribe[{#NODE.ID}]'
              value_type: CHAR
              description: 'Retrieves the subscription level of the node {#NODE.NAME}.'
              valuemap:
                name: 'Proxmox subscription level'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$.data.nodes["{#NODE.NAME}"].level'
                  error_handler: CUSTOM_VALUE
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 12h
              master_item:
                key: proxmox_ve.cluster.resources.get
              tags:
                - tag: component
                  value: node
                - tag: node
                  value: '{#NODE.NAME}'
            - uuid: 565d91b3cab74c52968c6ed244717225
              name: 'Node [{#NODE.NAME}]: Time info'
              type: HTTP_AGENT
              key: 'proxmox_ve.node.time.info[{#NODE.ID}]'
              delay: 10m
              history: '0'
              value_type: TEXT
              description: 'Retrieves the current time on the node {#NODE.NAME}.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.data
                  error_handler: CUSTOM_VALUE
                  error_handler_params: '0'
              timeout: '10'
              url: 'https://{$PVE.URL.HOST}:{$PVE.URL.PORT}/api2/json//nodes/{#NODE.NAME}/time'
              status_codes: '200,500,595'
              http_proxy: '{$PVE.PROXY}'
              headers:
                - name: Authorization
                  value: 'PVEAPIToken={$PVE.TOKEN.ID}={$PVE.TOKEN.SECRET}'
              tags:
                - tag: component
                  value: raw
            - uuid: fd3dd8ae953e4c4db06e67986f46f070
              name: 'Node [{#NODE.NAME}]: Time zone'
              type: DEPENDENT
              key: 'proxmox_ve.node.timezone[{#NODE.ID}]'
              value_type: CHAR
              description: 'Retrieves the timezone of the node {#NODE.NAME}.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.timezone
                  error_handler: CUSTOM_VALUE
                  error_handler_params: Unknown
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 12h
              master_item:
                key: 'proxmox_ve.node.time.info[{#NODE.ID}]'
              tags:
                - tag: component
                  value: node
                - tag: component
                  value: time
                - tag: node
                  value: '{#NODE.NAME}'
            - uuid: 10ac244555b94ef391129bd6c1fd4508
              name: 'Node [{#NODE.NAME}]: Time'
              type: DEPENDENT
              key: 'proxmox_ve.node.time[{#NODE.ID}]'
              units: unixtime
              description: 'Retrieves the current time on the node {#NODE.NAME}.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.time
                  error_handler: CUSTOM_VALUE
                  error_handler_params: '0'
              master_item:
                key: 'proxmox_ve.node.time.info[{#NODE.ID}]'
              tags:
                - tag: component
                  value: node
                - tag: component
                  value: time
                - tag: node
                  value: '{#NODE.NAME}'
            - uuid: f2dd7010e59e4af6a897ff8ad2e2b480
              name: 'Node [{#NODE.NAME}]: Available updates'
              type: HTTP_AGENT
              key: 'proxmox_ve.node.updates[{#NODE.ID}]'
              delay: 12h
              valuemap:
                name: 'Proxmox node apt updates'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.data.length()
                  error_handler: CUSTOM_VALUE
                  error_handler_params: '0'
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 12h
              timeout: '10'
              url: 'https://{$PVE.URL.HOST}:{$PVE.URL.PORT}/api2/json//nodes/{#NODE.NAME}/apt/update'
              status_codes: '200,500,595'
              http_proxy: '{$PVE.PROXY}'
              headers:
                - name: Authorization
                  value: 'PVEAPIToken={$PVE.TOKEN.ID}={$PVE.TOKEN.SECRET}'
              tags:
                - tag: component
                  value: node
                - tag: component
                  value: updates
                - tag: node
                  value: '{#NODE.NAME}'
              trigger_prototypes:
                - uuid: 7acbdb1ffd9648a692844c916a5c3822
                  expression: 'last(/Proxmox VE by HTTP/proxmox_ve.node.updates[{#NODE.ID}]) > 0'
                  name: 'Proxmox VE: Node [{#NODE.NAME}] has available updates'
                  priority: INFO
                  description: 'The node {#NODE.NAME} has available updates.'
                  tags:
                    - tag: scope
                      value: node
                    - tag: scope
                      value: notice
            - uuid: 0fb93d390b804a0498bbbcca31c0c229
              name: 'Node [{#NODE.NAME}]: Uptime'
              type: DEPENDENT
              key: 'proxmox_ve.node.uptime[{#NODE.ID}]'
              units: uptime
              description: 'Retrieves the uptime of the node {#NODE.NAME}.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$.[?(@.id == "{#NODE.ID}")].uptime.first()'
                  error_handler: DISCARD_VALUE
              master_item:
                key: proxmox_ve.get_node_data
              tags:
                - tag: component
                  value: node
                - tag: component
                  value: uptime
                - tag: node
                  value: '{#NODE.NAME}'
              trigger_prototypes:
                - uuid: 2e78d1cf8a9d4af68aa464433e356a75
                  expression: 'last(/Proxmox VE by HTTP/proxmox_ve.node.uptime[{#NODE.ID}]) < {$PVE.TRIGGER.UPTIME:"{#NODE.NAME}"}'
                  name: 'Proxmox VE: Node [{#NODE.NAME}] has been restarted'
                  priority: INFO
                  description: 'The node {#NODE.NAME} has been restarted.'
            - uuid: fd98043c577b4697992da7daf5a838b4
              name: 'Node [{#NODE.NAME}]: Version'
              type: HTTP_AGENT
              key: 'proxmox_ve.node.version[{#NODE.ID}]'
              delay: 12h
              value_type: CHAR
              description: 'Retrieves the version of the Proxmox VE on the node {#NODE.NAME}.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - $.data.version
                  error_handler: CUSTOM_VALUE
                  error_handler_params: Unknown
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 12h
              timeout: '10'
              url: 'https://{$PVE.URL.HOST}:{$PVE.URL.PORT}/api2/json//nodes/{#NODE.NAME}/version'
              status_codes: '200,500,595'
              http_proxy: '{$PVE.PROXY}'
              headers:
                - name: Authorization
                  value: 'PVEAPIToken={$PVE.TOKEN.ID}={$PVE.TOKEN.SECRET}'
              tags:
                - tag: component
                  value: node
                - tag: component
                  value: version
                - tag: node
                  value: '{#NODE.NAME}'
              trigger_prototypes:
                - uuid: b3d2124cd95d4643a6645abf8ba617dd
                  expression: 'change(/Proxmox VE by HTTP/proxmox_ve.node.version[{#NODE.ID}]) = 1'
                  name: 'Proxmox VE: Node [{#NODE.NAME}] version changed'
                  priority: INFO
                  description: 'The version of Proxmox VE on the node {#NODE.NAME} has changed.'
                  manual_close: 'YES'
          graph_prototypes:
            - uuid: 72016662d4ce4e4b8b63784bacae3edf
              name: 'Node [{#NODE.NAME}] CPU utilization'
              graph_items:
                - color: ff0000
                  item:
                    host: 'Proxmox VE by HTTP'
                    key: 'proxmox_ve.node.cpu[{#NODE.ID}]'
            - uuid: 6efe6c53b76a4352abbdbcde2c58d9d0
              name: 'Node [{#NODE.NAME}] disk'
              graph_items:
                - drawtype: BOLD_LINE
                  color: ff0000
                  item:
                    host: 'Proxmox VE by HTTP'
                    key: 'proxmox_ve.node.disk[{#NODE.ID}]'
                - sortorder: '1'
                  drawtype: GRADIENT_LINE
                  color: 00ff00
                  item:
                    host: 'Proxmox VE by HTTP'
                    key: 'proxmox_ve.node.maxdisk[{#NODE.ID}]'
            - uuid: 3ff711688d9249e8a1bb8ca82aa02663
              name: 'Node [{#NODE.NAME}] memory'
              graph_items:
                - drawtype: BOLD_LINE
                  color: ff0000
                  item:
                    host: 'Proxmox VE by HTTP'
                    key: 'proxmox_ve.node.mem[{#NODE.ID}]'
                - sortorder: '1'
                  drawtype: GRADIENT_LINE
                  color: 00ff00
                  item:
                    host: 'Proxmox VE by HTTP'
                    key: 'proxmox_ve.node.maxmem[{#NODE.ID}]'
            - uuid: 1c1bc130956148b496979d19b1243314
              name: 'Node [{#NODE.NAME}] status'
              graph_items:
                - drawtype: DOTTED_LINE
                  color: 0004ff
                  item:
                    host: 'Proxmox VE by HTTP'
                    key: 'proxmox_ve.node.status[{#NODE.ID}]'
          master_item:
            key: proxmox_ve.get_node_data
          lld_macro_paths:
            - lld_macro: '{#NODE.CPU.MAX}'
              path: $.maxcpu
            - lld_macro: '{#NODE.CPU}'
              path: $.cpu
            - lld_macro: '{#NODE.DISK.MAX}'
              path: $.maxdisk
            - lld_macro: '{#NODE.DISK}'
              path: $.disk
            - lld_macro: '{#NODE.ID}'
              path: $.id
            - lld_macro: '{#NODE.MEMORY.MAX}'
              path: $.maxmem
            - lld_macro: '{#NODE.MEMORY}'
              path: $.mem
            - lld_macro: '{#NODE.NAME}'
              path: $.node
            - lld_macro: '{#NODE.STATUS}'
              path: $.status
            - lld_macro: '{#NODE.UPTIME}'
              path: $.uptime
          overrides:
            - name: 'Override for "cpu" macro'
              step: '1'
              filter:
                conditions:
                  - macro: '{#NODE.CPU}'
                    operator: NOT_EXISTS
              operations:
                - operator: REGEXP
                  value: ': CPU utilization$'
                  discover: NO_DISCOVER
            - name: 'Override for "maxcpu" macro'
              step: '2'
              filter:
                conditions:
                  - macro: '{#NODE.CPU.MAX}'
                    operator: NOT_EXISTS
              operations:
                - operator: REGEXP
                  value: ': CPU count$'
                  discover: NO_DISCOVER
            - name: 'Override for "mem" macro'
              step: '3'
              filter:
                conditions:
                  - macro: '{#NODE.MEMORY}'
                    operator: NOT_EXISTS
              operations:
                - operator: REGEXP
                  value: ': Memory used$'
                  discover: NO_DISCOVER
                - operator: REGEXP
                  value: ': Memory utilization$'
                  discover: NO_DISCOVER
            - name: 'Override for "maxmem" macro'
              step: '4'
              filter:
                conditions:
                  - macro: '{#NODE.MEMORY.MAX}'
                    operator: NOT_EXISTS
              operations:
                - operator: REGEXP
                  value: ': Memory total$'
                  discover: NO_DISCOVER
            - name: 'Override for "disk" macro'
              step: '5'
              filter:
                conditions:
                  - macro: '{#NODE.DISK}'
                    operator: NOT_EXISTS
              operations:
                - operator: REGEXP
                  value: ': Disk used$'
                  discover: NO_DISCOVER
            - name: 'Override for "maxdisk" macro'
              step: '6'
              filter:
                conditions:
                  - macro: '{#NODE.DISK.MAX}'
                    operator: NOT_EXISTS
              operations:
                - operator: REGEXP
                  value: ': Disk total$'
                  discover: NO_DISCOVER
            - name: 'Override for "uptime" macro'
              step: '7'
              filter:
                conditions:
                  - macro: '{#NODE.UPTIME}'
                    operator: NOT_EXISTS
              operations:
                - operator: REGEXP
                  value: ': Uptime$'
                  discover: NO_DISCOVER
            - name: 'Disable discovery of node certificates'
              step: '8'
              filter:
                conditions:
                  - macro: '{#NODE.NAME}'
                    value: '{$PVE.LLD.ENABLE.CERT}'
                    operator: NOT_MATCHES_REGEX
              operations:
                - operationobject: LLD_RULE_PROTOTYPE
                  operator: REGEXP
                  value: ' Certificate discovery$'
                  discover: NO_DISCOVER
            - name: 'Disable discovery of node disks'
              step: '9'
              filter:
                conditions:
                  - macro: '{#NODE.NAME}'
                    value: '{$PVE.LLD.ENABLE.DISK}'
                    operator: NOT_MATCHES_REGEX
              operations:
                - operationobject: LLD_RULE_PROTOTYPE
                  operator: REGEXP
                  value: ' Disks discovery$'
                  discover: NO_DISCOVER
            - name: 'Disable discovery of node storage'
              step: '10'
              filter:
                conditions:
                  - macro: '{#NODE.NAME}'
                    value: '{$PVE.LLD.ENABLE.STORAGE}'
                    operator: NOT_MATCHES_REGEX
              operations:
                - operationobject: LLD_RULE_PROTOTYPE
                  operator: REGEXP
                  value: ' Storage discovery$'
                  discover: NO_DISCOVER
        - uuid: e051676e5cef47038470f58d60519953
          name: 'Proxmox shared storage discovery'
          type: DEPENDENT
          key: proxmox_ve.shared.storage.discovery
          filter:
            evaltype: AND
            conditions:
              - macro: '{#STORAGE.NAME}'
                value: '{$PVE.FILTER.STORAGE.NAME.MATCH}'
              - macro: '{#STORAGE.NAME}'
                value: '{$PVE.FILTER.STORAGE.NAME.NOTMATCH}'
                operator: NOT_MATCHES_REGEX
          item_prototypes:
            - uuid: 84569e8824394c5fa7a842840bef688e
              name: 'Storage [{#STORAGE.NAME}]: Content'
              type: DEPENDENT
              key: 'proxmox_ve.storage.content[{#STORAGE.NAME}]'
              value_type: CHAR
              description: 'Retrieves the content type of shared storage {#STORAGE.NAME}.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$.data.storage.list[?(@.storage == "{#STORAGE.NAME}")].content.first()'
                  error_handler: CUSTOM_VALUE
                  error_handler_params: unknown
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 1h
              master_item:
                key: proxmox_ve.cluster.resources.get
              tags:
                - tag: component
                  value: storage
                - tag: storage
                  value: '{#STORAGE.NAME}'
            - uuid: 0f3db2e0ae4f4cd68411c710d5d12c9e
              name: 'Storage [{#STORAGE.NAME}]: Total'
              type: DEPENDENT
              key: 'proxmox_ve.storage.total[{#STORAGE.NAME}]'
              units: B
              description: 'Retrieves the total size of shared storage {#STORAGE.NAME}.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$.data.storage.list[?(@.storage == "{#STORAGE.NAME}")].maxdisk.first()'
                  error_handler: CUSTOM_VALUE
                  error_handler_params: '0'
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 1h
              master_item:
                key: proxmox_ve.cluster.resources.get
              tags:
                - tag: component
                  value: storage
                - tag: storage
                  value: '{#STORAGE.NAME}'
            - uuid: 2692019e125f4aee91dc3f7a25bfe5a1
              name: 'Storage [{#STORAGE.NAME}]: Type'
              type: DEPENDENT
              key: 'proxmox_ve.storage.type[{#STORAGE.NAME}]'
              value_type: CHAR
              description: 'Retrieves the type of shared storage {#STORAGE.NAME}.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$.data.storage.list[?(@.storage == "{#STORAGE.NAME}")].plugintype.first()'
                  error_handler: CUSTOM_VALUE
                  error_handler_params: unknown
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 1h
              master_item:
                key: proxmox_ve.cluster.resources.get
              tags:
                - tag: component
                  value: storage
                - tag: storage
                  value: '{#STORAGE.NAME}'
            - uuid: f461c12c867b4f9899b4859201b3bd3f
              name: 'Storage [{#STORAGE.NAME}]: Used'
              type: DEPENDENT
              key: 'proxmox_ve.storage.used[{#STORAGE.NAME}]'
              units: B
              description: 'Retrieves the used size of shared storage {#STORAGE.NAME}.'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$.data.storage.list[?(@.storage == "{#STORAGE.NAME}")].disk.first()'
                  error_handler: CUSTOM_VALUE
                  error_handler_params: '0'
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 1h
              master_item:
                key: proxmox_ve.cluster.resources.get
              tags:
                - tag: component
                  value: storage
                - tag: storage
                  value: '{#STORAGE.NAME}'
            - uuid: 9fc8137e40fc4a17a67704fc0bbdb70c
              name: 'Storage [{#STORAGE.NAME}]: Utilization'
              type: CALCULATED
              key: 'proxmox_ve.storage.utilization[{#STORAGE.NAME}]'
              value_type: FLOAT
              units: '%'
              params: 'last(//proxmox_ve.storage.used[{#STORAGE.NAME}]) / last(//proxmox_ve.storage.total[{#STORAGE.NAME}]) * 100'
              description: 'Retrieves the storage utilization percentage for shared storage {#STORAGE.NAME}.'
              preprocessing:
                - type: DISCARD_UNCHANGED_HEARTBEAT
                  parameters:
                    - 1h
              tags:
                - tag: component
                  value: storage
                - tag: storage
                  value: '{#STORAGE.NAME}'
          master_item:
            key: proxmox_ve.cluster.resources.get
          lld_macro_paths:
            - lld_macro: '{#STORAGE.NAME}'
              path: $.storage
            - lld_macro: '{#STORAGE.TYPE}'
              path: $.plugintype
          preprocessing:
            - type: JSONPATH
              parameters:
                - $.data.storage.list
              error_handler: CUSTOM_VALUE
              error_handler_params: '[]'
        - uuid: 245eb79c15e047d592b5a7678682f352
          name: 'Proxmox users discovery'
          type: DEPENDENT
          key: proxmox_ve.users.discovery
          filter:
            evaltype: AND
            conditions:
              - macro: '{#USER.FULLNAME}'
                value: '{$PVE.FILTER.USER.MATCH}'
              - macro: '{#USER.FULLNAME}'
                value: '{$PVE.FILTER.USER.NOTMATCH}'
                operator: NOT_MATCHES_REGEX
          item_prototypes:
            - uuid: 096a3bd30de646518f9d72983fd0d06f
              name: 'User [{#USER.FULLNAME}]: Enabled'
              type: DEPENDENT
              key: 'proxmox_ve.user.enabled[{#USER.ID}]'
              description: 'Retrieves enabled status for the user {#USER.FIRSTNAME} {#USER.LASTNAME} ({#USER.ID}).'
              valuemap:
                name: 'Proxmox user enabled status'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$.data[?(@.userid == "{#USER.ID}")].enable.first()'
                  error_handler: CUSTOM_VALUE
                  error_handler_params: '0'
              master_item:
                key: proxmox_ve.get_user_data
              tags:
                - tag: component
                  value: user
                - tag: user
                  value: '{#USER.ID}'
              trigger_prototypes:
                - uuid: 2680a1a2d6f743cf9381255dd7fea570
                  expression: 'change(/Proxmox VE by HTTP/proxmox_ve.user.enabled[{#USER.ID}]) <> 0'
                  name: 'Proxmox VE: User [{#USER.FULLNAME}] enabled status changed'
                  priority: INFO
                  description: 'The user {#USER.FULLNAME} enabled status has changed.'
                  manual_close: 'YES'
            - uuid: 2995051bb2984c3ca382270a06c7c055
              name: 'User [{#USER.FULLNAME}]: Expire after'
              type: DEPENDENT
              key: 'proxmox_ve.user.expire[{#USER.ID}]'
              value_type: FLOAT
              units: uptime
              description: |
                Retrieves the expiration time for the user {#USER.FULLNAME}.
                The value is calculated as the difference between the current time and the expiration time.
              valuemap:
                name: 'Proxmox user expire date'
              preprocessing:
                - type: JSONPATH
                  parameters:
                    - '$.data[?(@.userid == "{#USER.ID}")].expire.first()'
                  error_handler: CUSTOM_VALUE
                  error_handler_params: '0'
                - type: JAVASCRIPT
                  parameters:
                    - |
                      if (value === '0') {
                      	return -1;
                      } else if (parseInt(value) <= Date.now() / 1000) {
                      	return 0;
                      } else {
                      	return Math.trunc(parseInt(value) - Date.now() / 1000);
                      }
              master_item:
                key: proxmox_ve.get_user_data
              tags:
                - tag: component
                  value: user
                - tag: user
                  value: '{#USER.ID}'
          trigger_prototypes:
            - uuid: c22fb47f8bc8436291ed0efeb245b022
              expression: 'last(/Proxmox VE by HTTP/proxmox_ve.user.expire[{#USER.ID}]) = 0 and last(/Proxmox VE by HTTP/proxmox_ve.user.enabled[{#USER.ID}]) = 1'
              name: 'Proxmox VE: User [{#USER.FULLNAME}] expired'
              priority: INFO
              description: 'The user {#USER.FULLNAME} has expired.'
              manual_close: 'YES'
          master_item:
            key: proxmox_ve.get_user_data
          lld_macro_paths:
            - lld_macro: '{#USER.FIRSTNAME}'
              path: $.firstname
            - lld_macro: '{#USER.FULLNAME}'
              path: $.fullname
            - lld_macro: '{#USER.ID}'
              path: $.userid
            - lld_macro: '{#USER.LASTNAME}'
              path: $.lastname
      tags:
        - tag: class
          value: software
        - tag: subclass
          value: virtualization
        - tag: target
          value: proxmox
      macros:
        - macro: '{$PVE.FILTER.CERT.FILE.MATCH}'
          value: '.*'
          description: 'Filter for certificate file discovery by name.'
          config:
            type: TEXT
            priority: '22'
            section_name: Filters
            label: 'Certificate file discovery filter'
            description: 'The filter for certificate file discovery by name.'
            regex: '.*'
        - macro: '{$PVE.FILTER.CERT.FILE.NOTMATCH}'
          value: CHANGE_ME_IF_NEEDED
          description: 'Exclude filter for certificate file discovery by name.'
          config:
            type: TEXT
            priority: '23'
            section_name: Filters
            label: 'Certificate file discovery exclude filter'
            description: 'The exclude filter for certificate file discovery by name.'
            regex: '.*'
        - macro: '{$PVE.FILTER.DISK.MATCH}'
          value: '.*'
          description: 'Filter for disk discovery by name.'
          config:
            type: TEXT
            priority: '25'
            section_name: Filters
            label: 'Disk discovery filter'
            description: 'The filter for disk discovery by name.'
            regex: '.*'
        - macro: '{$PVE.FILTER.DISK.NOTMATCH}'
          value: CHANGE_ME_IF_NEEDED
          description: 'Exclude filter for disk discovery by name.'
          config:
            type: TEXT
            priority: '26'
            section_name: Filters
            label: 'Disk discovery exclude filter'
            description: 'The exclude filter for disk discovery by name.'
            regex: '.*'
        - macro: '{$PVE.FILTER.LXC.MATCH}'
          value: '.*'
          description: 'Filter for LXC discovery by name.'
          config:
            type: TEXT
            priority: '29'
            section_name: Filters
            label: 'LXC discovery filter'
            description: 'The filter for LXC discovery by name.'
            regex: '.*'
        - macro: '{$PVE.FILTER.LXC.NOTMATCH}'
          value: CHANGE_ME_IF_NEEDED
          description: 'Exclude filter for LXC discovery by name.'
          config:
            type: TEXT
            priority: '30'
            section_name: Filters
            label: 'LXC discovery exclude filter'
            description: 'The exclude filter for LXC discovery by name.'
            regex: '.*'
        - macro: '{$PVE.FILTER.NODE.MATCH}'
          value: '.*'
          description: 'Filter for node discovery by name.'
          config:
            type: TEXT
            priority: '11'
            section_name: Filters
            label: 'Node discovery filter'
            description: 'The filter for node discovery by name.'
            regex: '.*'
        - macro: '{$PVE.FILTER.NODE.NOTMATCH}'
          value: CHANGE_ME_IF_NEEDED
          description: 'Exclude filter for node discovery by name.'
          config:
            type: TEXT
            priority: '12'
            section_name: Filters
            label: 'Node discovery exclude filter'
            description: 'The exclude filter for node discovery by name.'
            regex: '.*'
        - macro: '{$PVE.FILTER.NODE.STATUS}'
          value: '.*'
          description: 'Filter for node discovery by status.'
          config:
            type: CHECKBOX
            priority: '13'
            section_name: Other
            label: 'Discovery only online nodes'
            description: 'The filter for node discovery by status.'
            options:
              - checked: online
                unchecked: '.*'
        - macro: '{$PVE.FILTER.QEMU.FS.MOUNT_POINT.MATCH}'
          value: '.*'
          description: 'Filter for QEMU virtual machine filesystem discovery by mount point.'
          config:
            type: TEXT
            priority: '33'
            section_name: Filters
            label: 'QEMU virtual machine filesystem mount point discovery filter'
            description: 'The filter for QEMU virtual machine filesystem discovery by mount point.'
            regex: '.*'
        - macro: '{$PVE.FILTER.QEMU.FS.MOUNT_POINT.NOTMATCH}'
          value: CHANGE_ME_IF_NEEDED
          description: 'Exclude filter for QEMU virtual machine filesystem discovery by mount point.'
          config:
            type: TEXT
            priority: '34'
            section_name: Filters
            label: 'QEMU virtual machine filesystem mount point discovery exclude filter'
            description: 'The exclude filter for QEMU virtual machine filesystem discovery by mount point.'
            regex: '.*'
        - macro: '{$PVE.FILTER.QEMU.FS.TYPE.MATCH}'
          value: '.*'
          description: 'Filter for QEMU virtual machine filesystem discovery by type.'
          config:
            type: TEXT
            priority: '35'
            section_name: Filters
            label: 'QEMU virtual machine filesystem type discovery filter'
            description: 'The filter for QEMU virtual machine filesystem discovery by type.'
            regex: '.*'
        - macro: '{$PVE.FILTER.QEMU.FS.TYPE.NOTMATCH}'
          value: CHANGE_ME_IF_NEEDED
          description: 'Exclude filter for QEMU virtual machine filesystem discovery by type.'
          config:
            type: TEXT
            priority: '36'
            section_name: Filters
            label: 'QEMU virtual machine filesystem type discovery exclude filter'
            description: 'The exclude filter for QEMU virtual machine filesystem discovery by type.'
            regex: '.*'
        - macro: '{$PVE.FILTER.QEMU.MATCH}'
          value: '.*'
          description: 'Filter for QEMU virtual machine discovery by name.'
          config:
            type: TEXT
            priority: '31'
            section_name: Filters
            label: 'QEMU virtual machine discovery filter'
            description: 'The filter for QEMU virtual machine discovery by name.'
            regex: '.*'
        - macro: '{$PVE.FILTER.QEMU.NET.IFACE.NAME.MATCH}'
          value: '.*'
          description: 'Filter for QEMU virtual machine network interface discovery by name.'
          config:
            type: TEXT
            priority: '41'
            section_name: Filters
            label: 'QEMU virtual machine network interface discovery filter'
            description: 'The filter for QEMU virtual machine network interface discovery by name.'
            regex: '.*'
        - macro: '{$PVE.FILTER.QEMU.NET.IFACE.NAME.NOTMATCH}'
          value: 'lo|Loopback.*'
          description: 'Exclude filter for QEMU virtual machine network interface discovery by name.'
          config:
            type: TEXT
            priority: '42'
            section_name: Filters
            label: 'QEMU virtual machine network interface discovery exclude filter'
            description: 'The exclude filter for QEMU virtual machine network interface discovery by name.'
            regex: '.*'
        - macro: '{$PVE.FILTER.QEMU.NOTMATCH}'
          value: CHANGE_ME_IF_NEEDED
          description: 'Exclude filter for QEMU virtual machine discovery by name.'
          config:
            type: TEXT
            priority: '32'
            section_name: Filters
            label: 'QEMU virtual machine discovery exclude filter'
            description: 'The exclude filter for QEMU virtual machine discovery by name.'
            regex: '.*'
        - macro: '{$PVE.FILTER.QEMU.OS.METRIC.MATCH}'
          value: '.*'
          description: 'Filter for QEMU virtual machine OS metric discovery by name.'
          config:
            type: TEXT
            priority: '38'
            section_name: Filters
            label: 'QEMU virtual machine OS metric discovery filter'
            description: 'The filter for QEMU virtual machine OS metric discovery by name.'
            regex: '.*'
        - macro: '{$PVE.FILTER.QEMU.OS.METRIC.NOTMATCH}'
          value: CHANGE_ME_IF_NEEDED
          description: 'Exclude filter for QEMU virtual machine OS metric discovery by name.'
          config:
            type: TEXT
            priority: '39'
            section_name: Filters
            label: 'QEMU virtual machine OS metric discovery exclude filter'
            description: 'The exclude filter for QEMU virtual machine OS metric discovery by name.'
            regex: '.*'
        - macro: '{$PVE.FILTER.QEMULXC.STATUS.MATCH}'
          value: '.*'
          description: 'Filter for QEMU and LXC discovery by status.'
          config:
            type: CHECKBOX
            priority: '28'
            section_name: Filters
            label: 'Discovery only running QEMU virtual machines and LXC containers'
            description: |
              The filter for QEMU and LXC discovery by status.
              If enabled, only running QEMU and LXC will be discovered.
            options:
              - checked: running
                unchecked: '.*'
        - macro: '{$PVE.FILTER.STORAGE.NAME.MATCH}'
          value: '.*'
          description: 'Filter for storage discovery by name.'
          config:
            type: TEXT
            priority: '44'
            section_name: Filters
            label: 'Storage discovery filter'
            description: 'The filter for storage discovery by name.'
            regex: '.*'
        - macro: '{$PVE.FILTER.STORAGE.NAME.NOTMATCH}'
          value: CHANGE_ME_IF_NEEDED
          description: 'Exclude filter for storage discovery by name.'
          config:
            type: TEXT
            priority: '45'
            section_name: Filters
            label: 'Storage discovery exclude filter'
            description: 'The exclude filter for storage discovery by name.'
            regex: '.*'
        - macro: '{$PVE.FILTER.USER.MATCH}'
          value: '.*'
          description: 'Filter for user discovery by fullname.'
          config:
            type: TEXT
            priority: '9'
            section_name: Filters
            label: 'User discovery filter'
            description: 'The filter for user discovery by fullname.'
            regex: '.*'
        - macro: '{$PVE.FILTER.USER.NOTMATCH}'
          value: CHANGE_ME_IF_NEEDED
          description: 'Exclude filter for user discovery by fullname.'
          config:
            type: TEXT
            priority: '10'
            section_name: Filters
            label: 'User discovery exclude filter'
            description: 'The exclude filter for user discovery by fullname.'
            regex: '.*'
        - macro: '{$PVE.LLD.ENABLE.CERT}'
          value: '.*'
          description: 'Enable discovery of node certificates.'
          config:
            type: CHECKBOX
            priority: '19'
            section_name: 'Low Level Discovery'
            label: 'Enable discovery of node certificates'
            description: 'If enabled, the template will discover node certificates.'
            options:
              - checked: '.*'
                unchecked: NO_DISCOVERY
        - macro: '{$PVE.LLD.ENABLE.DISK}'
          value: '.*'
          description: 'Enable discovery of node disks.'
          config:
            type: CHECKBOX
            priority: '20'
            section_name: 'Low Level Discovery'
            label: 'Enable discovery of node disks'
            description: 'If enabled, the template will discover node disks.'
            options:
              - checked: '.*'
                unchecked: NO_DISCOVERY
        - macro: '{$PVE.LLD.ENABLE.STORAGE}'
          value: '.*'
          description: 'Enable discovery of node storage.'
          config:
            type: CHECKBOX
            priority: '21'
            section_name: 'Low Level Discovery'
            label: 'Enable discovery of node storage'
            description: 'If enabled, the template will discover node storage.'
            options:
              - checked: '.*'
                unchecked: NO_DISCOVERY
        - macro: '{$PVE.PARAMS.INTERVAL.CERT}'
          value: 1h
          description: 'Interval for certificate data retrieval.'
          config:
            type: TEXT
            priority: '24'
            section_name: Other
            label: 'Certificate data update interval'
            description: |
              The interval for retrieving certificate data from the Proxmox VE API.
              Use for LLD and item updates.
            regex: '.*'
        - macro: '{$PVE.PARAMS.INTERVAL.CLUSTER}'
          value: 1m
          description: 'Interval for cluster data retrieval.'
          config:
            type: TEXT
            priority: '6'
            section_name: Other
            label: 'Cluster data update interval'
            description: 'The interval for retrieving cluster data from the Proxmox VE API.'
            regex: '.*'
        - macro: '{$PVE.PARAMS.INTERVAL.DISK}'
          value: 1h
          description: 'Interval for disk discovery.'
          config:
            type: TEXT
            priority: '27'
            section_name: Other
            label: 'Disk discovery interval'
            description: 'The interval for discovering disk from the Proxmox VE API.'
            regex: '.*'
        - macro: '{$PVE.PARAMS.INTERVAL.NODE}'
          value: 1m
          description: 'Interval for node data retrieval.'
          config:
            type: TEXT
            priority: '8'
            section_name: Other
            label: 'Node data update interval'
            description: |
              The interval for retrieving node data from the Proxmox VE API.
              Use for LLD and item updates.
            regex: '.*'
        - macro: '{$PVE.PARAMS.INTERVAL.QEMU.FS}'
          value: 1h
          description: 'Interval for QEMU virtual machine filesystem discover.'
          config:
            type: TEXT
            priority: '37'
            section_name: Other
            label: 'QEMU virtual machine filesystem discovery interval'
            description: 'The interval for discovery QEMU virtual machine filesystem from the Proxmox VE API.'
            regex: '.*'
        - macro: '{$PVE.PARAMS.INTERVAL.QEMU.NETWORK}'
          value: 12h
          description: 'Interval for QEMU virtual machine network interface discovery.'
          config:
            type: TEXT
            priority: '43'
            section_name: Other
            label: 'QEMU virtual machine network interface discovery interval'
            description: 'The interval for discovery QEMU virtual machine network interface from the Proxmox VE API.'
            regex: '.*'
        - macro: '{$PVE.PARAMS.INTERVAL.QEMU.OS}'
          value: 12h
          description: 'Interval for QEMU virtual machine OS metric data retrieval.'
          config:
            type: TEXT
            priority: '40'
            section_name: Other
            label: 'QEMU virtual machine OS metric data update interval'
            description: |
              The interval for retrieving QEMU virtual machine OS metric data from the Proxmox VE API.
              Use for LLD and item updates.
            regex: '.*'
        - macro: '{$PVE.PARAMS.INTERVAL.STORAGE}'
          value: 12h
          description: 'Interval for storage discovery.'
          config:
            type: TEXT
            priority: '46'
            section_name: Other
            label: 'Storage discovery interval'
            description: 'The interval for discovering storage from the Proxmox VE API.'
            regex: '.*'
        - macro: '{$PVE.PARAMS.INTERVAL.USER}'
          value: 1h
          description: 'Interval for user data retrieval.'
          config:
            type: TEXT
            priority: '7'
            section_name: Other
            label: 'User data update interval'
            description: |
              The interval for retrieving user data from the Proxmox VE API.
              Use for LLD and item updates.
            regex: '.*'
        - macro: '{$PVE.PROXY}'
          description: 'Proxy settings for the Proxmox VE API.'
          config:
            type: TEXT
            priority: '5'
            section_name: Other
            label: 'Proxmox VE API Proxy'
            description: |
              The proxy settings for the Proxmox VE API.
              Set empty value if you do not want to use a proxy.
            regex: '.*'
        - macro: '{$PVE.TOKEN.ID}'
          value: USER@REALM!TOKENID
          description: 'API tokens allow stateless access to most parts of the REST API by another system, software or API client.'
          config:
            type: TEXT
            priority: '3'
            label: 'Proxmox VE API Token ID'
            description: 'The ID of the API token to use for authentication.'
            required: 'YES'
            regex: '.*'
        - macro: '{$PVE.TOKEN.SECRET}'
          type: SECRET_TEXT
          description: 'Secret key.'
          config:
            type: TEXT
            priority: '4'
            label: 'Proxmox VE API Token Secret'
            description: 'The secret key of the API token to use for authentication.'
            required: 'YES'
            regex: '.*'
        - macro: '{$PVE.TRIGGER.CPU.WARNING}'
          value: '90'
          description: 'Threshold for CPU utilization warning triggers in percentage. This macro support context.'
          config:
            type: TEXT
            priority: '15'
            section_name: Other
            label: 'Threshold for CPU utilization (in %).'
            description: 'If the CPU utilization is greater than this value, a trigger will be activated. In the range from 1 to 100 inclusive.'
            regex: '^-?([0-9]+|(([0-9]+)\.([0-9]+)))$'
        - macro: '{$PVE.TRIGGER.DISK.WARNING}'
          value: '90'
          description: 'Threshold for disk usage warning triggers in percentage. This macro support context.'
          config:
            type: TEXT
            priority: '17'
            section_name: Other
            label: 'Threshold for disk usage (in %).'
            description: 'If the disk usage is greater than this value, a trigger will be activated. In the range from 1 to 100 inclusive.'
            regex: '^-?([0-9]+|(([0-9]+)\.([0-9]+)))$'
        - macro: '{$PVE.TRIGGER.MEMORY.WARNING}'
          value: '90'
          description: 'Threshold for memory usage warning triggers in percentage. This macro support context.'
          config:
            type: TEXT
            priority: '16'
            section_name: Other
            label: 'Threshold for memory usage (in %).'
            description: 'If the memory usage is greater than this value, a trigger will be activated. In the range from 1 to 100 inclusive.'
            regex: '^-?([0-9]+|(([0-9]+)\.([0-9]+)))$'
        - macro: '{$PVE.TRIGGER.SWAP.WARNING}'
          value: '90'
          description: 'Threshold for swap usage warning triggers in percentage. This macro support context.'
          config:
            type: TEXT
            priority: '18'
            section_name: Other
            label: 'Threshold for swap usage (in %).'
            description: 'If the swap usage is greater than this value, a trigger will be activated. In the range from 1 to 100 inclusive.'
            regex: '^-?([0-9]+|(([0-9]+)\.([0-9]+)))$'
        - macro: '{$PVE.TRIGGER.UPTIME}'
          value: 15m
          description: 'Threshold for uptime triggers. This macro support context.'
          config:
            type: TEXT
            priority: '14'
            section_name: Other
            label: 'Threshold for uptime triggers.'
            description: 'If the node uptime is less than this value, a trigger will be activated..'
            regex: '.*'
        - macro: '{$PVE.URL.HOST}'
          description: 'The hostname or IP address of the Proxmox VE API host.'
          config:
            type: TEXT
            priority: '1'
            label: 'Proxmox VE Host'
            description: 'The hostname or IP address of the Proxmox VE API host.'
            required: 'YES'
            regex: '.*'
        - macro: '{$PVE.URL.PORT}'
          value: '8006'
          description: 'The port number of the Proxmox VE API host.'
          config:
            type: TEXT
            priority: '2'
            label: 'Proxmox VE Port'
            description: 'The port number of the Proxmox VE API host. In the range from 1 to 65535 inclusive.'
            regex: '^-?([0-9]+|(([0-9]+)\.([0-9]+)))$'
      dashboards:
        - uuid: c5dc124c7789432a905f4cfc6c6eda81
          name: 'Proxmox VE'
          display_period: '3600'
          auto_start: 'NO'
          pages:
            - name: 'Proxmox VE overview'
              widgets:
                - type: item
                  name: Status
                  width: '12'
                  height: '3'
                  fields:
                    - type: INTEGER
                      name: decimal_places
                      value: '0'
                    - type: INTEGER
                      name: decimal_size
                      value: '10'
                    - type: ITEM
                      name: itemid.0
                      value:
                        host: 'Proxmox VE by HTTP'
                        key: proxmox_ve.cluster.quorum.status
                    - type: INTEGER
                      name: show.0
                      value: '2'
                    - type: INTEGER
                      name: show.1
                      value: '4'
                    - type: STRING
                      name: thresholds.0.color
                      value: FF8A65
                    - type: STRING
                      name: thresholds.0.threshold
                      value: '0'
                    - type: STRING
                      name: thresholds.1.color
                      value: 81C784
                    - type: STRING
                      name: thresholds.1.threshold
                      value: '1'
                    - type: STRING
                      name: thresholds.2.color
                      value: 3272fc
                    - type: STRING
                      name: thresholds.2.threshold
                      value: '2'
                    - type: INTEGER
                      name: units_bold
                      value: '0'
                    - type: INTEGER
                      name: units_show
                      value: '0'
                    - type: INTEGER
                      name: value_size
                      value: '15'
                - type: gauge
                  name: CPU
                  'y': '3'
                  width: '12'
                  height: '4'
                  hide_header: 'YES'
                  fields:
                    - type: INTEGER
                      name: angle
                      value: '270'
                    - type: INTEGER
                      name: decimal_places
                      value: '0'
                    - type: STRING
                      name: description
                      value: CPU
                    - type: ITEM
                      name: itemid.0
                      value:
                        host: 'Proxmox VE by HTTP'
                        key: proxmox_ve.cluster.cpu.utilization
                    - type: INTEGER
                      name: rf_rate
                      value: '10'
                    - type: INTEGER
                      name: scale_show_units
                      value: '0'
                    - type: INTEGER
                      name: show.0
                      value: '1'
                    - type: INTEGER
                      name: show.1
                      value: '2'
                    - type: INTEGER
                      name: show.2
                      value: '3'
                    - type: INTEGER
                      name: show.3
                      value: '4'
                    - type: INTEGER
                      name: show.4
                      value: '5'
                    - type: STRING
                      name: thresholds.0.color
                      value: 4CAF50
                    - type: STRING
                      name: thresholds.0.threshold
                      value: '0'
                    - type: STRING
                      name: thresholds.1.color
                      value: FFFF00
                    - type: STRING
                      name: thresholds.1.threshold
                      value: '50'
                    - type: STRING
                      name: thresholds.2.color
                      value: FF8000
                    - type: STRING
                      name: thresholds.2.threshold
                      value: '80'
                    - type: STRING
                      name: thresholds.3.color
                      value: FF4000
                    - type: STRING
                      name: thresholds.3.threshold
                      value: '90'
                    - type: INTEGER
                      name: th_show_arc
                      value: '1'
                    - type: INTEGER
                      name: th_show_labels
                      value: '1'
                    - type: STRING
                      name: value_arc_color
                      value: 1E88E5
                - type: item
                  'y': '7'
                  width: '12'
                  height: '1'
                  hide_header: 'YES'
                  fields:
                    - type: INTEGER
                      name: decimal_places
                      value: '0'
                    - type: ITEM
                      name: itemid.0
                      value:
                        host: 'Proxmox VE by HTTP'
                        key: proxmox_ve.cluster.cpu.count
                    - type: INTEGER
                      name: show.0
                      value: '2'
                - type: topitems
                  'y': '8'
                  width: '18'
                  height: '5'
                  hide_header: 'YES'
                  fields:
                    - type: STRING
                      name: columns.0.base_color
                      value: 4CAF50
                    - type: INTEGER
                      name: columns.0.display
                      value: '3'
                    - type: STRING
                      name: columns.0.items.0
                      value: '*CPU utilization'
                    - type: INTEGER
                      name: columns.0.item_tags.0.operator
                      value: '2'
                    - type: STRING
                      name: columns.0.item_tags.0.tag
                      value: component
                    - type: STRING
                      name: columns.0.item_tags.0.value
                      value: cluster
                    - type: INTEGER
                      name: columns.0.item_tags.1.operator
                      value: '5'
                    - type: STRING
                      name: columns.0.item_tags.1.tag
                      value: qemu
                    - type: STRING
                      name: columns.0.item_tags.1.value
                      value: ''
                    - type: INTEGER
                      name: columns.0.item_tags.2.operator
                      value: '5'
                    - type: STRING
                      name: columns.0.item_tags.2.tag
                      value: lxc
                    - type: STRING
                      name: columns.0.item_tags.2.value
                      value: ''
                    - type: STRING
                      name: columns.0.max
                      value: '100'
                    - type: STRING
                      name: columns.0.min
                      value: '0'
                    - type: STRING
                      name: columns.0.thresholds.0.color
                      value: FFFF00
                    - type: STRING
                      name: columns.0.thresholds.0.threshold
                      value: '50'
                    - type: STRING
                      name: columns.0.thresholds.1.color
                      value: FFD54F
                    - type: STRING
                      name: columns.0.thresholds.1.threshold
                      value: '80'
                    - type: STRING
                      name: columns.0.thresholds.2.color
                      value: FF4000
                    - type: STRING
                      name: columns.0.thresholds.2.threshold
                      value: '90'
                    - type: INTEGER
                      name: item_ordering_limit
                      value: '20'
                    - type: INTEGER
                      name: item_ordering_order_by
                      value: '2'
                    - type: INTEGER
                      name: layout
                      value: '1'
                    - type: INTEGER
                      name: problems
                      value: '2'
                    - type: INTEGER
                      name: rf_rate
                      value: '10'
                    - type: INTEGER
                      name: show_column_header
                      value: '0'
                - type: honeycomb
                  name: 'Node status'
                  x: '12'
                  width: '15'
                  height: '3'
                  fields:
                    - type: STRING
                      name: items.0
                      value: 'Node [*]: Status'
                    - type: INTEGER
                      name: item_tags.0.operator
                      value: '5'
                    - type: STRING
                      name: item_tags.0.tag
                      value: qemu
                    - type: STRING
                      name: item_tags.0.value
                      value: ''
                    - type: INTEGER
                      name: item_tags.1.operator
                      value: '5'
                    - type: STRING
                      name: item_tags.1.tag
                      value: lxc
                    - type: STRING
                      name: item_tags.1.value
                      value: ''
                    - type: STRING
                      name: primary_label
                      value: '{{ITEM.NAME}.regsub("^(Node \[)(.*)(\]: Status)", "\2")}'
                    - type: STRING
                      name: reference
                      value: FEFFA
                    - type: INTEGER
                      name: rf_rate
                      value: '10'
                    - type: INTEGER
                      name: show.0
                      value: '1'
                    - type: STRING
                      name: thresholds.0.color
                      value: B0BEC5
                    - type: STRING
                      name: thresholds.0.threshold
                      value: '5'
                    - type: STRING
                      name: thresholds.1.color
                      value: E65660
                    - type: STRING
                      name: thresholds.1.threshold
                      value: '1'
                    - type: STRING
                      name: thresholds.2.color
                      value: 3BC97D
                    - type: STRING
                      name: thresholds.2.threshold
                      value: '10'
                    - type: STRING
                      name: thresholds.3.color
                      value: B0BEC5
                    - type: STRING
                      name: thresholds.3.threshold
                      value: '0'
                - type: gauge
                  x: '12'
                  'y': '3'
                  width: '12'
                  height: '4'
                  hide_header: 'YES'
                  fields:
                    - type: INTEGER
                      name: angle
                      value: '270'
                    - type: INTEGER
                      name: decimal_places
                      value: '0'
                    - type: STRING
                      name: description
                      value: Memory
                    - type: ITEM
                      name: itemid.0
                      value:
                        host: 'Proxmox VE by HTTP'
                        key: proxmox_ve.cluster.memory.utilization
                    - type: INTEGER
                      name: rf_rate
                      value: '10'
                    - type: INTEGER
                      name: scale_show_units
                      value: '0'
                    - type: INTEGER
                      name: show.0
                      value: '1'
                    - type: INTEGER
                      name: show.1
                      value: '2'
                    - type: INTEGER
                      name: show.2
                      value: '3'
                    - type: INTEGER
                      name: show.3
                      value: '4'
                    - type: INTEGER
                      name: show.4
                      value: '5'
                    - type: STRING
                      name: thresholds.0.color
                      value: 4CAF50
                    - type: STRING
                      name: thresholds.0.threshold
                      value: '0'
                    - type: STRING
                      name: thresholds.1.color
                      value: FFFF00
                    - type: STRING
                      name: thresholds.1.threshold
                      value: '50'
                    - type: STRING
                      name: thresholds.2.color
                      value: FF8000
                    - type: STRING
                      name: thresholds.2.threshold
                      value: '80'
                    - type: STRING
                      name: thresholds.3.color
                      value: FF4000
                    - type: STRING
                      name: thresholds.3.threshold
                      value: '90'
                    - type: INTEGER
                      name: th_show_arc
                      value: '1'
                    - type: INTEGER
                      name: th_show_labels
                      value: '1'
                    - type: STRING
                      name: value_arc_color
                      value: 1E88E5
                - type: item
                  x: '12'
                  'y': '7'
                  width: '6'
                  height: '1'
                  hide_header: 'YES'
                  fields:
                    - type: ITEM
                      name: itemid.0
                      value:
                        host: 'Proxmox VE by HTTP'
                        key: proxmox_ve.cluster.memory.used
                    - type: INTEGER
                      name: show.0
                      value: '2'
                - type: item
                  x: '18'
                  'y': '7'
                  width: '6'
                  height: '1'
                  hide_header: 'YES'
                  fields:
                    - type: ITEM
                      name: itemid.0
                      value:
                        host: 'Proxmox VE by HTTP'
                        key: proxmox_ve.cluster.memory.total
                    - type: INTEGER
                      name: show.0
                      value: '2'
                - type: topitems
                  x: '18'
                  'y': '8'
                  width: '18'
                  height: '5'
                  hide_header: 'YES'
                  fields:
                    - type: STRING
                      name: columns.0.base_color
                      value: 4CAF50
                    - type: INTEGER
                      name: columns.0.display
                      value: '2'
                    - type: STRING
                      name: columns.0.items.0
                      value: '*Memory utilization'
                    - type: INTEGER
                      name: columns.0.item_tags.0.operator
                      value: '2'
                    - type: STRING
                      name: columns.0.item_tags.0.tag
                      value: component
                    - type: STRING
                      name: columns.0.item_tags.0.value
                      value: cluster
                    - type: INTEGER
                      name: columns.0.item_tags.1.operator
                      value: '5'
                    - type: STRING
                      name: columns.0.item_tags.1.tag
                      value: qemu
                    - type: STRING
                      name: columns.0.item_tags.1.value
                      value: ''
                    - type: INTEGER
                      name: columns.0.item_tags.2.operator
                      value: '5'
                    - type: STRING
                      name: columns.0.item_tags.2.tag
                      value: lxc
                    - type: STRING
                      name: columns.0.item_tags.2.value
                      value: ''
                    - type: STRING
                      name: columns.0.max
                      value: '100'
                    - type: STRING
                      name: columns.0.min
                      value: '0'
                    - type: STRING
                      name: columns.0.thresholds.0.color
                      value: FFFF00
                    - type: STRING
                      name: columns.0.thresholds.0.threshold
                      value: '50'
                    - type: STRING
                      name: columns.0.thresholds.1.color
                      value: FFD54F
                    - type: STRING
                      name: columns.0.thresholds.1.threshold
                      value: '80'
                    - type: STRING
                      name: columns.0.thresholds.2.color
                      value: FF4000
                    - type: STRING
                      name: columns.0.thresholds.2.threshold
                      value: '90'
                    - type: INTEGER
                      name: item_ordering_limit
                      value: '20'
                    - type: INTEGER
                      name: item_ordering_order_by
                      value: '2'
                    - type: INTEGER
                      name: layout
                      value: '1'
                    - type: INTEGER
                      name: problems
                      value: '2'
                    - type: INTEGER
                      name: rf_rate
                      value: '10'
                    - type: INTEGER
                      name: show_column_header
                      value: '0'
                - type: gauge
                  x: '24'
                  'y': '3'
                  width: '12'
                  height: '4'
                  hide_header: 'YES'
                  fields:
                    - type: INTEGER
                      name: angle
                      value: '270'
                    - type: INTEGER
                      name: decimal_places
                      value: '0'
                    - type: STRING
                      name: description
                      value: Storage
                    - type: ITEM
                      name: itemid.0
                      value:
                        host: 'Proxmox VE by HTTP'
                        key: proxmox_ve.cluster.storage.utilization
                    - type: INTEGER
                      name: rf_rate
                      value: '10'
                    - type: INTEGER
                      name: scale_show_units
                      value: '0'
                    - type: INTEGER
                      name: show.0
                      value: '1'
                    - type: INTEGER
                      name: show.1
                      value: '2'
                    - type: INTEGER
                      name: show.2
                      value: '3'
                    - type: INTEGER
                      name: show.3
                      value: '4'
                    - type: INTEGER
                      name: show.4
                      value: '5'
                    - type: STRING
                      name: thresholds.0.color
                      value: 4CAF50
                    - type: STRING
                      name: thresholds.0.threshold
                      value: '0'
                    - type: STRING
                      name: thresholds.1.color
                      value: FFFF00
                    - type: STRING
                      name: thresholds.1.threshold
                      value: '50'
                    - type: STRING
                      name: thresholds.2.color
                      value: FF8000
                    - type: STRING
                      name: thresholds.2.threshold
                      value: '80'
                    - type: STRING
                      name: thresholds.3.color
                      value: FF4000
                    - type: STRING
                      name: thresholds.3.threshold
                      value: '90'
                    - type: INTEGER
                      name: th_show_arc
                      value: '1'
                    - type: INTEGER
                      name: th_show_labels
                      value: '1'
                    - type: STRING
                      name: value_arc_color
                      value: 1E88E5
                - type: item
                  x: '24'
                  'y': '7'
                  width: '6'
                  height: '1'
                  hide_header: 'YES'
                  fields:
                    - type: ITEM
                      name: itemid.0
                      value:
                        host: 'Proxmox VE by HTTP'
                        key: proxmox_ve.cluster.storage.used
                    - type: INTEGER
                      name: show.0
                      value: '2'
                - type: piechart
                  name: Nodes
                  x: '27'
                  width: '15'
                  height: '3'
                  fields:
                    - type: INTEGER
                      name: decimal_places
                      value: '0'
                    - type: INTEGER
                      name: draw_type
                      value: '1'
                    - type: STRING
                      name: ds.0.color.0
                      value: 81C784
                    - type: INTEGER
                      name: ds.0.dataset_type
                      value: '0'
                    - type: ITEM
                      name: ds.0.itemids.0
                      value:
                        host: 'Proxmox VE by HTTP'
                        key: proxmox_ve.cluster.nodes.online
                    - type: INTEGER
                      name: ds.0.type.0
                      value: '0'
                    - type: STRING
                      name: ds.1.color.0
                      value: FF8A65
                    - type: INTEGER
                      name: ds.1.dataset_type
                      value: '0'
                    - type: ITEM
                      name: ds.1.itemids.0
                      value:
                        host: 'Proxmox VE by HTTP'
                        key: proxmox_ve.cluster.nodes.offline
                    - type: INTEGER
                      name: ds.1.type.0
                      value: '0'
                    - type: INTEGER
                      name: legend_lines
                      value: '2'
                    - type: INTEGER
                      name: legend_value
                      value: '1'
                    - type: INTEGER
                      name: total_show
                      value: '1'
                - type: item
                  x: '30'
                  'y': '7'
                  width: '6'
                  height: '1'
                  hide_header: 'YES'
                  fields:
                    - type: ITEM
                      name: itemid.0
                      value:
                        host: 'Proxmox VE by HTTP'
                        key: proxmox_ve.cluster.storage.total
                    - type: INTEGER
                      name: show.0
                      value: '2'
                - type: svggraph
                  x: '36'
                  'y': '3'
                  width: '36'
                  height: '5'
                  fields:
                    - type: STRING
                      name: ds.0.color.0
                      value: 0080FF
                    - type: STRING
                      name: ds.0.color.1
                      value: FFD54F
                    - type: STRING
                      name: ds.0.color.2
                      value: 0EC9AC
                    - type: INTEGER
                      name: ds.0.dataset_type
                      value: '0'
                    - type: INTEGER
                      name: ds.0.fill
                      value: '1'
                    - type: ITEM
                      name: ds.0.itemids.0
                      value:
                        host: 'Proxmox VE by HTTP'
                        key: proxmox_ve.cluster.cpu.utilization
                    - type: ITEM
                      name: ds.0.itemids.1
                      value:
                        host: 'Proxmox VE by HTTP'
                        key: proxmox_ve.cluster.memory.utilization
                    - type: ITEM
                      name: ds.0.itemids.2
                      value:
                        host: 'Proxmox VE by HTTP'
                        key: proxmox_ve.cluster.storage.utilization
                    - type: INTEGER
                      name: ds.0.missingdatafunc
                      value: '3'
                    - type: INTEGER
                      name: ds.0.transparency
                      value: '4'
                    - type: INTEGER
                      name: ds.0.type
                      value: '2'
                    - type: INTEGER
                      name: ds.0.width
                      value: '2'
                    - type: STRING
                      name: lefty_max
                      value: '100'
                    - type: STRING
                      name: lefty_min
                      value: '0'
                    - type: INTEGER
                      name: legend_lines
                      value: '3'
                    - type: INTEGER
                      name: legend_statistic
                      value: '1'
                    - type: STRING
                      name: reference
                      value: ZZQQX
                    - type: INTEGER
                      name: righty
                      value: '0'
                    - type: INTEGER
                      name: simple_triggers
                      value: '1'
                    - type: INTEGER
                      name: working_time
                      value: '1'
                - type: topitems
                  x: '36'
                  'y': '8'
                  width: '18'
                  height: '5'
                  hide_header: 'YES'
                  fields:
                    - type: STRING
                      name: columns.0.base_color
                      value: 4CAF50
                    - type: INTEGER
                      name: columns.0.display_value_as
                      value: '2'
                    - type: STRING
                      name: columns.0.items.0
                      value: 'Node [*]: uptime'
                    - type: INTEGER
                      name: columns.0.item_tags.0.operator
                      value: '2'
                    - type: STRING
                      name: columns.0.item_tags.0.tag
                      value: component
                    - type: STRING
                      name: columns.0.item_tags.0.value
                      value: cluster
                    - type: INTEGER
                      name: columns.0.item_tags.1.operator
                      value: '5'
                    - type: STRING
                      name: columns.0.item_tags.1.tag
                      value: qemu
                    - type: STRING
                      name: columns.0.item_tags.1.value
                      value: ''
                    - type: INTEGER
                      name: columns.0.item_tags.2.operator
                      value: '5'
                    - type: STRING
                      name: columns.0.item_tags.2.tag
                      value: lxc
                    - type: STRING
                      name: columns.0.item_tags.2.value
                      value: ''
                    - type: INTEGER
                      name: item_ordering_limit
                      value: '20'
                    - type: INTEGER
                      name: item_ordering_order_by
                      value: '2'
                    - type: INTEGER
                      name: layout
                      value: '1'
                    - type: INTEGER
                      name: problems
                      value: '2'
                    - type: INTEGER
                      name: rf_rate
                      value: '10'
                    - type: INTEGER
                      name: show_column_header
                      value: '0'
                - type: piechart
                  name: 'Virtual mashines'
                  x: '42'
                  width: '15'
                  height: '3'
                  fields:
                    - type: INTEGER
                      name: decimal_places
                      value: '0'
                    - type: INTEGER
                      name: draw_type
                      value: '1'
                    - type: STRING
                      name: ds.0.color.0
                      value: 81C784
                    - type: INTEGER
                      name: ds.0.dataset_type
                      value: '0'
                    - type: ITEM
                      name: ds.0.itemids.0
                      value:
                        host: 'Proxmox VE by HTTP'
                        key: proxmox_ve.cluster.vms.running
                    - type: INTEGER
                      name: ds.0.type.0
                      value: '0'
                    - type: STRING
                      name: ds.1.color.0
                      value: FF8A65
                    - type: INTEGER
                      name: ds.1.dataset_type
                      value: '0'
                    - type: ITEM
                      name: ds.1.itemids.0
                      value:
                        host: 'Proxmox VE by HTTP'
                        key: proxmox_ve.cluster.vms.stopped
                    - type: INTEGER
                      name: ds.1.type.0
                      value: '0'
                    - type: INTEGER
                      name: legend_lines
                      value: '2'
                    - type: INTEGER
                      name: legend_value
                      value: '1'
                    - type: INTEGER
                      name: total_show
                      value: '1'
                - type: topitems
                  x: '54'
                  'y': '8'
                  width: '18'
                  height: '5'
                  hide_header: 'YES'
                  fields:
                    - type: STRING
                      name: columns.0.base_color
                      value: 4CAF50
                    - type: INTEGER
                      name: columns.0.display
                      value: '2'
                    - type: STRING
                      name: columns.0.items.0
                      value: '*torage [*]: Utilization'
                    - type: STRING
                      name: columns.0.max
                      value: '100'
                    - type: STRING
                      name: columns.0.min
                      value: '0'
                    - type: STRING
                      name: columns.0.thresholds.0.color
                      value: FFFF00
                    - type: STRING
                      name: columns.0.thresholds.0.threshold
                      value: '50'
                    - type: STRING
                      name: columns.0.thresholds.1.color
                      value: FFD54F
                    - type: STRING
                      name: columns.0.thresholds.1.threshold
                      value: '80'
                    - type: STRING
                      name: columns.0.thresholds.2.color
                      value: FF4000
                    - type: STRING
                      name: columns.0.thresholds.2.threshold
                      value: '90'
                    - type: INTEGER
                      name: item_ordering_limit
                      value: '20'
                    - type: INTEGER
                      name: item_ordering_order_by
                      value: '2'
                    - type: INTEGER
                      name: layout
                      value: '1'
                    - type: INTEGER
                      name: problems
                      value: '2'
                    - type: INTEGER
                      name: rf_rate
                      value: '10'
                    - type: INTEGER
                      name: show_column_header
                      value: '0'
                - type: piechart
                  name: 'LXC containers'
                  x: '57'
                  width: '15'
                  height: '3'
                  fields:
                    - type: INTEGER
                      name: decimal_places
                      value: '0'
                    - type: INTEGER
                      name: draw_type
                      value: '1'
                    - type: STRING
                      name: ds.0.color.0
                      value: 81C784
                    - type: INTEGER
                      name: ds.0.dataset_type
                      value: '0'
                    - type: ITEM
                      name: ds.0.itemids.0
                      value:
                        host: 'Proxmox VE by HTTP'
                        key: proxmox_ve.cluster.lxc.running
                    - type: INTEGER
                      name: ds.0.type.0
                      value: '0'
                    - type: STRING
                      name: ds.1.color.0
                      value: FF8A65
                    - type: INTEGER
                      name: ds.1.dataset_type
                      value: '0'
                    - type: ITEM
                      name: ds.1.itemids.0
                      value:
                        host: 'Proxmox VE by HTTP'
                        key: proxmox_ve.cluster.lxc.stopped
                    - type: INTEGER
                      name: ds.1.type.0
                      value: '0'
                    - type: INTEGER
                      name: legend_lines
                      value: '2'
                    - type: INTEGER
                      name: legend_value
                      value: '1'
                    - type: INTEGER
                      name: total_show
                      value: '1'
            - name: 'Proxmox VE Virtual machines/LXC containers'
              widgets:
                - type: honeycomb
                  name: 'Virtual machines'
                  width: '36'
                  height: '3'
                  fields:
                    - type: STRING
                      name: items.0
                      value: 'Node [*]: QEMU [*]: status'
                    - type: STRING
                      name: primary_label
                      value: '{{ITEM.NAME}.regsub("^(Node \[)(.*)(: QEMU \[)(.*)(\]: Status)", "\4")}'
                    - type: STRING
                      name: reference
                      value: CEUHK
                    - type: INTEGER
                      name: rf_rate
                      value: '10'
                    - type: INTEGER
                      name: show.0
                      value: '1'
                    - type: STRING
                      name: thresholds.0.color
                      value: B0BEC5
                    - type: STRING
                      name: thresholds.0.threshold
                      value: '0'
                    - type: STRING
                      name: thresholds.1.color
                      value: E65660
                    - type: STRING
                      name: thresholds.1.threshold
                      value: '1'
                    - type: STRING
                      name: thresholds.2.color
                      value: 3BC97D
                    - type: STRING
                      name: thresholds.2.threshold
                      value: '2'
                - type: itemnavigator
                  name: QEMU
                  'y': '3'
                  width: '12'
                  height: '10'
                  hide_header: 'YES'
                  fields:
                    - type: INTEGER
                      name: group_by.0.attribute
                      value: '3'
                    - type: STRING
                      name: group_by.0.tag_name
                      value: qemu
                    - type: STRING
                      name: items.0
                      value: 'Node [*]: QEMU [*]: *Utilization'
                    - type: STRING
                      name: items.1
                      value: 'Node [*]: QEMU [*]: Network input speed*'
                    - type: STRING
                      name: items.2
                      value: 'Node [*]: QEMU [*]: Network output speed*'
                    - type: INTEGER
                      name: item_tags.0.operator
                      value: '3'
                    - type: STRING
                      name: item_tags.0.tag
                      value: component
                    - type: STRING
                      name: item_tags.0.value
                      value: raw
                    - type: STRING
                      name: reference
                      value: LAYQE
                    - type: INTEGER
                      name: show_lines
                      value: '500'
                - type: topitems
                  x: '12'
                  'y': '3'
                  width: '12'
                  height: '5'
                  hide_header: 'YES'
                  fields:
                    - type: INTEGER
                      name: columns.0.display
                      value: '2'
                    - type: STRING
                      name: columns.0.items.0
                      value: 'Node [*]: QEMU [*]: CPU utilization'
                    - type: STRING
                      name: columns.0.max
                      value: '100'
                    - type: STRING
                      name: columns.0.min
                      value: '0'
                    - type: INTEGER
                      name: item_ordering_order_by
                      value: '2'
                    - type: INTEGER
                      name: layout
                      value: '1'
                    - type: INTEGER
                      name: problems
                      value: '2'
                    - type: INTEGER
                      name: rf_rate
                      value: '10'
                    - type: INTEGER
                      name: show_column_header
                      value: '0'
                - type: svggraph
                  x: '12'
                  'y': '8'
                  width: '24'
                  height: '5'
                  fields:
                    - type: STRING
                      name: ds.0.color.0
                      value: 0080FF
                    - type: INTEGER
                      name: ds.0.dataset_type
                      value: '0'
                    - type: STRING
                      name: ds.0.itemids.0._reference
                      value: LAYQE._itemid
                    - type: INTEGER
                      name: ds.0.transparency
                      value: '7'
                    - type: INTEGER
                      name: ds.0.type
                      value: '2'
                    - type: INTEGER
                      name: ds.0.width
                      value: '3'
                    - type: INTEGER
                      name: legend_statistic
                      value: '1'
                    - type: STRING
                      name: reference
                      value: OTZNF
                    - type: INTEGER
                      name: rf_rate
                      value: '10'
                    - type: INTEGER
                      name: righty
                      value: '0'
                    - type: INTEGER
                      name: simple_triggers
                      value: '1'
                    - type: INTEGER
                      name: working_time
                      value: '1'
                - type: topitems
                  x: '24'
                  'y': '3'
                  width: '12'
                  height: '5'
                  hide_header: 'YES'
                  fields:
                    - type: INTEGER
                      name: columns.0.display
                      value: '2'
                    - type: STRING
                      name: columns.0.items.0
                      value: 'Node [*]: QEMU [*]: Memory utilization'
                    - type: STRING
                      name: columns.0.max
                      value: '100'
                    - type: STRING
                      name: columns.0.min
                      value: '0'
                    - type: INTEGER
                      name: item_ordering_order_by
                      value: '2'
                    - type: INTEGER
                      name: layout
                      value: '1'
                    - type: INTEGER
                      name: problems
                      value: '2'
                    - type: INTEGER
                      name: rf_rate
                      value: '10'
                    - type: INTEGER
                      name: show_column_header
                      value: '0'
                - type: honeycomb
                  name: 'LXC containers'
                  x: '36'
                  width: '36'
                  height: '3'
                  fields:
                    - type: STRING
                      name: items.0
                      value: 'Node [*]: LXC [*]: Status'
                    - type: STRING
                      name: primary_label
                      value: '{{ITEM.NAME}.regsub("^(Node \[)(.*)(: LXC \[)(.*)(\]: Status)", "\4")}'
                    - type: STRING
                      name: reference
                      value: FYYJF
                    - type: INTEGER
                      name: rf_rate
                      value: '10'
                    - type: INTEGER
                      name: show.0
                      value: '1'
                    - type: STRING
                      name: thresholds.0.color
                      value: B0BEC5
                    - type: STRING
                      name: thresholds.0.threshold
                      value: '0'
                    - type: STRING
                      name: thresholds.1.color
                      value: E65660
                    - type: STRING
                      name: thresholds.1.threshold
                      value: '1'
                    - type: STRING
                      name: thresholds.2.color
                      value: 3BC97D
                    - type: STRING
                      name: thresholds.2.threshold
                      value: '2'
                - type: itemnavigator
                  name: LXC
                  x: '36'
                  'y': '3'
                  width: '12'
                  height: '10'
                  hide_header: 'YES'
                  fields:
                    - type: INTEGER
                      name: group_by.0.attribute
                      value: '3'
                    - type: STRING
                      name: group_by.0.tag_name
                      value: lxc
                    - type: STRING
                      name: items.0
                      value: 'Node [*]: LXC [*]: *Utilization'
                    - type: STRING
                      name: items.1
                      value: 'Node [*]: LXC [*]: Network*'
                    - type: INTEGER
                      name: item_tags.0.operator
                      value: '3'
                    - type: STRING
                      name: item_tags.0.tag
                      value: component
                    - type: STRING
                      name: item_tags.0.value
                      value: raw
                    - type: STRING
                      name: reference
                      value: NYHTO
                    - type: INTEGER
                      name: show_lines
                      value: '500'
                - type: topitems
                  x: '48'
                  'y': '3'
                  width: '12'
                  height: '5'
                  hide_header: 'YES'
                  fields:
                    - type: INTEGER
                      name: columns.0.display
                      value: '2'
                    - type: STRING
                      name: columns.0.items.0
                      value: 'Node [*]: LXC [*]: CPU utilization'
                    - type: STRING
                      name: columns.0.max
                      value: '100'
                    - type: STRING
                      name: columns.0.min
                      value: '0'
                    - type: INTEGER
                      name: item_ordering_order_by
                      value: '2'
                    - type: INTEGER
                      name: layout
                      value: '1'
                    - type: INTEGER
                      name: problems
                      value: '2'
                    - type: INTEGER
                      name: rf_rate
                      value: '10'
                    - type: INTEGER
                      name: show_column_header
                      value: '0'
                - type: svggraph
                  x: '48'
                  'y': '8'
                  width: '24'
                  height: '5'
                  fields:
                    - type: STRING
                      name: ds.0.color.0
                      value: 0080FF
                    - type: INTEGER
                      name: ds.0.dataset_type
                      value: '0'
                    - type: STRING
                      name: ds.0.itemids.0._reference
                      value: NYHTO._itemid
                    - type: INTEGER
                      name: ds.0.transparency
                      value: '7'
                    - type: INTEGER
                      name: ds.0.type
                      value: '2'
                    - type: INTEGER
                      name: ds.0.width
                      value: '3'
                    - type: INTEGER
                      name: legend_statistic
                      value: '1'
                    - type: STRING
                      name: reference
                      value: BWRJQ
                    - type: INTEGER
                      name: rf_rate
                      value: '10'
                    - type: INTEGER
                      name: righty
                      value: '0'
                    - type: INTEGER
                      name: simple_triggers
                      value: '1'
                    - type: INTEGER
                      name: working_time
                      value: '1'
                - type: topitems
                  x: '60'
                  'y': '3'
                  width: '12'
                  height: '5'
                  hide_header: 'YES'
                  fields:
                    - type: INTEGER
                      name: columns.0.display
                      value: '2'
                    - type: STRING
                      name: columns.0.items.0
                      value: 'Node [*]: LXC [*]: Memory utilization'
                    - type: STRING
                      name: columns.0.max
                      value: '100'
                    - type: STRING
                      name: columns.0.min
                      value: '0'
                    - type: INTEGER
                      name: item_ordering_order_by
                      value: '2'
                    - type: INTEGER
                      name: layout
                      value: '1'
                    - type: INTEGER
                      name: problems
                      value: '2'
                    - type: INTEGER
                      name: rf_rate
                      value: '10'
                    - type: INTEGER
                      name: show_column_header
                      value: '0'
      valuemaps:
        - uuid: b515085461664df1923e94cae6a7ab77
          name: 'Proxmox cluster quorum status'
          mappings:
            - value: '2'
              newvalue: 'Standalone node'
            - value: '1'
              newvalue: 'Quorum achieved'
            - value: '0'
              newvalue: 'No quorum'
        - uuid: 1ca4a765eea54e75b01fc177fce95512
          name: 'Proxmox LXC/QEMU status'
          mappings:
            - value: '2'
              newvalue: Running
            - value: '1'
              newvalue: Stopped
            - value: '0'
              newvalue: Unknown
        - uuid: ff43ebc253fa4f019b211fd8857f4181
          name: 'Proxmox node apt updates'
          mappings:
            - value: '0'
              newvalue: 'Up to date'
            - type: GREATER_OR_EQUAL
              value: '1'
              newvalue: 'Updates available'
        - uuid: f0ebac5571684a76aac529e5e74d5190
          name: 'Proxmox node disk SMART status'
          mappings:
            - value: '1'
              newvalue: Healthy
            - value: '0'
              newvalue: Unhealthy
        - uuid: 0b27ca9a1c4247aeb09c123106e25ce9
          name: 'Proxmox node PCI/USB devices'
          mappings:
            - value: '0'
              newvalue: 'No devices'
        - uuid: 9c307d5f81a240f0bce71fe450a1df7d
          name: 'Proxmox node status'
          mappings:
            - value: '10'
              newvalue: Online
            - value: '5'
              newvalue: Unknown
            - value: '1'
              newvalue: Offline
            - value: '0'
              newvalue: Undefined
        - uuid: 6dbee068fa6c4907b57667ee1525942c
          name: 'Proxmox QEMU agent status'
          mappings:
            - value: '1'
              newvalue: Enabled
            - value: '0'
              newvalue: Disabled
            - value: '3'
              newvalue: Unknown
        - uuid: 2c3f8b0e4a1f4b5c9a8b7c6d5e4f3a2b
          name: 'Proxmox subscription level'
          mappings:
            - newvalue: 'No subscription'
        - uuid: fdd273eea4ed40d0bec2bb5a620b38ac
          name: 'Proxmox user enabled status'
          mappings:
            - value: '1'
              newvalue: Enabled
            - value: '0'
              newvalue: Disabled
        - uuid: 37951abd4a04421994cfe25c66733d30
          name: 'Proxmox user expire date'
          mappings:
            - value: '-1'
              newvalue: Never
            - value: '0'
              newvalue: Expired
            - type: IN_RANGE
              value: 1-604800
              newvalue: 'Less than 7 days'
            - type: IN_RANGE
              value: 604801-2592000
              newvalue: 'Less than 30 days'
